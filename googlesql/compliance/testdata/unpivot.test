# TODO: Add tests explicit label values.
# TODO: Check if tablesample works with unpivot.
[default required_features=UNPIVOT]
[prepare_database]
CREATE TABLE t AS
  SELECT * FROM UNNEST([
    STRUCT(1 AS rowid, 1 AS a, 100 AS b, 1000 AS c, 10 AS d, "one" as a_string, "hundred" as b_string),
    STRUCT(2, 2, 101, 1000, 10, "two", "hundred_one"),
    STRUCT(3, 3, 102, 1001, 11, "three", "hundred_two"),
    STRUCT(4, 4, 103, 1001, 11, "four", "hundred_three"),
    STRUCT(5, 1, 101, 1002, 12, "five", "hundred_one"),
    STRUCT(6, 2, 102, 1002, 12, "six", "hundred_two"),
    STRUCT(7, 3, 103, 1003, 13, "seven", "hundred_three"),
    STRUCT(8, 4, 100, 1003, 13, "eight", "hundred"),
    STRUCT(9, null, null, null, null, "nine", "hundred_one"),
    STRUCT(10, null, 101, 1003, 13, "ten", "hundred_two"),
    STRUCT(11, 4, null, 1003, null, "eleven", "hundred_three"),
    STRUCT(12, null, null, 1003, 13, "twelve", "hundred")
    ]);
--
ARRAY<STRUCT<rowid INT64,
             a INT64,
             b INT64,
             c INT64,
             d INT64,
             a_string STRING,
             b_string STRING>>
[
  {2, 2, 101, 1000, 10, "two", "hundred_one"},
  {4, 4, 103, 1001, 11, "four", "hundred_three"},
  {6, 2, 102, 1002, 12, "six", "hundred_two"},
  {8, 4, 100, 1003, 13, "eight", "hundred"},
  {10, NULL, 101, 1003, 13, "ten", "hundred_two"},
  {12, NULL, NULL, 1003, 13, "twelve", "hundred"},
  {1, 1, 100, 1000, 10, "one", "hundred"},
  {3, 3, 102, 1001, 11, "three", "hundred_two"},
  {5, 1, 101, 1002, 12, "five", "hundred_one"},
  {7, 3, 103, 1003, 13, "seven", "hundred_three"},
  {9, NULL, NULL, NULL, NULL, "nine", "hundred_one"},
  {11, 4, NULL, 1003, NULL, "eleven", "hundred_three"}
]
==

[name=unpivot_basic]
SELECT * FROM t
  UNPIVOT(x for y in (a, b, c, d)) ORDER BY y;
--
ARRAY<STRUCT<rowid INT64, a_string STRING, b_string STRING, x INT64, y STRING>>[unknown order:
  {6, "six", "hundred_two", 2, "a"},
  {5, "five", "hundred_one", 1, "a"},
  {11, "eleven", "hundred_three", 4, "a"},
  {4, "four", "hundred_three", 4, "a"},
  {3, "three", "hundred_two", 3, "a"},
  {2, "two", "hundred_one", 2, "a"},
  {8, "eight", "hundred", 4, "a"},
  {1, "one", "hundred", 1, "a"},
  {7, "seven", "hundred_three", 3, "a"},
  {6, "six", "hundred_two", 102, "b"},
  {5, "five", "hundred_one", 101, "b"},
  {8, "eight", "hundred", 100, "b"},
  {4, "four", "hundred_three", 103, "b"},
  {10, "ten", "hundred_two", 101, "b"},
  {3, "three", "hundred_two", 102, "b"},
  {2, "two", "hundred_one", 101, "b"},
  {1, "one", "hundred", 100, "b"},
  {7, "seven", "hundred_three", 103, "b"},
  {6, "six", "hundred_two", 1002, "c"},
  {2, "two", "hundred_one", 1000, "c"},
  {11, "eleven", "hundred_three", 1003, "c"},
  {4, "four", "hundred_three", 1001, "c"},
  {10, "ten", "hundred_two", 1003, "c"},
  {3, "three", "hundred_two", 1001, "c"},
  {12, "twelve", "hundred", 1003, "c"},
  {5, "five", "hundred_one", 1002, "c"},
  {8, "eight", "hundred", 1003, "c"},
  {1, "one", "hundred", 1000, "c"},
  {7, "seven", "hundred_three", 1003, "c"},
  {3, "three", "hundred_two", 11, "d"},
  {12, "twelve", "hundred", 13, "d"},
  {5, "five", "hundred_one", 12, "d"},
  {1, "one", "hundred", 10, "d"},
  {7, "seven", "hundred_three", 13, "d"},
  {6, "six", "hundred_two", 12, "d"},
  {2, "two", "hundred_one", 10, "d"},
  {8, "eight", "hundred", 13, "d"},
  {4, "four", "hundred_three", 11, "d"},
  {10, "ten", "hundred_two", 13, "d"}
]
==

[required_features=UNPIVOT,ENFORCE_CONDITIONAL_EVALUATION]
[name=unpivot_conditional_evaluation]
SELECT IF(sum(rowid) > 0, sum(rowid), SUM(1/(rowid-1))) AS x FROM t
  UNPIVOT(x for y in (a, b, c, d));
--
ARRAY<STRUCT<x DOUBLE>>[{220}]
==

[name=unpivot_include_nulls]
SELECT * FROM t
  UNPIVOT INCLUDE NULLS((x, y) for z in ((a, b), (c, d)));
--
ARRAY<STRUCT<rowid INT64,
             a_string STRING,
             b_string STRING,
             x INT64,
             y INT64,
             z STRING>>
[unknown order:
  {8, "eight", "hundred", 4, 100, "a_b"},
  {3, "three", "hundred_two", 3, 102, "a_b"},
  {11, "eleven", "hundred_three", 4, NULL, "a_b"},
  {6, "six", "hundred_two", 2, 102, "a_b"},
  {1, "one", "hundred", 1, 100, "a_b"},
  {9, "nine", "hundred_one", NULL, NULL, "a_b"},
  {4, "four", "hundred_three", 4, 103, "a_b"},
  {12, "twelve", "hundred", NULL, NULL, "a_b"},
  {7, "seven", "hundred_three", 3, 103, "a_b"},
  {2, "two", "hundred_one", 2, 101, "a_b"},
  {10, "ten", "hundred_two", NULL, 101, "a_b"},
  {5, "five", "hundred_one", 1, 101, "a_b"},
  {8, "eight", "hundred", 1003, 13, "c_d"},
  {3, "three", "hundred_two", 1001, 11, "c_d"},
  {11, "eleven", "hundred_three", 1003, NULL, "c_d"},
  {6, "six", "hundred_two", 1002, 12, "c_d"},
  {1, "one", "hundred", 1000, 10, "c_d"},
  {9, "nine", "hundred_one", NULL, NULL, "c_d"},
  {4, "four", "hundred_three", 1001, 11, "c_d"},
  {12, "twelve", "hundred", 1003, 13, "c_d"},
  {7, "seven", "hundred_three", 1003, 13, "c_d"},
  {2, "two", "hundred_one", 1000, 10, "c_d"},
  {10, "ten", "hundred_two", 1003, 13, "c_d"},
  {5, "five", "hundred_one", 1002, 12, "c_d"}
]
==

# Explicit exclude nulls.
[name=unpivot_exclude_nulls]
SELECT * FROM t
  UNPIVOT EXCLUDE NULLS ((x, y) for z in ((a, b), (c, d)));
--
ARRAY<STRUCT<rowid INT64,
             a_string STRING,
             b_string STRING,
             x INT64,
             y INT64,
             z STRING>>
[unknown order:
  {3, "three", "hundred_two", 3, 102, "a_b"},
  {6, "six", "hundred_two", 2, 102, "a_b"},
  {2, "two", "hundred_one", 2, 101, "a_b"},
  {5, "five", "hundred_one", 1, 101, "a_b"},
  {3, "three", "hundred_two", 1001, 11, "c_d"},
  {6, "six", "hundred_two", 1002, 12, "c_d"},
  {12, "twelve", "hundred", 1003, 13, "c_d"},
  {2, "two", "hundred_one", 1000, 10, "c_d"},
  {5, "five", "hundred_one", 1002, 12, "c_d"},
  {8, "eight", "hundred", 4, 100, "a_b"},
  {11, "eleven", "hundred_three", 4, NULL, "a_b"},
  {1, "one", "hundred", 1, 100, "a_b"},
  {4, "four", "hundred_three", 4, 103, "a_b"},
  {7, "seven", "hundred_three", 3, 103, "a_b"},
  {10, "ten", "hundred_two", NULL, 101, "a_b"},
  {8, "eight", "hundred", 1003, 13, "c_d"},
  {11, "eleven", "hundred_three", 1003, NULL, "c_d"},
  {1, "one", "hundred", 1000, 10, "c_d"},
  {4, "four", "hundred_three", 1001, 11, "c_d"},
  {7, "seven", "hundred_three", 1003, 13, "c_d"},
  {10, "ten", "hundred_two", 1003, 13, "c_d"}
]
==

[name=subquery]
SELECT * FROM (SELECT a, b FROM t)
  UNPIVOT(x for y in (a, b)) ORDER BY y;
--
ARRAY<STRUCT<x INT64, y STRING>>[unknown order:
  {2, "a"},
  {1, "a"},
  {4, "a"},
  {4, "a"},
  {3, "a"},
  {2, "a"},
  {4, "a"},
  {1, "a"},
  {3, "a"},
  {102, "b"},
  {101, "b"},
  {100, "b"},
  {103, "b"},
  {101, "b"},
  {102, "b"},
  {101, "b"},
  {100, "b"},
  {103, "b"}
]
==

[name=multiple_value_columns]
SELECT * FROM t
  UNPIVOT((xx, yy) for zz in ((a, b), (c, d))) ORDER BY zz;
--
ARRAY<STRUCT<rowid INT64,
             a_string STRING,
             b_string STRING,
             xx INT64,
             yy INT64,
             zz STRING>>
[unknown order:
  {6, "six", "hundred_two", 2, 102, "a_b"},
  {5, "five", "hundred_one", 1, 101, "a_b"},
  {8, "eight", "hundred", 4, 100, "a_b"},
  {1, "one", "hundred", 1, 100, "a_b"},
  {7, "seven", "hundred_three", 3, 103, "a_b"},
  {3, "three", "hundred_two", 3, 102, "a_b"},
  {2, "two", "hundred_one", 2, 101, "a_b"},
  {11, "eleven", "hundred_three", 4, NULL, "a_b"},
  {4, "four", "hundred_three", 4, 103, "a_b"},
  {10, "ten", "hundred_two", NULL, 101, "a_b"},
  {6, "six", "hundred_two", 1002, 12, "c_d"},
  {2, "two", "hundred_one", 1000, 10, "c_d"},
  {8, "eight", "hundred", 1003, 13, "c_d"},
  {1, "one", "hundred", 1000, 10, "c_d"},
  {7, "seven", "hundred_three", 1003, 13, "c_d"},
  {3, "three", "hundred_two", 1001, 11, "c_d"},
  {12, "twelve", "hundred", 1003, 13, "c_d"},
  {5, "five", "hundred_one", 1002, 12, "c_d"},
  {11, "eleven", "hundred_three", 1003, NULL, "c_d"},
  {4, "four", "hundred_three", 1001, 11, "c_d"},
  {10, "ten", "hundred_two", 1003, 13, "c_d"}
]
==

[name=multiple_value_with_mix_datatypes]
SELECT * FROM t
  UNPIVOT((int_value, string_value) for label_value in ((a, a_string), (b, b_string))) ORDER BY label_value;
--
ARRAY<STRUCT<rowid INT64,
             c INT64,
             d INT64,
             int_value INT64,
             string_value STRING,
             label_value STRING>>
[unknown order:
  {6, 1002, 12, 2, "six", "a_a_string"},
  {12, 1003, 13, NULL, "twelve", "a_a_string"},
  {5, 1002, 12, 1, "five", "a_a_string"},
  {11, 1003, NULL, 4, "eleven", "a_a_string"},
  {4, 1001, 11, 4, "four", "a_a_string"},
  {10, 1003, 13, NULL, "ten", "a_a_string"},
  {3, 1001, 11, 3, "three", "a_a_string"},
  {9, NULL, NULL, NULL, "nine", "a_a_string"},
  {2, 1000, 10, 2, "two", "a_a_string"},
  {8, 1003, 13, 4, "eight", "a_a_string"},
  {1, 1000, 10, 1, "one", "a_a_string"},
  {7, 1003, 13, 3, "seven", "a_a_string"},
  {6, 1002, 12, 102, "hundred_two", "b_b_string"},
  {12, 1003, 13, NULL, "hundred", "b_b_string"},
  {5, 1002, 12, 101, "hundred_one", "b_b_string"},
  {11, 1003, NULL, NULL, "hundred_three", "b_b_string"},
  {4, 1001, 11, 103, "hundred_three", "b_b_string"},
  {10, 1003, 13, 101, "hundred_two", "b_b_string"},
  {3, 1001, 11, 102, "hundred_two", "b_b_string"},
  {9, NULL, NULL, NULL, "hundred_one", "b_b_string"},
  {2, 1000, 10, 101, "hundred_one", "b_b_string"},
  {8, 1003, 13, 100, "hundred", "b_b_string"},
  {1, 1000, 10, 100, "hundred", "b_b_string"},
  {7, 1003, 13, 103, "hundred_three", "b_b_string"}
]
==

[name=additional_select_1]
SELECT 1, * FROM t
  UNPIVOT(x for y in (a, b, c, d)) ORDER BY y;
--
ARRAY<STRUCT<INT64,
             rowid INT64,
             a_string STRING,
             b_string STRING,
             x INT64,
             y STRING>>
[unknown order:
  {1, 5, "five", "hundred_one", 1, "a"},
  {1, 11, "eleven", "hundred_three", 4, "a"},
  {1, 3, "three", "hundred_two", 3, "a"},
  {1, 1, "one", "hundred", 1, "a"},
  {1, 6, "six", "hundred_two", 2, "a"},
  {1, 4, "four", "hundred_three", 4, "a"},
  {1, 2, "two", "hundred_one", 2, "a"},
  {1, 8, "eight", "hundred", 4, "a"},
  {1, 7, "seven", "hundred_three", 3, "a"},
  {1, 5, "five", "hundred_one", 101, "b"},
  {1, 8, "eight", "hundred", 100, "b"},
  {1, 10, "ten", "hundred_two", 101, "b"},
  {1, 3, "three", "hundred_two", 102, "b"},
  {1, 1, "one", "hundred", 100, "b"},
  {1, 6, "six", "hundred_two", 102, "b"},
  {1, 4, "four", "hundred_three", 103, "b"},
  {1, 2, "two", "hundred_one", 101, "b"},
  {1, 7, "seven", "hundred_three", 103, "b"},
  {1, 2, "two", "hundred_one", 1000, "c"},
  {1, 4, "four", "hundred_three", 1001, "c"},
  {1, 3, "three", "hundred_two", 1001, "c"},
  {1, 5, "five", "hundred_one", 1002, "c"},
  {1, 8, "eight", "hundred", 1003, "c"},
  {1, 7, "seven", "hundred_three", 1003, "c"},
  {1, 6, "six", "hundred_two", 1002, "c"},
  {1, 11, "eleven", "hundred_three", 1003, "c"},
  {1, 10, "ten", "hundred_two", 1003, "c"},
  {1, 12, "twelve", "hundred", 1003, "c"},
  {1, 1, "one", "hundred", 1000, "c"},
  {1, 12, "twelve", "hundred", 13, "d"},
  {1, 1, "one", "hundred", 10, "d"},
  {1, 2, "two", "hundred_one", 10, "d"},
  {1, 4, "four", "hundred_three", 11, "d"},
  {1, 3, "three", "hundred_two", 11, "d"},
  {1, 5, "five", "hundred_one", 12, "d"},
  {1, 7, "seven", "hundred_three", 13, "d"},
  {1, 6, "six", "hundred_two", 12, "d"},
  {1, 8, "eight", "hundred", 13, "d"},
  {1, 10, "ten", "hundred_two", 13, "d"}
]
==

[name=join]
SELECT x1, y1 FROM t, t UNPIVOT(x1 for y1 in (a, b, c, d)) ORDER BY y1;
--
ARRAY<STRUCT<x1 INT64, y1 STRING>>[unknown order:
  {1, "a"},
  {4, "a"},
  {3, "a"},
  {1, "a"},
  {2, "a"},
  {4, "a"},
  {2, "a"},
  {4, "a"},
  {3, "a"},
  {1, "a"},
  {4, "a"},
  {3, "a"},
  {2, "a"},
  {4, "a"},
  {2, "a"},
  {4, "a"},
  {3, "a"},
  {1, "a"},
  {4, "a"},
  {3, "a"},
  {1, "a"},
  {2, "a"},
  {4, "a"},
  {2, "a"},
  {1, "a"},
  {2, "a"},
  {4, "a"},
  {2, "a"},
  {4, "a"},
  {3, "a"},
  {1, "a"},
  {4, "a"},
  {3, "a"},
  {1, "a"},
  {2, "a"},
  {4, "a"},
  {3, "a"},
  {1, "a"},
  {4, "a"},
  {3, "a"},
  {1, "a"},
  {2, "a"},
  {4, "a"},
  {2, "a"},
  {4, "a"},
  {3, "a"},
  {1, "a"},
  {4, "a"},
  {2, "a"},
  {4, "a"},
  {3, "a"},
  {1, "a"},
  {4, "a"},
  {3, "a"},
  {1, "a"},
  {2, "a"},
  {4, "a"},
  {2, "a"},
  {4, "a"},
  {3, "a"},
  {1, "a"},
  {2, "a"},
  {4, "a"},
  {2, "a"},
  {4, "a"},
  {3, "a"},
  {1, "a"},
  {4, "a"},
  {3, "a"},
  {4, "a"},
  {3, "a"},
  {1, "a"},
  {4, "a"},
  {3, "a"},
  {1, "a"},
  {2, "a"},
  {4, "a"},
  {2, "a"},
  {4, "a"},
  {3, "a"},
  {1, "a"},
  {4, "a"},
  {1, "a"},
  {2, "a"},
  {4, "a"},
  {2, "a"},
  {4, "a"},
  {3, "a"},
  {1, "a"},
  {4, "a"},
  {3, "a"},
  {1, "a"},
  {2, "a"},
  {3, "a"},
  {1, "a"},
  {2, "a"},
  {4, "a"},
  {2, "a"},
  {4, "a"},
  {3, "a"},
  {4, "a"},
  {2, "a"},
  {4, "a"},
  {3, "a"},
  {1, "a"},
  {4, "a"},
  {3, "a"},
  {1, "a"},
  {101, "b"},
  {100, "b"},
  {101, "b"},
  {102, "b"},
  {100, "b"},
  {102, "b"},
  {103, "b"},
  {101, "b"},
  {103, "b"},
  {101, "b"},
  {100, "b"},
  {101, "b"},
  {102, "b"},
  {102, "b"},
  {103, "b"},
  {101, "b"},
  {103, "b"},
  {101, "b"},
  {100, "b"},
  {101, "b"},
  {102, "b"},
  {100, "b"},
  {102, "b"},
  {103, "b"},
  {100, "b"},
  {102, "b"},
  {103, "b"},
  {101, "b"},
  {103, "b"},
  {101, "b"},
  {100, "b"},
  {101, "b"},
  {102, "b"},
  {100, "b"},
  {102, "b"},
  {101, "b"},
  {103, "b"},
  {101, "b"},
  {100, "b"},
  {101, "b"},
  {102, "b"},
  {100, "b"},
  {102, "b"},
  {103, "b"},
  {101, "b"},
  {103, "b"},
  {101, "b"},
  {103, "b"},
  {101, "b"},
  {103, "b"},
  {101, "b"},
  {100, "b"},
  {101, "b"},
  {102, "b"},
  {100, "b"},
  {102, "b"},
  {103, "b"},
  {101, "b"},
  {100, "b"},
  {101, "b"},
  {102, "b"},
  {100, "b"},
  {102, "b"},
  {103, "b"},
  {101, "b"},
  {103, "b"},
  {101, "b"},
  {100, "b"},
  {101, "b"},
  {102, "b"},
  {103, "b"},
  {101, "b"},
  {100, "b"},
  {101, "b"},
  {102, "b"},
  {100, "b"},
  {102, "b"},
  {103, "b"},
  {101, "b"},
  {103, "b"},
  {101, "b"},
  {100, "b"},
  {102, "b"},
  {103, "b"},
  {101, "b"},
  {103, "b"},
  {101, "b"},
  {100, "b"},
  {101, "b"},
  {102, "b"},
  {100, "b"},
  {102, "b"},
  {100, "b"},
  {101, "b"},
  {102, "b"},
  {100, "b"},
  {102, "b"},
  {103, "b"},
  {101, "b"},
  {103, "b"},
  {103, "b"},
  {101, "b"},
  {103, "b"},
  {101, "b"},
  {100, "b"},
  {101, "b"},
  {102, "b"},
  {100, "b"},
  {1000, "c"},
  {1001, "c"},
  {1001, "c"},
  {1002, "c"},
  {1003, "c"},
  {1003, "c"},
  {1002, "c"},
  {1003, "c"},
  {1003, "c"},
  {1003, "c"},
  {1000, "c"},
  {1000, "c"},
  {1001, "c"},
  {1002, "c"},
  {1003, "c"},
  {1003, "c"},
  {1003, "c"},
  {1000, "c"},
  {1000, "c"},
  {1001, "c"},
  {1001, "c"},
  {1002, "c"},
  {1003, "c"},
  {1003, "c"},
  {1002, "c"},
  {1003, "c"},
  {1003, "c"},
  {1001, "c"},
  {1002, "c"},
  {1003, "c"},
  {1003, "c"},
  {1002, "c"},
  {1003, "c"},
  {1003, "c"},
  {1003, "c"},
  {1000, "c"},
  {1000, "c"},
  {1001, "c"},
  {1001, "c"},
  {1002, "c"},
  {1003, "c"},
  {1003, "c"},
  {1002, "c"},
  {1003, "c"},
  {1000, "c"},
  {1000, "c"},
  {1001, "c"},
  {1001, "c"},
  {1002, "c"},
  {1003, "c"},
  {1003, "c"},
  {1002, "c"},
  {1003, "c"},
  {1003, "c"},
  {1003, "c"},
  {1000, "c"},
  {1003, "c"},
  {1003, "c"},
  {1003, "c"},
  {1000, "c"},
  {1000, "c"},
  {1001, "c"},
  {1001, "c"},
  {1002, "c"},
  {1003, "c"},
  {1003, "c"},
  {1002, "c"},
  {1003, "c"},
  {1003, "c"},
  {1003, "c"},
  {1000, "c"},
  {1001, "c"},
  {1001, "c"},
  {1002, "c"},
  {1003, "c"},
  {1003, "c"},
  {1002, "c"},
  {1003, "c"},
  {1003, "c"},
  {1003, "c"},
  {1000, "c"},
  {1000, "c"},
  {1001, "c"},
  {1001, "c"},
  {1002, "c"},
  {1000, "c"},
  {1000, "c"},
  {1001, "c"},
  {1001, "c"},
  {1002, "c"},
  {1003, "c"},
  {1003, "c"},
  {1002, "c"},
  {1003, "c"},
  {1003, "c"},
  {1003, "c"},
  {1000, "c"},
  {1000, "c"},
  {1003, "c"},
  {1003, "c"},
  {1002, "c"},
  {1003, "c"},
  {1003, "c"},
  {1003, "c"},
  {1000, "c"},
  {1000, "c"},
  {1001, "c"},
  {1001, "c"},
  {1002, "c"},
  {1003, "c"},
  {1003, "c"},
  {1002, "c"},
  {1001, "c"},
  {1001, "c"},
  {1002, "c"},
  {1003, "c"},
  {1003, "c"},
  {1002, "c"},
  {1003, "c"},
  {1003, "c"},
  {1003, "c"},
  {1000, "c"},
  {1003, "c"},
  {1003, "c"},
  {1003, "c"},
  {1000, "c"},
  {1000, "c"},
  {1001, "c"},
  {1001, "c"},
  {1002, "c"},
  {1003, "c"},
  {1003, "c"},
  {13, "d"},
  {10, "d"},
  {10, "d"},
  {11, "d"},
  {11, "d"},
  {12, "d"},
  {13, "d"},
  {12, "d"},
  {13, "d"},
  {13, "d"},
  {13, "d"},
  {10, "d"},
  {11, "d"},
  {12, "d"},
  {13, "d"},
  {12, "d"},
  {13, "d"},
  {13, "d"},
  {13, "d"},
  {10, "d"},
  {10, "d"},
  {11, "d"},
  {11, "d"},
  {12, "d"},
  {13, "d"},
  {10, "d"},
  {11, "d"},
  {11, "d"},
  {12, "d"},
  {13, "d"},
  {12, "d"},
  {13, "d"},
  {13, "d"},
  {13, "d"},
  {10, "d"},
  {10, "d"},
  {11, "d"},
  {12, "d"},
  {13, "d"},
  {13, "d"},
  {13, "d"},
  {10, "d"},
  {10, "d"},
  {11, "d"},
  {11, "d"},
  {12, "d"},
  {13, "d"},
  {12, "d"},
  {13, "d"},
  {13, "d"},
  {11, "d"},
  {12, "d"},
  {13, "d"},
  {12, "d"},
  {13, "d"},
  {13, "d"},
  {13, "d"},
  {10, "d"},
  {10, "d"},
  {11, "d"},
  {11, "d"},
  {12, "d"},
  {13, "d"},
  {12, "d"},
  {13, "d"},
  {10, "d"},
  {10, "d"},
  {11, "d"},
  {11, "d"},
  {12, "d"},
  {13, "d"},
  {12, "d"},
  {13, "d"},
  {13, "d"},
  {13, "d"},
  {10, "d"},
  {13, "d"},
  {13, "d"},
  {13, "d"},
  {10, "d"},
  {10, "d"},
  {11, "d"},
  {11, "d"},
  {12, "d"},
  {13, "d"},
  {12, "d"},
  {13, "d"},
  {13, "d"},
  {13, "d"},
  {10, "d"},
  {11, "d"},
  {11, "d"},
  {12, "d"},
  {13, "d"},
  {12, "d"},
  {13, "d"},
  {13, "d"},
  {13, "d"},
  {10, "d"},
  {10, "d"},
  {11, "d"},
  {11, "d"},
  {12, "d"},
  {10, "d"},
  {10, "d"},
  {11, "d"},
  {11, "d"},
  {12, "d"},
  {13, "d"},
  {12, "d"},
  {13, "d"},
  {13, "d"},
  {13, "d"},
  {12, "d"},
  {13, "d"},
  {13, "d"},
  {13, "d"},
  {10, "d"},
  {10, "d"},
  {11, "d"}
]
==

[name=qualified_names]
SELECT * FROM t UNPIVOT(val_col FOR label_col IN (t.a, t.b)) ORDER BY label_col;
--
ARRAY<STRUCT<rowid INT64,
             c INT64,
             d INT64,
             a_string STRING,
             b_string STRING,
             val_col INT64,
             label_col STRING>>
[unknown order:
  {6, 1002, 12, "six", "hundred_two", 2, "a"},
  {5, 1002, 12, "five", "hundred_one", 1, "a"},
  {11, 1003, NULL, "eleven", "hundred_three", 4, "a"},
  {4, 1001, 11, "four", "hundred_three", 4, "a"},
  {3, 1001, 11, "three", "hundred_two", 3, "a"},
  {2, 1000, 10, "two", "hundred_one", 2, "a"},
  {8, 1003, 13, "eight", "hundred", 4, "a"},
  {1, 1000, 10, "one", "hundred", 1, "a"},
  {7, 1003, 13, "seven", "hundred_three", 3, "a"},
  {6, 1002, 12, "six", "hundred_two", 102, "b"},
  {5, 1002, 12, "five", "hundred_one", 101, "b"},
  {8, 1003, 13, "eight", "hundred", 100, "b"},
  {4, 1001, 11, "four", "hundred_three", 103, "b"},
  {10, 1003, 13, "ten", "hundred_two", 101, "b"},
  {3, 1001, 11, "three", "hundred_two", 102, "b"},
  {2, 1000, 10, "two", "hundred_one", 101, "b"},
  {1, 1000, 10, "one", "hundred", 100, "b"},
  {7, 1003, 13, "seven", "hundred_three", 103, "b"}
]
==

[name=two_unpivots]
SELECT * FROM (SELECT unpivot1_w, unpivot1_x FROM t UNPIVOT(unpivot1_w for unpivot1_x in (a, b))) UNPIVOT (unpivot2_y for unpivot2_z in (unpivot1_x)) ORDER BY unpivot1_w;
--
ARRAY<STRUCT<unpivot1_w INT64, unpivot2_y STRING, unpivot2_z STRING>>[known order:
  {1, "a", "unpivot1_x"},
  {1, "a", "unpivot1_x"},
  {2, "a", "unpivot1_x"},
  {2, "a", "unpivot1_x"},
  {3, "a", "unpivot1_x"},
  {3, "a", "unpivot1_x"},
  {4, "a", "unpivot1_x"},
  {4, "a", "unpivot1_x"},
  {4, "a", "unpivot1_x"},
  {100, "b", "unpivot1_x"},
  {100, "b", "unpivot1_x"},
  {101, "b", "unpivot1_x"},
  {101, "b", "unpivot1_x"},
  {101, "b", "unpivot1_x"},
  {102, "b", "unpivot1_x"},
  {102, "b", "unpivot1_x"},
  {103, "b", "unpivot1_x"},
  {103, "b", "unpivot1_x"}
]
==
# Make sure that multiple copies of non-deterministic expressions in the input
# all produce the same value in the UNPIVOT result.
[name=unpivot_non_deterministic_input]
SELECT rowid, a_string, b_string, COUNT(DISTINCT r) FROM (
  SELECT *, RAND() AS r FROM t
) UNPIVOT(x for y in (a, b, c, d))
GROUP BY rowid, a_string, b_string;
--
ARRAY<STRUCT<rowid INT64, a_string STRING, b_string STRING, INT64>>[unknown order:
  {1, "one", "hundred", 1},
  {2, "two", "hundred_one", 1},
  {3, "three", "hundred_two", 1},
  {4, "four", "hundred_three", 1},
  {5, "five", "hundred_one", 1},
  {6, "six", "hundred_two", 1},
  {7, "seven", "hundred_three", 1},
  {8, "eight", "hundred", 1},
  {10, "ten", "hundred_two", 1},
  {11, "eleven", "hundred_three", 1},
  {12, "twelve", "hundred", 1}
]
