# Functions from (broken link)

###---------------------------------------------------------------------
### LAST_DAY
###---------------------------------------------------------------------
[required_features=ADDITIONAL_STRING_FUNCTIONS,WEEK_WITH_WEEKDAY,CIVIL_TIME]
[name=last_day_date]
select
  last_day(date '2020-07-10', YEAR),
  last_day(date '2020-06-10', MONTH),
  last_day(date '2020-06-10'),
  last_day(date '2020-07-10', QUARTER),
  last_day(date '2020-07-24', WEEK),
  last_day(date '2020-07-24', WEEK(MONDAY)),
  last_day(date '0001-01-01', ISOYEAR)
--
ARRAY<STRUCT<DATE, DATE, DATE, DATE, DATE, DATE, DATE>>[
  {2020-12-31,
   2020-06-30,
   2020-06-30,
   2020-09-30,
   2020-07-25,
   2020-07-26,
   0001-12-30}
]
==

[required_features=ADDITIONAL_STRING_FUNCTIONS,WEEK_WITH_WEEKDAY,CIVIL_TIME]
[name=last_day_datetime]
select
  last_day(datetime '2020-07-10 12:34:56', YEAR),
  last_day(datetime '2020-06-10 12:34:56', MONTH),
  last_day(datetime '2020-06-10 12:34:56'),
  last_day(datetime '2020-07-10 12:34:56', QUARTER),
  last_day(datetime '2020-07-24 12:34:56', WEEK),
  last_day(datetime '2020-07-24 12:34:56', WEEK(MONDAY)),
  last_day(datetime '0001-01-01 12:34:56', ISOYEAR)
--
ARRAY<STRUCT<DATE, DATE, DATE, DATE, DATE, DATE, DATE>>[
  {2020-12-31,
   2020-06-30,
   2020-06-30,
   2020-09-30,
   2020-07-25,
   2020-07-26,
   0001-12-30}
]
==

###---------------------------------------------------------------------
### ADD_MONTHS
###---------------------------------------------------------------------
[name=add_months_date_basic]
[required_features=ADDITIONAL_DATE_TIME_FUNCTIONS]
SELECT
  -- basic functionality
  ADD_MONTHS("1998-09-04", 0),
  ADD_MONTHS("1925-03-15", 14),
  ADD_MONTHS("1925-03-15", -1),
  -- end-of-month behavior when target month is longer
  ADD_MONTHS("2025-02-28", 1),
  ADD_MONTHS("2025-02-28", -1),
  ADD_MONTHS("9999-02-28", 10),
  -- end-of-month behavior when target month is shorter
  ADD_MONTHS("2025-01-31", 1),
  ADD_MONTHS("2025-12-31", -1),
  ADD_MONTHS("0001-07-31", -5)
--
ARRAY<STRUCT<DATE, DATE, DATE, DATE, DATE, DATE, DATE, DATE, DATE>>[
  {1998-09-04,
   1926-05-15,
   1925-02-15,
   2025-03-31,
   2025-01-31,
   9999-12-31,
   2025-02-28,
   2025-11-30,
   0001-02-28}
]
==

[name=add_months_datetime_basic]
[required_features=ADDITIONAL_DATE_TIME_FUNCTIONS,CIVIL_TIME]
SELECT
  -- basic functionality
  ADD_MONTHS(DATETIME "1998-09-04 12:34:50", 0),
  ADD_MONTHS(DATETIME "1925-03-15 12:34:50", 14),
  ADD_MONTHS(DATETIME "1925-03-15 12:34:50", -1),
  -- end-of-month behavior when target month is longer
  ADD_MONTHS(DATETIME "2025-02-28 12:34:51", 1),
  ADD_MONTHS(DATETIME "2025-02-28 12:34:51", -1),
  ADD_MONTHS(DATETIME "9999-02-28 12:34:51", 10),
  -- end-of-month behavior when target month is shorter
  ADD_MONTHS(DATETIME "2025-01-31 12:34:52", 1),
  ADD_MONTHS(DATETIME "2025-12-31 12:34:52", -1),
  ADD_MONTHS(DATETIME "0001-07-31 12:34:52", -5)
--
ARRAY<STRUCT<DATETIME,
             DATETIME,
             DATETIME,
             DATETIME,
             DATETIME,
             DATETIME,
             DATETIME,
             DATETIME,
             DATETIME>>
[{1998-09-04 12:34:50,
  1926-05-15 12:34:50,
  1925-02-15 12:34:50,
  2025-03-31 12:34:51,
  2025-01-31 12:34:51,
  9999-12-31 12:34:51,
  2025-02-28 12:34:52,
  2025-11-30 12:34:52,
  0001-02-28 12:34:52}]
==

[name=add_months_date_null]
[required_features=ADDITIONAL_DATE_TIME_FUNCTIONS]
SELECT
  ADD_MONTHS(CAST(NULL as DATE), 100),
  ADD_MONTHS("1925-03-15", CAST(NULL as INT64)),
  ADD_MONTHS(CAST(NULL as DATE), CAST(NULL as INT64))
--
ARRAY<STRUCT<DATE, DATE, DATE>>[{NULL, NULL, NULL}]
==

[name=add_months_datetime_null]
[required_features=ADDITIONAL_DATE_TIME_FUNCTIONS,CIVIL_TIME]
SELECT
  ADD_MONTHS(CAST(NULL as DATETIME), 100),
  ADD_MONTHS(DATETIME "1925-03-15 03:14:15", CAST(NULL as INT64)),
  ADD_MONTHS(CAST(NULL as DATETIME), CAST(NULL as INT64))
--
ARRAY<STRUCT<DATETIME, DATETIME, DATETIME>>[{NULL, NULL, NULL}]
==

[name=add_months_date_overflow]
[required_features=ADDITIONAL_DATE_TIME_FUNCTIONS]
SELECT ADD_MONTHS("9999-12-25", 1)
--
ERROR: generic::out_of_range: Adding 1 MONTH to date 9999-12-25 causes overflow
==

[name=add_months_datetime_overflow]
[required_features=ADDITIONAL_DATE_TIME_FUNCTIONS,CIVIL_TIME]
SELECT ADD_MONTHS(DATETIME "0001-12-25 01:02:03", -13)
--
ERROR: generic::out_of_range: Adding -13 MONTH to date 0001-12-25 causes overflow
==

###---------------------------------------------------------------------
### NEXT_DAY
###---------------------------------------------------------------------
[name=next_day_date_basic]
[required_features=ADDITIONAL_DATE_TIME_FUNCTIONS]
select
  next_day("2025-10-09", "wed"),
  next_day("2025-10-09", "Wednesday"),
  next_day("2025-10-09", "Thu")                      -- already a Thursday
--
ARRAY<STRUCT<DATE, DATE, DATE>>[{2025-10-15, 2025-10-15, 2025-10-16}]
==

[name=next_day_datetime_basic]
[required_features=ADDITIONAL_DATE_TIME_FUNCTIONS,CIVIL_TIME]
select
  next_day(datetime "2025-10-09 01:02:03", "wed"),
  next_day(datetime "2025-10-09 03:01:02", "Wednesday"),
  next_day(datetime "2025-10-09 02:03:01", "Thu")        -- already a Thursday
--
ARRAY<STRUCT<DATE, DATE, DATE>>[{2025-10-15, 2025-10-15, 2025-10-16}]
==

[name=next_day_date_null]
[required_features=ADDITIONAL_DATE_TIME_FUNCTIONS]
select
  next_day(cast(null as date), "Sunday"),
  next_day("2025-09-09", cast(null as string))
--
ARRAY<STRUCT<DATE, DATE>>[{NULL, NULL}]
==

[name=next_day_datetime_null]
[required_features=ADDITIONAL_DATE_TIME_FUNCTIONS,CIVIL_TIME]
select
  next_day(cast(null as datetime), "Sunday"),
  next_day(datetime "2025-09-09 01:02:03", cast(null as string))
--
ARRAY<STRUCT<DATE, DATE>>[{NULL, NULL}]
==

[name=next_day_date_overflow]
[required_features=ADDITIONAL_DATE_TIME_FUNCTIONS]
select next_day("9999-12-31", "Mon")
--
ERROR: generic::out_of_range: Next day of 9999-12-31 resulted in an out of range date value: 2932899
==

[name=next_day_datetime_overflow]
[required_features=ADDITIONAL_DATE_TIME_FUNCTIONS,CIVIL_TIME]
select next_day(datetime "9999-12-31 11:22:33", "Mon")
--
ERROR: generic::out_of_range: Next day of 9999-12-31 resulted in an out of range date value: 2932899
==

[name=next_day_date_invalid]
[required_features=ADDITIONAL_DATE_TIME_FUNCTIONS]
select next_day("2025-10-09", "Moonday")
--
ERROR: generic::out_of_range: Invalid day of week: Moonday
==

[name=next_day_datetime_invalid]
[required_features=ADDITIONAL_DATE_TIME_FUNCTIONS,CIVIL_TIME]
select next_day(datetime "2025-10-09 10:20:30", "Moonday")
--
ERROR: generic::out_of_range: Invalid day of week: Moonday
==

###---------------------------------------------------------------------
### MONTHS_BETWEEN
###---------------------------------------------------------------------
[name=months_between_date_basic]
[required_features=ADDITIONAL_DATE_TIME_FUNCTIONS]
select
  months_between("2025-03-14", "2025-02-13"),   -- 1+1/31
  months_between("2025-03-01", "2025-02-15"),   -- 1-14/31
  months_between("2025-02-15", "2025-03-01"),   -- -1+14/31
  months_between("2025-11-14", "2025-10-14"),   -- 1 (same day of month)
  months_between("2025-11-30", "2024-10-31")    -- 13 (both end of month)
--
ARRAY<STRUCT<DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE>>[
  {1.032258064516129, 0.54838709677419351, -0.54838709677419351, 1, 13}
]
==

[name=months_between_datetime_basic]
[required_features=ADDITIONAL_DATE_TIME_FUNCTIONS,CIVIL_TIME]
select
  months_between(datetime "2025-03-14", datetime "2025-02-13"),   -- 1+1/31
  months_between(datetime "2025-03-01", datetime "2025-02-15"),   -- 1-14/31
  months_between(datetime "2025-02-15", datetime "2025-03-01"),   -- -1+14/31
  -- Time considered: Half a day -> 0.5/31
  months_between(datetime "2008-02-29", datetime "2008-02-28 12:00:00"),
  -- Same day or end-of-month, time ignored.
  months_between(datetime "2025-11-14 01:02:03", datetime "2025-10-14"),
  months_between(datetime "2025-11-30", datetime "2024-10-31 12:34:56")
--
ARRAY<STRUCT<DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE>>[
  {1.032258064516129,
   0.54838709677419351,
   -0.54838709677419351,
   0.016129032258064516,
   1,
   13}
]
==

[name=months_between_date_null]
[required_features=ADDITIONAL_DATE_TIME_FUNCTIONS]
select
  months_between(cast(null as date), "2025-02-13"),
  months_between("2025-03-01", cast(null as date)),
  months_between(cast(null as date), cast(null as date))
--
ARRAY<STRUCT<DOUBLE, DOUBLE, DOUBLE>>[{NULL, NULL, NULL}]
==

[name=months_between_datetime_null]
[required_features=ADDITIONAL_DATE_TIME_FUNCTIONS,CIVIL_TIME]
select
  months_between(cast(null as datetime), datetime "2025-02-13"),
  months_between(datetime "2025-03-01", cast(null as datetime)),
  months_between(cast(null as datetime), cast(null as datetime))
--
ARRAY<STRUCT<DOUBLE, DOUBLE, DOUBLE>>[{NULL, NULL, NULL}]
