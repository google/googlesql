# The function KLL_QUANTILES.INIT has different signatures depending whether the
# language feature FEATURE_KLL_WEIGHTS is enabled. If enabled, the INIT
# function can take in an optional named argument `weight`.

# Start section: KLL INIT no input rows. Test cases are
# repeated for four types of concrete signatures:
# - input only
# - input + precision
# - input + weight
# - input + precision + weight
# All test cases should return NULL.
[name=init_int64_no_input_rows_input]
SELECT
  KLL_QUANTILES.INIT_INT64(x) AS sketch
FROM
  UNNEST(ARRAY< INT64 >[]) AS x;
--
ARRAY<STRUCT<sketch BYTES>>[{NULL}]
==
[name=init_uint64_no_input_rows_input]
SELECT
  KLL_QUANTILES.INIT_UINT64(x) AS sketch
FROM
  UNNEST(ARRAY< UINT64 >[]) AS x;
--
ARRAY<STRUCT<sketch BYTES>>[{NULL}]
==
[name=init_double_no_input_rows_input]
SELECT
  KLL_QUANTILES.INIT_DOUBLE(x) AS sketch
FROM
  UNNEST(ARRAY< DOUBLE >[]) AS x;
--
ARRAY<STRUCT<sketch BYTES>>[{NULL}]
==
[name=init_int64_no_input_rows_input_precision]
SELECT
  KLL_QUANTILES.INIT_INT64(x, 2000) AS sketch
FROM
  UNNEST(ARRAY< INT64 >[]) AS x;
--
ARRAY<STRUCT<sketch BYTES>>[{NULL}]
==
[name=init_uint64_no_input_rows_input_precision]
SELECT
  KLL_QUANTILES.INIT_UINT64(x, 2000) AS sketch
FROM
  UNNEST(ARRAY< UINT64 >[]) AS x;
--
ARRAY<STRUCT<sketch BYTES>>[{NULL}]
==
[name=init_double_no_input_rows_input_precision]
SELECT
  KLL_QUANTILES.INIT_DOUBLE(x, 2000) AS sketch
FROM
  UNNEST(ARRAY< DOUBLE >[]) AS x;
--
ARRAY<STRUCT<sketch BYTES>>[{NULL}]
==
[name=init_int64_no_input_rows_input_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.INIT_INT64(x.input, weight  => x.weight) AS sketch
FROM
  UNNEST(ARRAY< STRUCT< input INT64, weight INT64 > >[]) AS x;
--
ARRAY<STRUCT<sketch BYTES>>[{NULL}]
==
[name=init_uint64_no_input_rows_input_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.INIT_UINT64(x.input, weight  => x.weight) AS sketch
FROM
  UNNEST(ARRAY< STRUCT< input UINT64, weight INT64 > >[]) AS x;
--
ARRAY<STRUCT<sketch BYTES>>[{NULL}]
==
[name=init_double_no_input_rows_input_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.INIT_DOUBLE(x.input, weight  => x.weight) AS sketch
FROM
  UNNEST(ARRAY< STRUCT< input DOUBLE, weight INT64 > >[]) AS x;
--
ARRAY<STRUCT<sketch BYTES>>[{NULL}]
==
[name=init_int64_no_input_rows_input_precision_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.INIT_INT64(x.input, 2000, weight  => x.weight) AS sketch
FROM
  UNNEST(ARRAY< STRUCT< input INT64, weight INT64 > >[]) AS x;
--
ARRAY<STRUCT<sketch BYTES>>[{NULL}]
==
[name=init_uint64_no_input_rows_input_precision_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.INIT_UINT64(x.input, 2000, weight  => x.weight) AS sketch
FROM
  UNNEST(ARRAY< STRUCT< input UINT64, weight INT64 > >[]) AS x;
--
ARRAY<STRUCT<sketch BYTES>>[{NULL}]
==
[name=init_double_no_input_rows_input_precision_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.INIT_DOUBLE(x.input, 2000, weight  => x.weight) AS sketch
FROM
  UNNEST(ARRAY< STRUCT< input DOUBLE, weight INT64 > >[]) AS x;
--
ARRAY<STRUCT<sketch BYTES>>[{NULL}]
==

# Start section: KLL INIT exists NULL as input or weight. Test cases are
# repeated for four types of concrete signatures:
# - input only
# - input + precision
# - input + weight
# - input + precision + weight
[name=init_int64_exists_null_input_or_weight_input]
SELECT
  KLL_QUANTILES.EXTRACT_INT64(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_INT64(x) AS sketch
    FROM
      UNNEST(ARRAY< INT64 >[3, 1, NULL, 2]) AS x
  );
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<INT64>[known order:1, 2, 3]}]
==
[name=init_uint64_exists_null_input_or_weight_input]
SELECT
  KLL_QUANTILES.EXTRACT_UINT64(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_UINT64(x) AS sketch
    FROM
      UNNEST(ARRAY< UINT64 >[3, 1, NULL, 2]) AS x
  );
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<UINT64>[known order:1, 2, 3]}]
==
[name=init_double_exists_null_input_or_weight_input]
SELECT
  KLL_QUANTILES.EXTRACT_DOUBLE(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_DOUBLE(x) AS sketch
    FROM
      UNNEST(ARRAY< DOUBLE >[3, 1, NULL, 2]) AS x
  );
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:1, 2, 3]}]
==
[name=init_int64_exists_null_input_or_weight_input_precision]
SELECT
  KLL_QUANTILES.EXTRACT_INT64(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_INT64(x, 2000) AS sketch
    FROM
      UNNEST(ARRAY< INT64 >[3, 1, NULL, 2]) AS x
  );
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<INT64>[known order:1, 2, 3]}]
==
[name=init_uint64_exists_null_input_or_weight_input_precision]
SELECT
  KLL_QUANTILES.EXTRACT_UINT64(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_UINT64(x, 2000) AS sketch
    FROM
      UNNEST(ARRAY< UINT64 >[3, 1, NULL, 2]) AS x
  );
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<UINT64>[known order:1, 2, 3]}]
==
[name=init_double_exists_null_input_or_weight_input_precision]
SELECT
  KLL_QUANTILES.EXTRACT_DOUBLE(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_DOUBLE(x, 2000) AS sketch
    FROM
      UNNEST(ARRAY< DOUBLE >[3, 1, NULL, 2]) AS x
  );
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:1, 2, 3]}]
==
[name=init_int64_exists_null_input_or_weight_input_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.EXTRACT_INT64(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_INT64(x.input, weight  => x.weight) AS sketch
    FROM
      UNNEST(ARRAY< STRUCT< input INT64, weight INT64 > >[(NULL, NULL), (3, 1), (100, NULL), (1, 3), (NULL,
        100), (2, 1)]) AS x
  );
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<INT64>[known order:1, 1, 3]}]
==
[name=init_uint64_exists_null_input_or_weight_input_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.EXTRACT_UINT64(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_UINT64(x.input, weight  => x.weight) AS sketch
    FROM
      UNNEST(ARRAY< STRUCT< input UINT64, weight INT64 > >[(NULL, NULL), (3, 1), (100, NULL), (1, 3), (NULL,
        100), (2, 1)]) AS x
  );
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<UINT64>[known order:1, 1, 3]}]
==
[name=init_double_exists_null_input_or_weight_input_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.EXTRACT_DOUBLE(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_DOUBLE(x.input, weight  => x.weight) AS sketch
    FROM
      UNNEST(ARRAY< STRUCT< input DOUBLE, weight INT64 > >[(NULL, NULL), (3, 1), (100, NULL), (1, 3), (NULL,
        100), (2, 1)]) AS x
  );
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:1, 1, 3]}]
==
[name=init_int64_exists_null_input_or_weight_input_precision_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.EXTRACT_INT64(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_INT64(x.input, 2000, weight  => x.weight) AS sketch
    FROM
      UNNEST(ARRAY< STRUCT< input INT64, weight INT64 > >[(NULL, NULL), (3, 1), (100, NULL), (1, 3), (NULL,
        100), (2, 1)]) AS x
  );
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<INT64>[known order:1, 1, 3]}]
==
[name=init_uint64_exists_null_input_or_weight_input_precision_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.EXTRACT_UINT64(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_UINT64(x.input, 2000, weight  => x.weight) AS sketch
    FROM
      UNNEST(ARRAY< STRUCT< input UINT64, weight INT64 > >[(NULL, NULL), (3, 1), (100, NULL), (1, 3), (NULL,
        100), (2, 1)]) AS x
  );
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<UINT64>[known order:1, 1, 3]}]
==
[name=init_double_exists_null_input_or_weight_input_precision_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.EXTRACT_DOUBLE(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_DOUBLE(x.input, 2000, weight  => x.weight) AS sketch
    FROM
      UNNEST(ARRAY< STRUCT< input DOUBLE, weight INT64 > >[(NULL, NULL), (3, 1), (100, NULL), (1, 3), (NULL,
        100), (2, 1)]) AS x
  );
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:1, 1, 3]}]
==

# Start section: KLL INIT valid inputs without NULLs. Test cases are
# repeated for four types of concrete signatures:
# - input only
# - input + precision
# - input + weight
# - input + precision + weight
[name=init_int64_valid_input_input]
SELECT
  KLL_QUANTILES.EXTRACT_INT64(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_INT64(x) AS sketch
    FROM
      UNNEST(ARRAY< INT64 >[3, 1, 2]) AS x
  );
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<INT64>[known order:1, 2, 3]}]
==
[name=init_uint64_valid_input_input]
SELECT
  KLL_QUANTILES.EXTRACT_UINT64(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_UINT64(x) AS sketch
    FROM
      UNNEST(ARRAY< UINT64 >[3, 1, 2]) AS x
  );
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<UINT64>[known order:1, 2, 3]}]
==
[name=init_double_valid_input_input]
SELECT
  KLL_QUANTILES.EXTRACT_DOUBLE(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_DOUBLE(x) AS sketch
    FROM
      UNNEST(ARRAY< DOUBLE >[3, 1, 2]) AS x
  );
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:1, 2, 3]}]
==
[name=init_int64_valid_input_input_precision]
SELECT
  KLL_QUANTILES.EXTRACT_INT64(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_INT64(x, 2000) AS sketch
    FROM
      UNNEST(ARRAY< INT64 >[3, 1, 2]) AS x
  );
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<INT64>[known order:1, 2, 3]}]
==
[name=init_uint64_valid_input_input_precision]
SELECT
  KLL_QUANTILES.EXTRACT_UINT64(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_UINT64(x, 2000) AS sketch
    FROM
      UNNEST(ARRAY< UINT64 >[3, 1, 2]) AS x
  );
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<UINT64>[known order:1, 2, 3]}]
==
[name=init_double_valid_input_input_precision]
SELECT
  KLL_QUANTILES.EXTRACT_DOUBLE(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_DOUBLE(x, 2000) AS sketch
    FROM
      UNNEST(ARRAY< DOUBLE >[3, 1, 2]) AS x
  );
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:1, 2, 3]}]
==
[name=init_int64_valid_input_input_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.EXTRACT_INT64(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_INT64(x.input, weight  => x.weight) AS sketch
    FROM
      UNNEST(ARRAY< STRUCT< input INT64, weight INT64 > >[(3, 1), (1, 3), (2, 1)]) AS x
  );
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<INT64>[known order:1, 1, 3]}]
==
[name=init_uint64_valid_input_input_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.EXTRACT_UINT64(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_UINT64(x.input, weight  => x.weight) AS sketch
    FROM
      UNNEST(ARRAY< STRUCT< input UINT64, weight INT64 > >[(3, 1), (1, 3), (2, 1)]) AS x
  );
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<UINT64>[known order:1, 1, 3]}]
==
[name=init_double_valid_input_input_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.EXTRACT_DOUBLE(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_DOUBLE(x.input, weight  => x.weight) AS sketch
    FROM
      UNNEST(ARRAY< STRUCT< input DOUBLE, weight INT64 > >[(3, 1), (1, 3), (2, 1)]) AS x
  );
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:1, 1, 3]}]
==
[name=init_int64_valid_input_input_precision_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.EXTRACT_INT64(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_INT64(x.input, 2000, weight  => x.weight) AS sketch
    FROM
      UNNEST(ARRAY< STRUCT< input INT64, weight INT64 > >[(3, 1), (1, 3), (2, 1)]) AS x
  );
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<INT64>[known order:1, 1, 3]}]
==
[name=init_uint64_valid_input_input_precision_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.EXTRACT_UINT64(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_UINT64(x.input, 2000, weight  => x.weight) AS sketch
    FROM
      UNNEST(ARRAY< STRUCT< input UINT64, weight INT64 > >[(3, 1), (1, 3), (2, 1)]) AS x
  );
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<UINT64>[known order:1, 1, 3]}]
==
[name=init_double_valid_input_input_precision_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.EXTRACT_DOUBLE(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_DOUBLE(x.input, 2000, weight  => x.weight) AS sketch
    FROM
      UNNEST(ARRAY< STRUCT< input DOUBLE, weight INT64 > >[(3, 1), (1, 3), (2, 1)]) AS x
  );
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:1, 1, 3]}]
==

# Start section: KLL INIT all NULL input or weight. Test cases are
# repeated for four types of concrete signatures:
# - input only
# - input + precision
# - input + weight
# - input + precision + weight
# All test cases should return NULL.
[name=init_int64_all_null_input_or_weight_input]
SELECT
  KLL_QUANTILES.INIT_INT64(x) AS sketch
FROM
  UNNEST(ARRAY< INT64 >[NULL, NULL, NULL]) AS x;
--
ARRAY<STRUCT<sketch BYTES>>[{NULL}]
==
[name=init_uint64_all_null_input_or_weight_input]
SELECT
  KLL_QUANTILES.INIT_UINT64(x) AS sketch
FROM
  UNNEST(ARRAY< UINT64 >[NULL, NULL, NULL]) AS x;
--
ARRAY<STRUCT<sketch BYTES>>[{NULL}]
==
[name=init_double_all_null_input_or_weight_input]
SELECT
  KLL_QUANTILES.INIT_DOUBLE(x) AS sketch
FROM
  UNNEST(ARRAY< DOUBLE >[NULL, NULL, NULL]) AS x;
--
ARRAY<STRUCT<sketch BYTES>>[{NULL}]
==
[name=init_int64_all_null_input_or_weight_input_precision]
SELECT
  KLL_QUANTILES.INIT_INT64(x, 2000) AS sketch
FROM
  UNNEST(ARRAY< INT64 >[NULL, NULL, NULL]) AS x;
--
ARRAY<STRUCT<sketch BYTES>>[{NULL}]
==
[name=init_uint64_all_null_input_or_weight_input_precision]
SELECT
  KLL_QUANTILES.INIT_UINT64(x, 2000) AS sketch
FROM
  UNNEST(ARRAY< UINT64 >[NULL, NULL, NULL]) AS x;
--
ARRAY<STRUCT<sketch BYTES>>[{NULL}]
==
[name=init_double_all_null_input_or_weight_input_precision]
SELECT
  KLL_QUANTILES.INIT_DOUBLE(x, 2000) AS sketch
FROM
  UNNEST(ARRAY< DOUBLE >[NULL, NULL, NULL]) AS x;
--
ARRAY<STRUCT<sketch BYTES>>[{NULL}]
==
[name=init_int64_all_null_input_or_weight_input_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.INIT_INT64(x.input, weight  => x.weight) AS sketch
FROM
  UNNEST(ARRAY< STRUCT< input INT64, weight INT64 > >[(NULL, 100), (100, NULL), (NULL, NULL)]) AS x;
--
ARRAY<STRUCT<sketch BYTES>>[{NULL}]
==
[name=init_uint64_all_null_input_or_weight_input_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.INIT_UINT64(x.input, weight  => x.weight) AS sketch
FROM
  UNNEST(ARRAY< STRUCT< input UINT64, weight INT64 > >[(NULL, 100), (100, NULL), (NULL, NULL)]) AS x;
--
ARRAY<STRUCT<sketch BYTES>>[{NULL}]
==
[name=init_double_all_null_input_or_weight_input_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.INIT_DOUBLE(x.input, weight  => x.weight) AS sketch
FROM
  UNNEST(ARRAY< STRUCT< input DOUBLE, weight INT64 > >[(NULL, 100), (100, NULL), (NULL, NULL)]) AS x;
--
ARRAY<STRUCT<sketch BYTES>>[{NULL}]
==
[name=init_int64_all_null_input_or_weight_input_precision_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.INIT_INT64(x.input, 2000, weight  => x.weight) AS sketch
FROM
  UNNEST(ARRAY< STRUCT< input INT64, weight INT64 > >[(NULL, 100), (100, NULL), (NULL, NULL)]) AS x;
--
ARRAY<STRUCT<sketch BYTES>>[{NULL}]
==
[name=init_uint64_all_null_input_or_weight_input_precision_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.INIT_UINT64(x.input, 2000, weight  => x.weight) AS sketch
FROM
  UNNEST(ARRAY< STRUCT< input UINT64, weight INT64 > >[(NULL, 100), (100, NULL), (NULL, NULL)]) AS x;
--
ARRAY<STRUCT<sketch BYTES>>[{NULL}]
==
[name=init_double_all_null_input_or_weight_input_precision_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.INIT_DOUBLE(x.input, 2000, weight  => x.weight) AS sketch
FROM
  UNNEST(ARRAY< STRUCT< input DOUBLE, weight INT64 > >[(NULL, 100), (100, NULL), (NULL, NULL)]) AS x;
--
ARRAY<STRUCT<sketch BYTES>>[{NULL}]
==


# Start section: KLL INIT NULL as precision. Test cases are
# repeated for two types of concrete signatures:
# - input + precision
# - input + precision + weight
# All test cases should return NULL.
[name=init_int64_null_precision_input_precision]
[parameters=NULL AS precision]
SELECT
  KLL_QUANTILES.INIT_INT64(x, @precision) AS sketch
FROM
  UNNEST(ARRAY< INT64 > [3, 2, 1]) AS x;
--
ARRAY<STRUCT<sketch BYTES>>[{NULL}]
==
[name=init_uint64_null_precision_input_precision]
[parameters=NULL AS precision]
SELECT
  KLL_QUANTILES.INIT_UINT64(x, @precision) AS sketch
FROM
  UNNEST(ARRAY< UINT64 > [3, 2, 1]) AS x;
--
ARRAY<STRUCT<sketch BYTES>>[{NULL}]
==
[name=init_double_null_precision_input_precision]
[parameters=NULL AS precision]
SELECT
  KLL_QUANTILES.INIT_DOUBLE(x, @precision) AS sketch
FROM
  UNNEST(ARRAY< DOUBLE > [3, 2, 1]) AS x;
--
ARRAY<STRUCT<sketch BYTES>>[{NULL}]
==
[name=init_int64_null_precision_input_precision_weight]
[parameters=NULL AS precision]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.INIT_INT64(x.input, @precision, weight  => x.weight) AS sketch
FROM
  UNNEST(ARRAY< STRUCT< input INT64, weight INT64 > >[(3, 1), (2, 1), (1, 1)]) AS x;
--
ARRAY<STRUCT<sketch BYTES>>[{NULL}]
==
[name=init_uint64_null_precision_input_precision_weight]
[parameters=NULL AS precision]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.INIT_UINT64(x.input, @precision, weight  => x.weight) AS sketch
FROM
  UNNEST(ARRAY< STRUCT< input UINT64, weight INT64 > >[(3, 1), (2, 1), (1, 1)]) AS x;
--
ARRAY<STRUCT<sketch BYTES>>[{NULL}]
==
[name=init_double_null_precision_input_precision_weight]
[parameters=NULL AS precision]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.INIT_DOUBLE(x.input, @precision, weight  => x.weight) AS sketch
FROM
  UNNEST(ARRAY< STRUCT< input DOUBLE, weight INT64 > >[(3, 1), (2, 1), (1, 1)]) AS x;
--
ARRAY<STRUCT<sketch BYTES>>[{NULL}]
==

# Start section: negative precisions are not allowed.
[name=init_int64_negative_precision_input_negative_precision]
[parameters=-1 AS precision]
SELECT
  KLL_QUANTILES.INIT_INT64(x, @precision) AS sketch
FROM
  UNNEST(ARRAY< INT64 >[3, 1, 2]) AS x;
--
ERROR: generic::out_of_range: KLL failed: Provided inv_eps:-1 but inv_eps needs to be >= 1 and <= 200000000.
==
[name=init_uint64_negative_precision_input_negative_precision]
[parameters=-1 AS precision]
SELECT
  KLL_QUANTILES.INIT_UINT64(x, @precision) AS sketch
FROM
  UNNEST(ARRAY< UINT64 >[3, 1, 2]) AS x;
--
ERROR: generic::out_of_range: KLL failed: Provided inv_eps:-1 but inv_eps needs to be >= 1 and <= 200000000.
==
[name=init_double_negative_precision_input_negative_precision]
[parameters=-1 AS precision]
SELECT
  KLL_QUANTILES.INIT_DOUBLE(x, @precision) AS sketch
FROM
  UNNEST(ARRAY< DOUBLE >[3, 1, 2]) AS x;
--
ERROR: generic::out_of_range: KLL failed: Provided inv_eps:-1 but inv_eps needs to be >= 1 and <= 200000000.
==
[name=init_int64_negative_precision_input_negative_precision_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
[parameters=-1 AS precision]
SELECT
  KLL_QUANTILES.INIT_INT64(x.input, @precision, weight  => x.weight) AS sketch
FROM
  UNNEST(ARRAY< STRUCT< input INT64, weight INT64 > >[(3, 1), (1, 3), (2, 1)]) AS x;
--
ERROR: generic::out_of_range: KLL failed: Provided inv_eps:-1 but inv_eps needs to be >= 1 and <= 200000000.
==
[name=init_uint64_negative_precision_input_negative_precision_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
[parameters=-1 AS precision]
SELECT
  KLL_QUANTILES.INIT_UINT64(x.input, @precision, weight  => x.weight) AS sketch
FROM
  UNNEST(ARRAY< STRUCT< input UINT64, weight INT64 > >[(3, 1), (1, 3), (2, 1)]) AS x;
--
ERROR: generic::out_of_range: KLL failed: Provided inv_eps:-1 but inv_eps needs to be >= 1 and <= 200000000.
==
[name=init_double_negative_precision_input_negative_precision_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
[parameters=-1 AS precision]
SELECT
  KLL_QUANTILES.INIT_DOUBLE(x.input, @precision, weight  => x.weight) AS sketch
FROM
  UNNEST(ARRAY< STRUCT< input DOUBLE, weight INT64 > >[(3, 1), (1, 3), (2, 1)]) AS x;
--
ERROR: generic::out_of_range: KLL failed: Provided inv_eps:-1 but inv_eps needs to be >= 1 and <= 200000000.
==

# Start section: Exists zero weight.
[name=init_int64_exists_zero_weight_input_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.EXTRACT_INT64(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_INT64(x.input, weight  => x.weight) AS sketch
    FROM
      UNNEST(ARRAY< STRUCT< input INT64, weight INT64 > >[(3, 0), (1, 1), (2, 1), (4, 0), (5, 1)]) AS x
  );
--
ERROR: generic::out_of_range: Error adding value to KLL. Values can not be added with a weight < 1. Weight: 0
==
[name=init_uint64_exists_zero_weight_input_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.EXTRACT_UINT64(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_UINT64(x.input, weight  => x.weight) AS sketch
    FROM
      UNNEST(ARRAY< STRUCT< input UINT64, weight INT64 > >[(3, 0), (1, 1), (2, 1), (4, 0), (5, 1)]) AS x
  );
--
ERROR: generic::out_of_range: Error adding value to KLL. Values can not be added with a weight < 1. Weight: 0
==
[name=init_double_exists_zero_weight_input_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.EXTRACT_DOUBLE(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_DOUBLE(x.input, weight  => x.weight) AS sketch
    FROM
      UNNEST(ARRAY< STRUCT< input DOUBLE, weight INT64 > >[(3, 0), (1, 1), (2, 1), (4, 0), (5, 1)]) AS x
  );
--
ERROR: generic::out_of_range: Error adding value to KLL. Values can not be added with a weight < 1. Weight: 0
==
[name=init_int64_exists_zero_weight_input_precision_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.EXTRACT_INT64(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_INT64(x.input, 2000, weight  => x.weight) AS sketch
    FROM
      UNNEST(ARRAY< STRUCT< input INT64, weight INT64 > >[(3, 0), (1, 1), (2, 1), (4, 0), (5, 1)]) AS x
  );
--
ERROR: generic::out_of_range: Error adding value to KLL. Values can not be added with a weight < 1. Weight: 0
==
[name=init_uint64_exists_zero_weight_input_precision_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.EXTRACT_UINT64(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_UINT64(x.input, 2000, weight  => x.weight) AS sketch
    FROM
      UNNEST(ARRAY< STRUCT< input UINT64, weight INT64 > >[(3, 0), (1, 1), (2, 1), (4, 0), (5, 1)]) AS x
  );
--
ERROR: generic::out_of_range: Error adding value to KLL. Values can not be added with a weight < 1. Weight: 0
==
[name=init_double_exists_zero_weight_input_precision_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.EXTRACT_DOUBLE(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_DOUBLE(x.input, 2000, weight  => x.weight) AS sketch
    FROM
      UNNEST(ARRAY< STRUCT< input DOUBLE, weight INT64 > >[(3, 0), (1, 1), (2, 1), (4, 0), (5, 1)]) AS x
  );
--
ERROR: generic::out_of_range: Error adding value to KLL. Values can not be added with a weight < 1. Weight: 0
==

# Start section: Exists negative weight.
[name=init_int64_exists_negative_weight_input_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.EXTRACT_INT64(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_INT64(x.input, weight  => x.weight) AS sketch
    FROM
      UNNEST(ARRAY< STRUCT< input INT64, weight INT64 > >[(3, -1), (1, 1), (2, 1), (4, -1), (5, 1)]) AS x
  );
--
ERROR: generic::out_of_range: Error adding value to KLL. Values can not be added with a weight < 1. Weight: -1
==
[name=init_uint64_exists_negative_weight_input_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.EXTRACT_UINT64(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_UINT64(x.input, weight  => x.weight) AS sketch
    FROM
      UNNEST(ARRAY< STRUCT< input UINT64, weight INT64 > >[(3, -1), (1, 1), (2, 1), (4, -1), (5, 1)]) AS x
  );
--
ERROR: generic::out_of_range: Error adding value to KLL. Values can not be added with a weight < 1. Weight: -1
==
[name=init_double_exists_negative_weight_input_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.EXTRACT_DOUBLE(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_DOUBLE(x.input, weight  => x.weight) AS sketch
    FROM
      UNNEST(ARRAY< STRUCT< input DOUBLE, weight INT64 > >[(3, -1), (1, 1), (2, 1), (4, -1), (5, 1)]) AS x
  );
--
ERROR: generic::out_of_range: Error adding value to KLL. Values can not be added with a weight < 1. Weight: -1
==
[name=init_int64_exists_negative_weight_input_precision_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.EXTRACT_INT64(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_INT64(x.input, 2000, weight  => x.weight) AS sketch
    FROM
      UNNEST(ARRAY< STRUCT< input INT64, weight INT64 > >[(3, -1), (1, 1), (2, 1), (4, -1), (5, 1)]) AS x
  );
--
ERROR: generic::out_of_range: Error adding value to KLL. Values can not be added with a weight < 1. Weight: -1
==
[name=init_uint64_exists_negative_weight_input_precision_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.EXTRACT_UINT64(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_UINT64(x.input, 2000, weight  => x.weight) AS sketch
    FROM
      UNNEST(ARRAY< STRUCT< input UINT64, weight INT64 > >[(3, -1), (1, 1), (2, 1), (4, -1), (5, 1)]) AS x
  );
--
ERROR: generic::out_of_range: Error adding value to KLL. Values can not be added with a weight < 1. Weight: -1
==
[name=init_double_exists_negative_weight_input_precision_weight]
[required_features=KLL_WEIGHTS,NAMED_ARGUMENTS]
SELECT
  KLL_QUANTILES.EXTRACT_DOUBLE(sketch, 2)
FROM
  (
    SELECT
      KLL_QUANTILES.INIT_DOUBLE(x.input, 2000, weight  => x.weight) AS sketch
    FROM
      UNNEST(ARRAY< STRUCT< input DOUBLE, weight INT64 > >[(3, -1), (1, 1), (2, 1), (4, -1), (5, 1)]) AS x
  );
--
ERROR: generic::out_of_range: Error adding value to KLL. Values can not be added with a weight < 1. Weight: -1
