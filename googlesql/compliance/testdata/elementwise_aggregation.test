# This file is driven by a test matrix with the following properties
# The function is selected from (ELEMENTWISE_SUM, ELEMENTWISE_AVG)
# The argument column is selected from one of the following types:
# (FLOAT, DOUBLE, INT32, INT64, UINT32, UINT64, NUMERIC, BIGNUMERIC. INTERVAL)
# For NUMERIC, BIGNUMERIC, and INTERVAL we use a WITH statement to construct
# TestTable, in order to isolate the type dependency
# The mode of the function call is either AGGREGATE or WINDOW
# If the mode is AGGREGATE:
#   -GROUP BY may be added
#   -DISTINCT may be added
#   -HAVING MIN/MAX may be added
# If the mode is WINDOW:
#   -PARTITION BY may be added
#   -ROWS/RANGE clause may be added
#   -ORDER BY may be added
#     -ORDER BY is always added if PARTITION/ROWS/RANGE is present

[prepare_database]
CREATE TABLE TestTable AS
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [CAST(1 AS int32), CAST(2 AS int32), CAST(3 AS int32), CAST(3 AS int32), CAST(NULL AS int32)] as int32_array_val,
       [CAST(1 AS int64), CAST(2 AS int64), CAST(3 AS int64), CAST(3 AS int64), CAST(NULL AS int64)] as int64_array_val,
       [CAST(1 AS uint32), CAST(2 AS uint32), CAST(3 AS uint32), CAST(3 AS uint32), CAST(NULL AS uint32)] as uint32_array_val,
       [CAST(1 AS uint64), CAST(2 AS uint64), CAST(3 AS uint64), CAST(3 AS uint64), CAST(NULL AS uint64)] as uint64_array_val,
       [CAST(1 AS float), CAST(2 AS float), CAST(3 AS float), CAST(3 AS float), CAST(NULL AS float)] as float_array_val,
       [CAST(1 AS double), CAST(2 AS double), CAST(3 AS double), CAST(3 AS double), CAST(NULL AS double), CAST('nan' as double)] as double_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [CAST(2 AS int32), CAST(3 AS int32), CAST(4 AS int32), CAST(4 AS int32), CAST(NULL AS int32)],
       [CAST(2 AS int64), CAST(3 AS int64), CAST(4 AS int64), CAST(4 AS int64), CAST(NULL AS int64)],
       [CAST(2 AS uint32), CAST(3 AS uint32), CAST(4 AS uint32), CAST(4 AS uint32), CAST(NULL AS uint32)],
       [CAST(2 AS uint64), CAST(3 AS uint64), CAST(4 AS uint64), CAST(4 AS uint64), CAST(NULL AS uint64)],
       [CAST(2 AS float), CAST(3 AS float), CAST(4 AS float), CAST(4 AS float), CAST(NULL AS float)],
       [CAST(2 AS double), CAST(3 AS double), CAST(4 AS double), CAST(4 AS double), CAST(NULL AS double), CAST('inf' as double)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [CAST(3 AS int32), CAST(4 AS int32), CAST(5 AS int32), CAST(5 AS int32), CAST(NULL AS int32)],
       [CAST(3 AS int64), CAST(4 AS int64), CAST(5 AS int64), CAST(5 AS int64), CAST(NULL AS int64)],
       [CAST(3 AS uint32), CAST(4 AS uint32), CAST(5 AS uint32), CAST(5 AS uint32), CAST(NULL AS uint32)],
       [CAST(3 AS uint64), CAST(4 AS uint64), CAST(5 AS uint64), CAST(5 AS uint64), CAST(NULL AS uint64)],
       [CAST(3 AS float), CAST(4 AS float), CAST(5 AS float), CAST(5 AS float), CAST(NULL AS float)],
       [CAST(3 AS double), CAST(4 AS double), CAST(5 AS double), CAST(5 AS double), CAST(NULL AS double), CAST('-inf' as double)]
UNION ALL
# Duplicate row to test DISTINCT
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [CAST(3 AS int32), CAST(4 AS int32), CAST(5 AS int32), CAST(5 AS int32), CAST(NULL AS int32)],
       [CAST(3 AS int64), CAST(4 AS int64), CAST(5 AS int64), CAST(5 AS int64), CAST(NULL AS int64)],
       [CAST(3 AS uint32), CAST(4 AS uint32), CAST(5 AS uint32), CAST(5 AS uint32), CAST(NULL AS uint32)],
       [CAST(3 AS uint64), CAST(4 AS uint64), CAST(5 AS uint64), CAST(5 AS uint64), CAST(NULL AS uint64)],
       [CAST(3 AS float), CAST(4 AS float), CAST(5 AS float), CAST(5 AS float), CAST(NULL AS float)],
       [CAST(3 AS double), CAST(4 AS double), CAST(5 AS double), CAST(5 AS double), CAST(NULL AS double), CAST(0 as double)]
UNION ALL
# Arrays with all NULL value
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS int32), CAST(NULL AS int32), CAST(NULL AS int32), CAST(NULL AS int32), CAST(NULL AS int32)],
       [CAST(NULL AS int64), CAST(NULL AS int64), CAST(NULL AS int64), CAST(NULL AS int64), CAST(NULL AS int64)],
       [CAST(NULL AS uint32), CAST(NULL AS uint32), CAST(NULL AS uint32), CAST(NULL AS uint32), CAST(NULL AS uint32)],
       [CAST(NULL AS uint64), CAST(NULL AS uint64), CAST(NULL AS uint64), CAST(NULL AS uint64), CAST(NULL AS uint64)],
       [CAST(NULL AS float), CAST(NULL AS float), CAST(NULL AS float), CAST(NULL AS float), CAST(NULL AS float)],
       [CAST(NULL AS double), CAST(NULL AS double), CAST(NULL AS double), CAST(NULL AS double), CAST(NULL AS double), CAST(NULL AS double)]
UNION ALL
# NULL Arrays
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INT32>),
       CAST(NULL AS ARRAY<INT64>),
       CAST(NULL AS ARRAY<UINT32>),
       CAST(NULL AS ARRAY<UINT64>),
       CAST(NULL AS ARRAY<FLOAT>),
       CAST(NULL AS ARRAY<DOUBLE>)
--
ARRAY<STRUCT<
        row_id INT64,
        group_id INT64,
        int32_array_val ARRAY<>,
        int64_array_val ARRAY<>,
        uint32_array_val ARRAY<>,
        uint64_array_val ARRAY<>,
        float_array_val ARRAY<>,
        double_array_val ARRAY<>
      >>
[{
   1,
   1,
   ARRAY<INT32>[1, 2, 3, 3, NULL],
   ARRAY<INT64>[1, 2, 3, 3, NULL],
   ARRAY<UINT32>[1, 2, 3, 3, NULL],
   ARRAY<UINT64>[1, 2, 3, 3, NULL],
   ARRAY<FLOAT>[1, 2, 3, 3, NULL],
   ARRAY<DOUBLE>[1, 2, 3, 3, NULL, nan]
 },
 {
   2,
   1,
   ARRAY<INT32>[2, 3, 4, 4, NULL],
   ARRAY<INT64>[2, 3, 4, 4, NULL],
   ARRAY<UINT32>[2, 3, 4, 4, NULL],
   ARRAY<UINT64>[2, 3, 4, 4, NULL],
   ARRAY<FLOAT>[2, 3, 4, 4, NULL],
   ARRAY<DOUBLE>[2, 3, 4, 4, NULL, inf]
 },
 {
   3,
   1,
   ARRAY<INT32>[3, 4, 5, 5, NULL],
   ARRAY<INT64>[3, 4, 5, 5, NULL],
   ARRAY<UINT32>[3, 4, 5, 5, NULL],
   ARRAY<UINT64>[3, 4, 5, 5, NULL],
   ARRAY<FLOAT>[3, 4, 5, 5, NULL],
   ARRAY<DOUBLE>[3, 4, 5, 5, NULL, -inf]
 },
 {
   4,
   2,
   ARRAY<INT32>[3, 4, 5, 5, NULL],
   ARRAY<INT64>[3, 4, 5, 5, NULL],
   ARRAY<UINT32>[3, 4, 5, 5, NULL],
   ARRAY<UINT64>[3, 4, 5, 5, NULL],
   ARRAY<FLOAT>[3, 4, 5, 5, NULL],
   ARRAY<DOUBLE>[3, 4, 5, 5, NULL, 0]
 },
 {
   5,
   2,
   ARRAY<INT32>[NULL, NULL, NULL, NULL, NULL],
   ARRAY<INT64>[NULL, NULL, NULL, NULL, NULL],
   ARRAY<UINT32>[NULL, NULL, NULL, NULL, NULL],
   ARRAY<UINT64>[NULL, NULL, NULL, NULL, NULL],
   ARRAY<FLOAT>[NULL, NULL, NULL, NULL, NULL],
   ARRAY<DOUBLE>[NULL, NULL, NULL, NULL, NULL, NULL]
 },
 {6,
  2,
  ARRAY<INT32>(NULL),
  ARRAY<INT64>(NULL),
  ARRAY<UINT32>(NULL),
  ARRAY<UINT64>(NULL),
  ARRAY<FLOAT>(NULL),
  ARRAY<DOUBLE>(NULL)}]
==

### BEGIN HANDCRAFTED EDGE CASES ###
[name=aggregate_elementwise_sum_empty_arrays]
WITH T as (SELECT [] as arr
UNION ALL SELECT [])
SELECT ELEMENTWISE_SUM( arr ) FROM T AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<INT64>[]}]
==

[name=aggregate_elementwise_avg_empty_arrays]
WITH T as (SELECT [] as arr
UNION ALL SELECT [])
SELECT ELEMENTWISE_AVG( arr ) FROM T AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[]}]
==

[name=aggregate_elementwise_sum_null_input_arrays]
WITH T as (SELECT CAST(NULL AS ARRAY<INT64>) as arr
UNION ALL SELECT CAST(NULL AS ARRAY<INT64>))
SELECT ELEMENTWISE_SUM( arr ) FROM T AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<INT64>(NULL)}]
==

[name=aggregate_elementwise_avg_null_input_arrays]
WITH T as (SELECT CAST(NULL AS ARRAY<INT64>) as arr
UNION ALL SELECT CAST(NULL AS ARRAY<INT64>))
SELECT ELEMENTWISE_AVG( arr ) FROM T AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>(NULL)}]
==

[name=aggregate_elementwise_sum_null_input_arrays_with_array_containing_nulls]
WITH T as (SELECT CAST(NULL AS ARRAY<INT64>) as arr
UNION ALL SELECT CAST(NULL AS ARRAY<INT64>)
UNION ALL SELECT [NULL,NULL,NULL])
SELECT ELEMENTWISE_SUM( arr ) FROM T AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<INT64>[known order:NULL, NULL, NULL]}]
==

[name=aggregate_elementwise_avg_null_input_arrays_with_array_containing_nulls]
WITH T as (SELECT CAST(NULL AS ARRAY<INT64>) as arr
UNION ALL SELECT CAST(NULL AS ARRAY<INT64>)
UNION ALL SELECT [NULL,NULL,NULL])
SELECT ELEMENTWISE_AVG( arr ) FROM T AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:NULL, NULL, NULL]}]
==

[name=aggregate_elementwise_avg_correctly_respects_nulls]
WITH T as (SELECT [1,1,1,NULL] as arr
UNION ALL SELECT [3,3,NULL,NULL]
UNION ALL SELECT [10,NULL,NULL,NULL])
SELECT ELEMENTWISE_AVG( arr ) FROM T AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[
  {ARRAY<DOUBLE>[known order:4.666666666666667, 2, 1, NULL]}
]
==
### BEGIN GENERATED TEST CASES ###

[name=aggregate_elementwise_sum_testtable_int32_array_val]
SELECT ELEMENTWISE_SUM( int32_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<INT64>[known order:9, 13, 17, 17, NULL]}]
==

[name=aggregate_elementwise_sum_testtable_int32_array_val_group_by]
SELECT group_id, ELEMENTWISE_SUM( int32_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<INT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<INT64>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_int32_array_val_having_min]
SELECT ELEMENTWISE_SUM( int32_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<INT64>[known order:6, 9, 12, 12, NULL]}]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_int32_array_val_having_min_group_by]
SELECT group_id, ELEMENTWISE_SUM( int32_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<INT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<INT64>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_int32_array_val_having_max]
SELECT ELEMENTWISE_SUM( int32_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<INT64>[known order:3, 4, 5, 5, NULL]}]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_int32_array_val_having_max_group_by]
SELECT group_id, ELEMENTWISE_SUM( int32_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<INT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<INT64>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY]
[name=aggregate_elementwise_sum_testtable_int32_array_val_distinct]
SELECT ELEMENTWISE_SUM(DISTINCT int32_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<INT64>[known order:6, 9, 12, 12, NULL]}]
==

[required_features=GROUP_BY_ARRAY]
[name=aggregate_elementwise_sum_testtable_int32_array_val_distinct_group_by]
SELECT group_id, ELEMENTWISE_SUM(DISTINCT int32_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<INT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<INT64>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_int32_array_val_distinct_having_min]
SELECT ELEMENTWISE_SUM(DISTINCT int32_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<INT64>[known order:6, 9, 12, 12, NULL]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_int32_array_val_distinct_having_min_group_by]
SELECT group_id, ELEMENTWISE_SUM(DISTINCT int32_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<INT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<INT64>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_int32_array_val_distinct_having_max]
SELECT ELEMENTWISE_SUM(DISTINCT int32_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<INT64>[known order:3, 4, 5, 5, NULL]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_int32_array_val_distinct_having_max_group_by]
SELECT group_id, ELEMENTWISE_SUM(DISTINCT int32_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<INT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<INT64>[known order:3, 4, 5, 5, NULL]
  }
]
==

[name=aggregate_elementwise_sum_testtable_int64_array_val]
SELECT ELEMENTWISE_SUM( int64_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<INT64>[known order:9, 13, 17, 17, NULL]}]
==

[name=aggregate_elementwise_sum_testtable_int64_array_val_group_by]
SELECT group_id, ELEMENTWISE_SUM( int64_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<INT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<INT64>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_int64_array_val_having_min]
SELECT ELEMENTWISE_SUM( int64_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<INT64>[known order:6, 9, 12, 12, NULL]}]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_int64_array_val_having_min_group_by]
SELECT group_id, ELEMENTWISE_SUM( int64_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<INT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<INT64>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_int64_array_val_having_max]
SELECT ELEMENTWISE_SUM( int64_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<INT64>[known order:3, 4, 5, 5, NULL]}]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_int64_array_val_having_max_group_by]
SELECT group_id, ELEMENTWISE_SUM( int64_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<INT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<INT64>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY]
[name=aggregate_elementwise_sum_testtable_int64_array_val_distinct]
SELECT ELEMENTWISE_SUM(DISTINCT int64_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<INT64>[known order:6, 9, 12, 12, NULL]}]
==

[required_features=GROUP_BY_ARRAY]
[name=aggregate_elementwise_sum_testtable_int64_array_val_distinct_group_by]
SELECT group_id, ELEMENTWISE_SUM(DISTINCT int64_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<INT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<INT64>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_int64_array_val_distinct_having_min]
SELECT ELEMENTWISE_SUM(DISTINCT int64_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<INT64>[known order:6, 9, 12, 12, NULL]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_int64_array_val_distinct_having_min_group_by]
SELECT group_id, ELEMENTWISE_SUM(DISTINCT int64_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<INT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<INT64>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_int64_array_val_distinct_having_max]
SELECT ELEMENTWISE_SUM(DISTINCT int64_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<INT64>[known order:3, 4, 5, 5, NULL]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_int64_array_val_distinct_having_max_group_by]
SELECT group_id, ELEMENTWISE_SUM(DISTINCT int64_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<INT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<INT64>[known order:3, 4, 5, 5, NULL]
  }
]
==

[name=aggregate_elementwise_sum_testtable_uint32_array_val]
SELECT ELEMENTWISE_SUM( uint32_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<UINT64>[known order:9, 13, 17, 17, NULL]}]
==

[name=aggregate_elementwise_sum_testtable_uint32_array_val_group_by]
SELECT group_id, ELEMENTWISE_SUM( uint32_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<UINT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_uint32_array_val_having_min]
SELECT ELEMENTWISE_SUM( uint32_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<UINT64>[known order:6, 9, 12, 12, NULL]}]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_uint32_array_val_having_min_group_by]
SELECT group_id, ELEMENTWISE_SUM( uint32_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<UINT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_uint32_array_val_having_max]
SELECT ELEMENTWISE_SUM( uint32_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]}]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_uint32_array_val_having_max_group_by]
SELECT group_id, ELEMENTWISE_SUM( uint32_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<UINT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY]
[name=aggregate_elementwise_sum_testtable_uint32_array_val_distinct]
SELECT ELEMENTWISE_SUM(DISTINCT uint32_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<UINT64>[known order:6, 9, 12, 12, NULL]}]
==

[required_features=GROUP_BY_ARRAY]
[name=aggregate_elementwise_sum_testtable_uint32_array_val_distinct_group_by]
SELECT group_id, ELEMENTWISE_SUM(DISTINCT uint32_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<UINT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_uint32_array_val_distinct_having_min]
SELECT ELEMENTWISE_SUM(DISTINCT uint32_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<UINT64>[known order:6, 9, 12, 12, NULL]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_uint32_array_val_distinct_having_min_group_by]
SELECT group_id, ELEMENTWISE_SUM(DISTINCT uint32_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<UINT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_uint32_array_val_distinct_having_max]
SELECT ELEMENTWISE_SUM(DISTINCT uint32_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_uint32_array_val_distinct_having_max_group_by]
SELECT group_id, ELEMENTWISE_SUM(DISTINCT uint32_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<UINT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]
  }
]
==

[name=aggregate_elementwise_sum_testtable_uint64_array_val]
SELECT ELEMENTWISE_SUM( uint64_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<UINT64>[known order:9, 13, 17, 17, NULL]}]
==

[name=aggregate_elementwise_sum_testtable_uint64_array_val_group_by]
SELECT group_id, ELEMENTWISE_SUM( uint64_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<UINT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_uint64_array_val_having_min]
SELECT ELEMENTWISE_SUM( uint64_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<UINT64>[known order:6, 9, 12, 12, NULL]}]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_uint64_array_val_having_min_group_by]
SELECT group_id, ELEMENTWISE_SUM( uint64_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<UINT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_uint64_array_val_having_max]
SELECT ELEMENTWISE_SUM( uint64_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]}]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_uint64_array_val_having_max_group_by]
SELECT group_id, ELEMENTWISE_SUM( uint64_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<UINT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY]
[name=aggregate_elementwise_sum_testtable_uint64_array_val_distinct]
SELECT ELEMENTWISE_SUM(DISTINCT uint64_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<UINT64>[known order:6, 9, 12, 12, NULL]}]
==

[required_features=GROUP_BY_ARRAY]
[name=aggregate_elementwise_sum_testtable_uint64_array_val_distinct_group_by]
SELECT group_id, ELEMENTWISE_SUM(DISTINCT uint64_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<UINT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_uint64_array_val_distinct_having_min]
SELECT ELEMENTWISE_SUM(DISTINCT uint64_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<UINT64>[known order:6, 9, 12, 12, NULL]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_uint64_array_val_distinct_having_min_group_by]
SELECT group_id, ELEMENTWISE_SUM(DISTINCT uint64_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<UINT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_uint64_array_val_distinct_having_max]
SELECT ELEMENTWISE_SUM(DISTINCT uint64_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_uint64_array_val_distinct_having_max_group_by]
SELECT group_id, ELEMENTWISE_SUM(DISTINCT uint64_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<UINT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]
  }
]
==

[name=aggregate_elementwise_sum_testtable_float_array_val]
SELECT ELEMENTWISE_SUM( float_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:9, 13, 17, 17, NULL]}]
==

[name=aggregate_elementwise_sum_testtable_float_array_val_group_by]
SELECT group_id, ELEMENTWISE_SUM( float_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_float_array_val_having_min]
SELECT ELEMENTWISE_SUM( float_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:6, 9, 12, 12, NULL]}]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_float_array_val_having_min_group_by]
SELECT group_id, ELEMENTWISE_SUM( float_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_float_array_val_having_max]
SELECT ELEMENTWISE_SUM( float_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]}]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_float_array_val_having_max_group_by]
SELECT group_id, ELEMENTWISE_SUM( float_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY]
[name=aggregate_elementwise_sum_testtable_float_array_val_distinct]
SELECT ELEMENTWISE_SUM(DISTINCT float_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:6, 9, 12, 12, NULL]}]
==

[required_features=GROUP_BY_ARRAY]
[name=aggregate_elementwise_sum_testtable_float_array_val_distinct_group_by]
SELECT group_id, ELEMENTWISE_SUM(DISTINCT float_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_float_array_val_distinct_having_min]
SELECT ELEMENTWISE_SUM(DISTINCT float_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:6, 9, 12, 12, NULL]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_float_array_val_distinct_having_min_group_by]
SELECT group_id, ELEMENTWISE_SUM(DISTINCT float_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_float_array_val_distinct_having_max]
SELECT ELEMENTWISE_SUM(DISTINCT float_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_float_array_val_distinct_having_max_group_by]
SELECT group_id, ELEMENTWISE_SUM(DISTINCT float_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[name=aggregate_elementwise_sum_testtable_double_array_val]
SELECT ELEMENTWISE_SUM( double_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:9, 13, 17, 17, NULL, nan]}]
==

[name=aggregate_elementwise_sum_testtable_double_array_val_group_by]
SELECT group_id, ELEMENTWISE_SUM( double_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:6, 9, 12, 12, NULL, nan]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]
  }
]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_double_array_val_having_min]
SELECT ELEMENTWISE_SUM( double_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:6, 9, 12, 12, NULL, nan]}]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_double_array_val_having_min_group_by]
SELECT group_id, ELEMENTWISE_SUM( double_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:6, 9, 12, 12, NULL, nan]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]
  }
]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_double_array_val_having_max]
SELECT ELEMENTWISE_SUM( double_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]}]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_double_array_val_having_max_group_by]
SELECT group_id, ELEMENTWISE_SUM( double_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:6, 9, 12, 12, NULL, nan]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]
  }
]
==

[required_features=GROUP_BY_ARRAY]
[name=aggregate_elementwise_sum_testtable_double_array_val_distinct]
SELECT ELEMENTWISE_SUM(DISTINCT double_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:9, 13, 17, 17, NULL, nan]}]
==

[required_features=GROUP_BY_ARRAY]
[name=aggregate_elementwise_sum_testtable_double_array_val_distinct_group_by]
SELECT group_id, ELEMENTWISE_SUM(DISTINCT double_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:6, 9, 12, 12, NULL, nan]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_double_array_val_distinct_having_min]
SELECT ELEMENTWISE_SUM(DISTINCT double_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:6, 9, 12, 12, NULL, nan]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_double_array_val_distinct_having_min_group_by]
SELECT group_id, ELEMENTWISE_SUM(DISTINCT double_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:6, 9, 12, 12, NULL, nan]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_double_array_val_distinct_having_max]
SELECT ELEMENTWISE_SUM(DISTINCT double_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_sum_testtable_double_array_val_distinct_having_max_group_by]
SELECT group_id, ELEMENTWISE_SUM(DISTINCT double_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:6, 9, 12, 12, NULL, nan]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]
  }
]
==

[required_features=NUMERIC_TYPE]
[name=aggregate_elementwise_sum_testtable_numeric_array_val]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT ELEMENTWISE_SUM( numeric_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<NUMERIC>[known order:9, 13, 17, 17, NULL]}]
==

[required_features=NUMERIC_TYPE]
[name=aggregate_elementwise_sum_testtable_numeric_array_val_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT group_id, ELEMENTWISE_SUM( numeric_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<NUMERIC>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=HAVING_IN_AGGREGATE,NUMERIC_TYPE]
[name=aggregate_elementwise_sum_testtable_numeric_array_val_having_min]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT ELEMENTWISE_SUM( numeric_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<NUMERIC>[known order:6, 9, 12, 12, NULL]}]
==

[required_features=HAVING_IN_AGGREGATE,NUMERIC_TYPE]
[name=aggregate_elementwise_sum_testtable_numeric_array_val_having_min_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT group_id, ELEMENTWISE_SUM( numeric_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<NUMERIC>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=HAVING_IN_AGGREGATE,NUMERIC_TYPE]
[name=aggregate_elementwise_sum_testtable_numeric_array_val_having_max]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT ELEMENTWISE_SUM( numeric_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]}]
==

[required_features=HAVING_IN_AGGREGATE,NUMERIC_TYPE]
[name=aggregate_elementwise_sum_testtable_numeric_array_val_having_max_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT group_id, ELEMENTWISE_SUM( numeric_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<NUMERIC>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,NUMERIC_TYPE]
[name=aggregate_elementwise_sum_testtable_numeric_array_val_distinct]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT ELEMENTWISE_SUM(DISTINCT numeric_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<NUMERIC>[known order:6, 9, 12, 12, NULL]}]
==

[required_features=GROUP_BY_ARRAY,NUMERIC_TYPE]
[name=aggregate_elementwise_sum_testtable_numeric_array_val_distinct_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT group_id, ELEMENTWISE_SUM(DISTINCT numeric_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<NUMERIC>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE,NUMERIC_TYPE]
[name=aggregate_elementwise_sum_testtable_numeric_array_val_distinct_having_min]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT ELEMENTWISE_SUM(DISTINCT numeric_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<NUMERIC>[known order:6, 9, 12, 12, NULL]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE,NUMERIC_TYPE]
[name=aggregate_elementwise_sum_testtable_numeric_array_val_distinct_having_min_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT group_id, ELEMENTWISE_SUM(DISTINCT numeric_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<NUMERIC>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE,NUMERIC_TYPE]
[name=aggregate_elementwise_sum_testtable_numeric_array_val_distinct_having_max]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT ELEMENTWISE_SUM(DISTINCT numeric_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE,NUMERIC_TYPE]
[name=aggregate_elementwise_sum_testtable_numeric_array_val_distinct_having_max_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT group_id, ELEMENTWISE_SUM(DISTINCT numeric_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<NUMERIC>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=BIGNUMERIC_TYPE]
[name=aggregate_elementwise_sum_testtable_bignumeric_array_val]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT ELEMENTWISE_SUM( bignumeric_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<BIGNUMERIC>[known order:9, 13, 17, 17, NULL]}]
==

[required_features=BIGNUMERIC_TYPE]
[name=aggregate_elementwise_sum_testtable_bignumeric_array_val_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT group_id, ELEMENTWISE_SUM( bignumeric_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<BIGNUMERIC>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=HAVING_IN_AGGREGATE,BIGNUMERIC_TYPE]
[name=aggregate_elementwise_sum_testtable_bignumeric_array_val_having_min]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT ELEMENTWISE_SUM( bignumeric_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<BIGNUMERIC>[known order:6, 9, 12, 12, NULL]}]
==

[required_features=HAVING_IN_AGGREGATE,BIGNUMERIC_TYPE]
[name=aggregate_elementwise_sum_testtable_bignumeric_array_val_having_min_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT group_id, ELEMENTWISE_SUM( bignumeric_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<BIGNUMERIC>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=HAVING_IN_AGGREGATE,BIGNUMERIC_TYPE]
[name=aggregate_elementwise_sum_testtable_bignumeric_array_val_having_max]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT ELEMENTWISE_SUM( bignumeric_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]}]
==

[required_features=HAVING_IN_AGGREGATE,BIGNUMERIC_TYPE]
[name=aggregate_elementwise_sum_testtable_bignumeric_array_val_having_max_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT group_id, ELEMENTWISE_SUM( bignumeric_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<BIGNUMERIC>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,BIGNUMERIC_TYPE]
[name=aggregate_elementwise_sum_testtable_bignumeric_array_val_distinct]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT ELEMENTWISE_SUM(DISTINCT bignumeric_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<BIGNUMERIC>[known order:6, 9, 12, 12, NULL]}]
==

[required_features=GROUP_BY_ARRAY,BIGNUMERIC_TYPE]
[name=aggregate_elementwise_sum_testtable_bignumeric_array_val_distinct_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT group_id, ELEMENTWISE_SUM(DISTINCT bignumeric_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<BIGNUMERIC>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE,BIGNUMERIC_TYPE]
[name=aggregate_elementwise_sum_testtable_bignumeric_array_val_distinct_having_min]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT ELEMENTWISE_SUM(DISTINCT bignumeric_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<BIGNUMERIC>[known order:6, 9, 12, 12, NULL]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE,BIGNUMERIC_TYPE]
[name=aggregate_elementwise_sum_testtable_bignumeric_array_val_distinct_having_min_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT group_id, ELEMENTWISE_SUM(DISTINCT bignumeric_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<BIGNUMERIC>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE,BIGNUMERIC_TYPE]
[name=aggregate_elementwise_sum_testtable_bignumeric_array_val_distinct_having_max]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT ELEMENTWISE_SUM(DISTINCT bignumeric_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE,BIGNUMERIC_TYPE]
[name=aggregate_elementwise_sum_testtable_bignumeric_array_val_distinct_having_max_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT group_id, ELEMENTWISE_SUM(DISTINCT bignumeric_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<BIGNUMERIC>[known order:6, 9, 12, 12, NULL]
  },
  {
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=INTERVAL_TYPE]
[name=aggregate_elementwise_sum_testtable_interval_array_val]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT ELEMENTWISE_SUM( interval_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[
  {ARRAY<INTERVAL>[known order:
     0-9 0 0:0:0,
     1-1 0 0:0:0,
     1-5 0 0:0:0,
     1-5 0 0:0:0,
     NULL
   ]}
]
==

[required_features=INTERVAL_TYPE]
[name=aggregate_elementwise_sum_testtable_interval_array_val_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT group_id, ELEMENTWISE_SUM( interval_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {1,
   ARRAY<INTERVAL>[known order:
     0-6 0 0:0:0,
     0-9 0 0:0:0,
     1-0 0 0:0:0,
     1-0 0 0:0:0,
     NULL
   ]},
  {2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]}
]
==

[required_features=HAVING_IN_AGGREGATE,INTERVAL_TYPE]
[name=aggregate_elementwise_sum_testtable_interval_array_val_having_min]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT ELEMENTWISE_SUM( interval_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[
  {ARRAY<INTERVAL>[known order:
     0-6 0 0:0:0,
     0-9 0 0:0:0,
     1-0 0 0:0:0,
     1-0 0 0:0:0,
     NULL
   ]}
]
==

[required_features=HAVING_IN_AGGREGATE,INTERVAL_TYPE]
[name=aggregate_elementwise_sum_testtable_interval_array_val_having_min_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT group_id, ELEMENTWISE_SUM( interval_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {1,
   ARRAY<INTERVAL>[known order:
     0-6 0 0:0:0,
     0-9 0 0:0:0,
     1-0 0 0:0:0,
     1-0 0 0:0:0,
     NULL
   ]},
  {2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]}
]
==

[required_features=HAVING_IN_AGGREGATE,INTERVAL_TYPE]
[name=aggregate_elementwise_sum_testtable_interval_array_val_having_max]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT ELEMENTWISE_SUM( interval_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[
  {ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]}
]
==

[required_features=HAVING_IN_AGGREGATE,INTERVAL_TYPE]
[name=aggregate_elementwise_sum_testtable_interval_array_val_having_max_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT group_id, ELEMENTWISE_SUM( interval_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {1,
   ARRAY<INTERVAL>[known order:
     0-6 0 0:0:0,
     0-9 0 0:0:0,
     1-0 0 0:0:0,
     1-0 0 0:0:0,
     NULL
   ]},
  {2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]}
]
==

[required_features=GROUP_BY_ARRAY,INTERVAL_TYPE]
[name=aggregate_elementwise_sum_testtable_interval_array_val_distinct]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT ELEMENTWISE_SUM(DISTINCT interval_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[
  {ARRAY<INTERVAL>[known order:
     0-6 0 0:0:0,
     0-9 0 0:0:0,
     1-0 0 0:0:0,
     1-0 0 0:0:0,
     NULL
   ]}
]
==

[required_features=GROUP_BY_ARRAY,INTERVAL_TYPE]
[name=aggregate_elementwise_sum_testtable_interval_array_val_distinct_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT group_id, ELEMENTWISE_SUM(DISTINCT interval_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {1,
   ARRAY<INTERVAL>[known order:
     0-6 0 0:0:0,
     0-9 0 0:0:0,
     1-0 0 0:0:0,
     1-0 0 0:0:0,
     NULL
   ]},
  {2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]}
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE,INTERVAL_TYPE]
[name=aggregate_elementwise_sum_testtable_interval_array_val_distinct_having_min]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT ELEMENTWISE_SUM(DISTINCT interval_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[
  {ARRAY<INTERVAL>[known order:
     0-6 0 0:0:0,
     0-9 0 0:0:0,
     1-0 0 0:0:0,
     1-0 0 0:0:0,
     NULL
   ]}
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE,INTERVAL_TYPE]
[name=aggregate_elementwise_sum_testtable_interval_array_val_distinct_having_min_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT group_id, ELEMENTWISE_SUM(DISTINCT interval_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {1,
   ARRAY<INTERVAL>[known order:
     0-6 0 0:0:0,
     0-9 0 0:0:0,
     1-0 0 0:0:0,
     1-0 0 0:0:0,
     NULL
   ]},
  {2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]}
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE,INTERVAL_TYPE]
[name=aggregate_elementwise_sum_testtable_interval_array_val_distinct_having_max]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT ELEMENTWISE_SUM(DISTINCT interval_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[
  {ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]}
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE,INTERVAL_TYPE]
[name=aggregate_elementwise_sum_testtable_interval_array_val_distinct_having_max_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT group_id, ELEMENTWISE_SUM(DISTINCT interval_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {1,
   ARRAY<INTERVAL>[known order:
     0-6 0 0:0:0,
     0-9 0 0:0:0,
     1-0 0 0:0:0,
     1-0 0 0:0:0,
     NULL
   ]},
  {2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]}
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_int32_array_val]
SELECT row_id, group_id, ELEMENTWISE_SUM(int32_array_val) OVER (  ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    2,
    1,
    ARRAY<INT64>[known order:9, 13, 17, 17, NULL]
  },
  {
    4,
    2,
    ARRAY<INT64>[known order:9, 13, 17, 17, NULL]
  },
  {
    6,
    2,
    ARRAY<INT64>[known order:9, 13, 17, 17, NULL]
  },
  {
    1,
    1,
    ARRAY<INT64>[known order:9, 13, 17, 17, NULL]
  },
  {
    3,
    1,
    ARRAY<INT64>[known order:9, 13, 17, 17, NULL]
  },
  {
    5,
    2,
    ARRAY<INT64>[known order:9, 13, 17, 17, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_int32_array_val_order_by]
SELECT row_id, group_id, ELEMENTWISE_SUM(int32_array_val) OVER ( ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<INT64>[known order:1, 2, 3, 3, NULL]
  },
  {
    2,
    1,
    ARRAY<INT64>[known order:3, 5, 7, 7, NULL]
  },
  {
    3,
    1,
    ARRAY<INT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    4,
    2,
    ARRAY<INT64>[known order:9, 13, 17, 17, NULL]
  },
  {
    5,
    2,
    ARRAY<INT64>[known order:9, 13, 17, 17, NULL]
  },
  {
    6,
    2,
    ARRAY<INT64>[known order:9, 13, 17, 17, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_int32_array_val_order_by_rows]
SELECT row_id, group_id, ELEMENTWISE_SUM(int32_array_val) OVER ( ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<INT64>[known order:3, 5, 7, 7, NULL]
  },
  {
    2,
    1,
    ARRAY<INT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    3,
    1,
    ARRAY<INT64>[known order:8, 11, 14, 14, NULL]
  },
  {
    4,
    2,
    ARRAY<INT64>[known order:6, 8, 10, 10, NULL]
  },
  {
    5,
    2,
    ARRAY<INT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<INT64>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_int32_array_val_order_by_range]
SELECT row_id, group_id, ELEMENTWISE_SUM(int32_array_val) OVER ( ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<INT64>[known order:3, 5, 7, 7, NULL]
  },
  {
    2,
    1,
    ARRAY<INT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    3,
    1,
    ARRAY<INT64>[known order:8, 11, 14, 14, NULL]
  },
  {
    4,
    2,
    ARRAY<INT64>[known order:6, 8, 10, 10, NULL]
  },
  {
    5,
    2,
    ARRAY<INT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<INT64>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_int32_array_val_partition_order_by]
SELECT row_id, group_id, ELEMENTWISE_SUM(int32_array_val) OVER (PARTITION BY group_id ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<INT64>[known order:1, 2, 3, 3, NULL]
  },
  {
    2,
    1,
    ARRAY<INT64>[known order:3, 5, 7, 7, NULL]
  },
  {
    3,
    1,
    ARRAY<INT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    4,
    2,
    ARRAY<INT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<INT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<INT64>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_int32_array_val_partition_order_by_rows]
SELECT row_id, group_id, ELEMENTWISE_SUM(int32_array_val) OVER (PARTITION BY group_id ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<INT64>[known order:3, 5, 7, 7, NULL]
  },
  {
    2,
    1,
    ARRAY<INT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    3,
    1,
    ARRAY<INT64>[known order:5, 7, 9, 9, NULL]
  },
  {
    4,
    2,
    ARRAY<INT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<INT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<INT64>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_int32_array_val_partition_order_by_range]
SELECT row_id, group_id, ELEMENTWISE_SUM(int32_array_val) OVER (PARTITION BY group_id ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<INT64>[known order:3, 5, 7, 7, NULL]
  },
  {
    2,
    1,
    ARRAY<INT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    3,
    1,
    ARRAY<INT64>[known order:5, 7, 9, 9, NULL]
  },
  {
    4,
    2,
    ARRAY<INT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<INT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<INT64>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_int64_array_val]
SELECT row_id, group_id, ELEMENTWISE_SUM(int64_array_val) OVER (  ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    2,
    1,
    ARRAY<INT64>[known order:9, 13, 17, 17, NULL]
  },
  {
    4,
    2,
    ARRAY<INT64>[known order:9, 13, 17, 17, NULL]
  },
  {
    6,
    2,
    ARRAY<INT64>[known order:9, 13, 17, 17, NULL]
  },
  {
    1,
    1,
    ARRAY<INT64>[known order:9, 13, 17, 17, NULL]
  },
  {
    3,
    1,
    ARRAY<INT64>[known order:9, 13, 17, 17, NULL]
  },
  {
    5,
    2,
    ARRAY<INT64>[known order:9, 13, 17, 17, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_int64_array_val_order_by]
SELECT row_id, group_id, ELEMENTWISE_SUM(int64_array_val) OVER ( ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<INT64>[known order:1, 2, 3, 3, NULL]
  },
  {
    2,
    1,
    ARRAY<INT64>[known order:3, 5, 7, 7, NULL]
  },
  {
    3,
    1,
    ARRAY<INT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    4,
    2,
    ARRAY<INT64>[known order:9, 13, 17, 17, NULL]
  },
  {
    5,
    2,
    ARRAY<INT64>[known order:9, 13, 17, 17, NULL]
  },
  {
    6,
    2,
    ARRAY<INT64>[known order:9, 13, 17, 17, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_int64_array_val_order_by_rows]
SELECT row_id, group_id, ELEMENTWISE_SUM(int64_array_val) OVER ( ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<INT64>[known order:3, 5, 7, 7, NULL]
  },
  {
    2,
    1,
    ARRAY<INT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    3,
    1,
    ARRAY<INT64>[known order:8, 11, 14, 14, NULL]
  },
  {
    4,
    2,
    ARRAY<INT64>[known order:6, 8, 10, 10, NULL]
  },
  {
    5,
    2,
    ARRAY<INT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<INT64>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_int64_array_val_order_by_range]
SELECT row_id, group_id, ELEMENTWISE_SUM(int64_array_val) OVER ( ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<INT64>[known order:3, 5, 7, 7, NULL]
  },
  {
    2,
    1,
    ARRAY<INT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    3,
    1,
    ARRAY<INT64>[known order:8, 11, 14, 14, NULL]
  },
  {
    4,
    2,
    ARRAY<INT64>[known order:6, 8, 10, 10, NULL]
  },
  {
    5,
    2,
    ARRAY<INT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<INT64>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_int64_array_val_partition_order_by]
SELECT row_id, group_id, ELEMENTWISE_SUM(int64_array_val) OVER (PARTITION BY group_id ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<INT64>[known order:1, 2, 3, 3, NULL]
  },
  {
    2,
    1,
    ARRAY<INT64>[known order:3, 5, 7, 7, NULL]
  },
  {
    3,
    1,
    ARRAY<INT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    4,
    2,
    ARRAY<INT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<INT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<INT64>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_int64_array_val_partition_order_by_rows]
SELECT row_id, group_id, ELEMENTWISE_SUM(int64_array_val) OVER (PARTITION BY group_id ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<INT64>[known order:3, 5, 7, 7, NULL]
  },
  {
    2,
    1,
    ARRAY<INT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    3,
    1,
    ARRAY<INT64>[known order:5, 7, 9, 9, NULL]
  },
  {
    4,
    2,
    ARRAY<INT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<INT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<INT64>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_int64_array_val_partition_order_by_range]
SELECT row_id, group_id, ELEMENTWISE_SUM(int64_array_val) OVER (PARTITION BY group_id ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<INT64>[known order:3, 5, 7, 7, NULL]
  },
  {
    2,
    1,
    ARRAY<INT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    3,
    1,
    ARRAY<INT64>[known order:5, 7, 9, 9, NULL]
  },
  {
    4,
    2,
    ARRAY<INT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<INT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<INT64>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_uint32_array_val]
SELECT row_id, group_id, ELEMENTWISE_SUM(uint32_array_val) OVER (  ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    2,
    1,
    ARRAY<UINT64>[known order:9, 13, 17, 17, NULL]
  },
  {
    4,
    2,
    ARRAY<UINT64>[known order:9, 13, 17, 17, NULL]
  },
  {
    6,
    2,
    ARRAY<UINT64>[known order:9, 13, 17, 17, NULL]
  },
  {
    1,
    1,
    ARRAY<UINT64>[known order:9, 13, 17, 17, NULL]
  },
  {
    3,
    1,
    ARRAY<UINT64>[known order:9, 13, 17, 17, NULL]
  },
  {
    5,
    2,
    ARRAY<UINT64>[known order:9, 13, 17, 17, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_uint32_array_val_order_by]
SELECT row_id, group_id, ELEMENTWISE_SUM(uint32_array_val) OVER ( ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<UINT64>[known order:1, 2, 3, 3, NULL]
  },
  {
    2,
    1,
    ARRAY<UINT64>[known order:3, 5, 7, 7, NULL]
  },
  {
    3,
    1,
    ARRAY<UINT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    4,
    2,
    ARRAY<UINT64>[known order:9, 13, 17, 17, NULL]
  },
  {
    5,
    2,
    ARRAY<UINT64>[known order:9, 13, 17, 17, NULL]
  },
  {
    6,
    2,
    ARRAY<UINT64>[known order:9, 13, 17, 17, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_uint32_array_val_order_by_rows]
SELECT row_id, group_id, ELEMENTWISE_SUM(uint32_array_val) OVER ( ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<UINT64>[known order:3, 5, 7, 7, NULL]
  },
  {
    2,
    1,
    ARRAY<UINT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    3,
    1,
    ARRAY<UINT64>[known order:8, 11, 14, 14, NULL]
  },
  {
    4,
    2,
    ARRAY<UINT64>[known order:6, 8, 10, 10, NULL]
  },
  {
    5,
    2,
    ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<UINT64>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_uint32_array_val_order_by_range]
SELECT row_id, group_id, ELEMENTWISE_SUM(uint32_array_val) OVER ( ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<UINT64>[known order:3, 5, 7, 7, NULL]
  },
  {
    2,
    1,
    ARRAY<UINT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    3,
    1,
    ARRAY<UINT64>[known order:8, 11, 14, 14, NULL]
  },
  {
    4,
    2,
    ARRAY<UINT64>[known order:6, 8, 10, 10, NULL]
  },
  {
    5,
    2,
    ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<UINT64>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_uint32_array_val_partition_order_by]
SELECT row_id, group_id, ELEMENTWISE_SUM(uint32_array_val) OVER (PARTITION BY group_id ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<UINT64>[known order:1, 2, 3, 3, NULL]
  },
  {
    2,
    1,
    ARRAY<UINT64>[known order:3, 5, 7, 7, NULL]
  },
  {
    3,
    1,
    ARRAY<UINT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    4,
    2,
    ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_uint32_array_val_partition_order_by_rows]
SELECT row_id, group_id, ELEMENTWISE_SUM(uint32_array_val) OVER (PARTITION BY group_id ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<UINT64>[known order:3, 5, 7, 7, NULL]
  },
  {
    2,
    1,
    ARRAY<UINT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    3,
    1,
    ARRAY<UINT64>[known order:5, 7, 9, 9, NULL]
  },
  {
    4,
    2,
    ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<UINT64>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_uint32_array_val_partition_order_by_range]
SELECT row_id, group_id, ELEMENTWISE_SUM(uint32_array_val) OVER (PARTITION BY group_id ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<UINT64>[known order:3, 5, 7, 7, NULL]
  },
  {
    2,
    1,
    ARRAY<UINT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    3,
    1,
    ARRAY<UINT64>[known order:5, 7, 9, 9, NULL]
  },
  {
    4,
    2,
    ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<UINT64>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_uint64_array_val]
SELECT row_id, group_id, ELEMENTWISE_SUM(uint64_array_val) OVER (  ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    2,
    1,
    ARRAY<UINT64>[known order:9, 13, 17, 17, NULL]
  },
  {
    4,
    2,
    ARRAY<UINT64>[known order:9, 13, 17, 17, NULL]
  },
  {
    6,
    2,
    ARRAY<UINT64>[known order:9, 13, 17, 17, NULL]
  },
  {
    1,
    1,
    ARRAY<UINT64>[known order:9, 13, 17, 17, NULL]
  },
  {
    3,
    1,
    ARRAY<UINT64>[known order:9, 13, 17, 17, NULL]
  },
  {
    5,
    2,
    ARRAY<UINT64>[known order:9, 13, 17, 17, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_uint64_array_val_order_by]
SELECT row_id, group_id, ELEMENTWISE_SUM(uint64_array_val) OVER ( ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<UINT64>[known order:1, 2, 3, 3, NULL]
  },
  {
    2,
    1,
    ARRAY<UINT64>[known order:3, 5, 7, 7, NULL]
  },
  {
    3,
    1,
    ARRAY<UINT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    4,
    2,
    ARRAY<UINT64>[known order:9, 13, 17, 17, NULL]
  },
  {
    5,
    2,
    ARRAY<UINT64>[known order:9, 13, 17, 17, NULL]
  },
  {
    6,
    2,
    ARRAY<UINT64>[known order:9, 13, 17, 17, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_uint64_array_val_order_by_rows]
SELECT row_id, group_id, ELEMENTWISE_SUM(uint64_array_val) OVER ( ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<UINT64>[known order:3, 5, 7, 7, NULL]
  },
  {
    2,
    1,
    ARRAY<UINT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    3,
    1,
    ARRAY<UINT64>[known order:8, 11, 14, 14, NULL]
  },
  {
    4,
    2,
    ARRAY<UINT64>[known order:6, 8, 10, 10, NULL]
  },
  {
    5,
    2,
    ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<UINT64>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_uint64_array_val_order_by_range]
SELECT row_id, group_id, ELEMENTWISE_SUM(uint64_array_val) OVER ( ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<UINT64>[known order:3, 5, 7, 7, NULL]
  },
  {
    2,
    1,
    ARRAY<UINT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    3,
    1,
    ARRAY<UINT64>[known order:8, 11, 14, 14, NULL]
  },
  {
    4,
    2,
    ARRAY<UINT64>[known order:6, 8, 10, 10, NULL]
  },
  {
    5,
    2,
    ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<UINT64>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_uint64_array_val_partition_order_by]
SELECT row_id, group_id, ELEMENTWISE_SUM(uint64_array_val) OVER (PARTITION BY group_id ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<UINT64>[known order:1, 2, 3, 3, NULL]
  },
  {
    2,
    1,
    ARRAY<UINT64>[known order:3, 5, 7, 7, NULL]
  },
  {
    3,
    1,
    ARRAY<UINT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    4,
    2,
    ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_uint64_array_val_partition_order_by_rows]
SELECT row_id, group_id, ELEMENTWISE_SUM(uint64_array_val) OVER (PARTITION BY group_id ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<UINT64>[known order:3, 5, 7, 7, NULL]
  },
  {
    2,
    1,
    ARRAY<UINT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    3,
    1,
    ARRAY<UINT64>[known order:5, 7, 9, 9, NULL]
  },
  {
    4,
    2,
    ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<UINT64>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_uint64_array_val_partition_order_by_range]
SELECT row_id, group_id, ELEMENTWISE_SUM(uint64_array_val) OVER (PARTITION BY group_id ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<UINT64>[known order:3, 5, 7, 7, NULL]
  },
  {
    2,
    1,
    ARRAY<UINT64>[known order:6, 9, 12, 12, NULL]
  },
  {
    3,
    1,
    ARRAY<UINT64>[known order:5, 7, 9, 9, NULL]
  },
  {
    4,
    2,
    ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<UINT64>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<UINT64>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_float_array_val]
SELECT row_id, group_id, ELEMENTWISE_SUM(float_array_val) OVER (  ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:9, 13, 17, 17, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:9, 13, 17, 17, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:9, 13, 17, 17, NULL]
  },
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:9, 13, 17, 17, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:9, 13, 17, 17, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:9, 13, 17, 17, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_float_array_val_order_by]
SELECT row_id, group_id, ELEMENTWISE_SUM(float_array_val) OVER ( ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1, 2, 3, 3, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:3, 5, 7, 7, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:6, 9, 12, 12, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:9, 13, 17, 17, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:9, 13, 17, 17, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:9, 13, 17, 17, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_float_array_val_order_by_rows]
SELECT row_id, group_id, ELEMENTWISE_SUM(float_array_val) OVER ( ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:3, 5, 7, 7, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:6, 9, 12, 12, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:8, 11, 14, 14, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:6, 8, 10, 10, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_float_array_val_order_by_range]
SELECT row_id, group_id, ELEMENTWISE_SUM(float_array_val) OVER ( ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:3, 5, 7, 7, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:6, 9, 12, 12, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:8, 11, 14, 14, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:6, 8, 10, 10, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_float_array_val_partition_order_by]
SELECT row_id, group_id, ELEMENTWISE_SUM(float_array_val) OVER (PARTITION BY group_id ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1, 2, 3, 3, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:3, 5, 7, 7, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:6, 9, 12, 12, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_float_array_val_partition_order_by_rows]
SELECT row_id, group_id, ELEMENTWISE_SUM(float_array_val) OVER (PARTITION BY group_id ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:3, 5, 7, 7, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:6, 9, 12, 12, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:5, 7, 9, 9, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_float_array_val_partition_order_by_range]
SELECT row_id, group_id, ELEMENTWISE_SUM(float_array_val) OVER (PARTITION BY group_id ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:3, 5, 7, 7, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:6, 9, 12, 12, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:5, 7, 9, 9, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_double_array_val]
SELECT row_id, group_id, ELEMENTWISE_SUM(double_array_val) OVER (  ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:9, 13, 17, 17, NULL, nan]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:9, 13, 17, 17, NULL, nan]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:9, 13, 17, 17, NULL, nan]
  },
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:9, 13, 17, 17, NULL, nan]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:9, 13, 17, 17, NULL, nan]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:9, 13, 17, 17, NULL, nan]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_double_array_val_order_by]
SELECT row_id, group_id, ELEMENTWISE_SUM(double_array_val) OVER ( ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1, 2, 3, 3, NULL, nan]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:3, 5, 7, 7, NULL, nan]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:6, 9, 12, 12, NULL, nan]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:9, 13, 17, 17, NULL, nan]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:9, 13, 17, 17, NULL, nan]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:9, 13, 17, 17, NULL, nan]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_double_array_val_order_by_rows]
SELECT row_id, group_id, ELEMENTWISE_SUM(double_array_val) OVER ( ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:3, 5, 7, 7, NULL, nan]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:6, 9, 12, 12, NULL, nan]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:8, 11, 14, 14, NULL, nan]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:6, 8, 10, 10, NULL, -inf]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_double_array_val_order_by_range]
SELECT row_id, group_id, ELEMENTWISE_SUM(double_array_val) OVER ( ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:3, 5, 7, 7, NULL, nan]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:6, 9, 12, 12, NULL, nan]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:8, 11, 14, 14, NULL, nan]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:6, 8, 10, 10, NULL, -inf]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_double_array_val_partition_order_by]
SELECT row_id, group_id, ELEMENTWISE_SUM(double_array_val) OVER (PARTITION BY group_id ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1, 2, 3, 3, NULL, nan]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:3, 5, 7, 7, NULL, nan]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:6, 9, 12, 12, NULL, nan]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_double_array_val_partition_order_by_rows]
SELECT row_id, group_id, ELEMENTWISE_SUM(double_array_val) OVER (PARTITION BY group_id ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:3, 5, 7, 7, NULL, nan]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:6, 9, 12, 12, NULL, nan]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:5, 7, 9, 9, NULL, nan]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_sum_testtable_double_array_val_partition_order_by_range]
SELECT row_id, group_id, ELEMENTWISE_SUM(double_array_val) OVER (PARTITION BY group_id ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:3, 5, 7, 7, NULL, nan]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:6, 9, 12, 12, NULL, nan]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:5, 7, 9, 9, NULL, nan]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,NUMERIC_TYPE]
[name=window_elementwise_sum_testtable_numeric_array_val]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT row_id, group_id, ELEMENTWISE_SUM(numeric_array_val) OVER (  ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    2,
    1,
    ARRAY<NUMERIC>[known order:9, 13, 17, 17, NULL]
  },
  {
    4,
    2,
    ARRAY<NUMERIC>[known order:9, 13, 17, 17, NULL]
  },
  {
    6,
    2,
    ARRAY<NUMERIC>[known order:9, 13, 17, 17, NULL]
  },
  {
    1,
    1,
    ARRAY<NUMERIC>[known order:9, 13, 17, 17, NULL]
  },
  {
    3,
    1,
    ARRAY<NUMERIC>[known order:9, 13, 17, 17, NULL]
  },
  {
    5,
    2,
    ARRAY<NUMERIC>[known order:9, 13, 17, 17, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,NUMERIC_TYPE]
[name=window_elementwise_sum_testtable_numeric_array_val_order_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT row_id, group_id, ELEMENTWISE_SUM(numeric_array_val) OVER ( ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<NUMERIC>[known order:1, 2, 3, 3, NULL]
  },
  {
    2,
    1,
    ARRAY<NUMERIC>[known order:3, 5, 7, 7, NULL]
  },
  {
    3,
    1,
    ARRAY<NUMERIC>[known order:6, 9, 12, 12, NULL]
  },
  {
    4,
    2,
    ARRAY<NUMERIC>[known order:9, 13, 17, 17, NULL]
  },
  {
    5,
    2,
    ARRAY<NUMERIC>[known order:9, 13, 17, 17, NULL]
  },
  {
    6,
    2,
    ARRAY<NUMERIC>[known order:9, 13, 17, 17, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,NUMERIC_TYPE]
[name=window_elementwise_sum_testtable_numeric_array_val_order_by_rows]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT row_id, group_id, ELEMENTWISE_SUM(numeric_array_val) OVER ( ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<NUMERIC>[known order:3, 5, 7, 7, NULL]
  },
  {
    2,
    1,
    ARRAY<NUMERIC>[known order:6, 9, 12, 12, NULL]
  },
  {
    3,
    1,
    ARRAY<NUMERIC>[known order:8, 11, 14, 14, NULL]
  },
  {
    4,
    2,
    ARRAY<NUMERIC>[known order:6, 8, 10, 10, NULL]
  },
  {
    5,
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<NUMERIC>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,NUMERIC_TYPE]
[name=window_elementwise_sum_testtable_numeric_array_val_order_by_range]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT row_id, group_id, ELEMENTWISE_SUM(numeric_array_val) OVER ( ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<NUMERIC>[known order:3, 5, 7, 7, NULL]
  },
  {
    2,
    1,
    ARRAY<NUMERIC>[known order:6, 9, 12, 12, NULL]
  },
  {
    3,
    1,
    ARRAY<NUMERIC>[known order:8, 11, 14, 14, NULL]
  },
  {
    4,
    2,
    ARRAY<NUMERIC>[known order:6, 8, 10, 10, NULL]
  },
  {
    5,
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<NUMERIC>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,NUMERIC_TYPE]
[name=window_elementwise_sum_testtable_numeric_array_val_partition_order_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT row_id, group_id, ELEMENTWISE_SUM(numeric_array_val) OVER (PARTITION BY group_id ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<NUMERIC>[known order:1, 2, 3, 3, NULL]
  },
  {
    2,
    1,
    ARRAY<NUMERIC>[known order:3, 5, 7, 7, NULL]
  },
  {
    3,
    1,
    ARRAY<NUMERIC>[known order:6, 9, 12, 12, NULL]
  },
  {
    4,
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,NUMERIC_TYPE]
[name=window_elementwise_sum_testtable_numeric_array_val_partition_order_by_rows]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT row_id, group_id, ELEMENTWISE_SUM(numeric_array_val) OVER (PARTITION BY group_id ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<NUMERIC>[known order:3, 5, 7, 7, NULL]
  },
  {
    2,
    1,
    ARRAY<NUMERIC>[known order:6, 9, 12, 12, NULL]
  },
  {
    3,
    1,
    ARRAY<NUMERIC>[known order:5, 7, 9, 9, NULL]
  },
  {
    4,
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<NUMERIC>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,NUMERIC_TYPE]
[name=window_elementwise_sum_testtable_numeric_array_val_partition_order_by_range]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT row_id, group_id, ELEMENTWISE_SUM(numeric_array_val) OVER (PARTITION BY group_id ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<NUMERIC>[known order:3, 5, 7, 7, NULL]
  },
  {
    2,
    1,
    ARRAY<NUMERIC>[known order:6, 9, 12, 12, NULL]
  },
  {
    3,
    1,
    ARRAY<NUMERIC>[known order:5, 7, 9, 9, NULL]
  },
  {
    4,
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<NUMERIC>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,BIGNUMERIC_TYPE]
[name=window_elementwise_sum_testtable_bignumeric_array_val]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT row_id, group_id, ELEMENTWISE_SUM(bignumeric_array_val) OVER (  ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    2,
    1,
    ARRAY<BIGNUMERIC>[known order:9, 13, 17, 17, NULL]
  },
  {
    4,
    2,
    ARRAY<BIGNUMERIC>[known order:9, 13, 17, 17, NULL]
  },
  {
    6,
    2,
    ARRAY<BIGNUMERIC>[known order:9, 13, 17, 17, NULL]
  },
  {
    1,
    1,
    ARRAY<BIGNUMERIC>[known order:9, 13, 17, 17, NULL]
  },
  {
    3,
    1,
    ARRAY<BIGNUMERIC>[known order:9, 13, 17, 17, NULL]
  },
  {
    5,
    2,
    ARRAY<BIGNUMERIC>[known order:9, 13, 17, 17, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,BIGNUMERIC_TYPE]
[name=window_elementwise_sum_testtable_bignumeric_array_val_order_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT row_id, group_id, ELEMENTWISE_SUM(bignumeric_array_val) OVER ( ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<BIGNUMERIC>[known order:1, 2, 3, 3, NULL]
  },
  {
    2,
    1,
    ARRAY<BIGNUMERIC>[known order:3, 5, 7, 7, NULL]
  },
  {
    3,
    1,
    ARRAY<BIGNUMERIC>[known order:6, 9, 12, 12, NULL]
  },
  {
    4,
    2,
    ARRAY<BIGNUMERIC>[known order:9, 13, 17, 17, NULL]
  },
  {
    5,
    2,
    ARRAY<BIGNUMERIC>[known order:9, 13, 17, 17, NULL]
  },
  {
    6,
    2,
    ARRAY<BIGNUMERIC>[known order:9, 13, 17, 17, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,BIGNUMERIC_TYPE]
[name=window_elementwise_sum_testtable_bignumeric_array_val_order_by_rows]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT row_id, group_id, ELEMENTWISE_SUM(bignumeric_array_val) OVER ( ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<BIGNUMERIC>[known order:3, 5, 7, 7, NULL]
  },
  {
    2,
    1,
    ARRAY<BIGNUMERIC>[known order:6, 9, 12, 12, NULL]
  },
  {
    3,
    1,
    ARRAY<BIGNUMERIC>[known order:8, 11, 14, 14, NULL]
  },
  {
    4,
    2,
    ARRAY<BIGNUMERIC>[known order:6, 8, 10, 10, NULL]
  },
  {
    5,
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<BIGNUMERIC>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,BIGNUMERIC_TYPE]
[name=window_elementwise_sum_testtable_bignumeric_array_val_order_by_range]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT row_id, group_id, ELEMENTWISE_SUM(bignumeric_array_val) OVER ( ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<BIGNUMERIC>[known order:3, 5, 7, 7, NULL]
  },
  {
    2,
    1,
    ARRAY<BIGNUMERIC>[known order:6, 9, 12, 12, NULL]
  },
  {
    3,
    1,
    ARRAY<BIGNUMERIC>[known order:8, 11, 14, 14, NULL]
  },
  {
    4,
    2,
    ARRAY<BIGNUMERIC>[known order:6, 8, 10, 10, NULL]
  },
  {
    5,
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<BIGNUMERIC>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,BIGNUMERIC_TYPE]
[name=window_elementwise_sum_testtable_bignumeric_array_val_partition_order_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT row_id, group_id, ELEMENTWISE_SUM(bignumeric_array_val) OVER (PARTITION BY group_id ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<BIGNUMERIC>[known order:1, 2, 3, 3, NULL]
  },
  {
    2,
    1,
    ARRAY<BIGNUMERIC>[known order:3, 5, 7, 7, NULL]
  },
  {
    3,
    1,
    ARRAY<BIGNUMERIC>[known order:6, 9, 12, 12, NULL]
  },
  {
    4,
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,BIGNUMERIC_TYPE]
[name=window_elementwise_sum_testtable_bignumeric_array_val_partition_order_by_rows]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT row_id, group_id, ELEMENTWISE_SUM(bignumeric_array_val) OVER (PARTITION BY group_id ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<BIGNUMERIC>[known order:3, 5, 7, 7, NULL]
  },
  {
    2,
    1,
    ARRAY<BIGNUMERIC>[known order:6, 9, 12, 12, NULL]
  },
  {
    3,
    1,
    ARRAY<BIGNUMERIC>[known order:5, 7, 9, 9, NULL]
  },
  {
    4,
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<BIGNUMERIC>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,BIGNUMERIC_TYPE]
[name=window_elementwise_sum_testtable_bignumeric_array_val_partition_order_by_range]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT row_id, group_id, ELEMENTWISE_SUM(bignumeric_array_val) OVER (PARTITION BY group_id ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<BIGNUMERIC>[known order:3, 5, 7, 7, NULL]
  },
  {
    2,
    1,
    ARRAY<BIGNUMERIC>[known order:6, 9, 12, 12, NULL]
  },
  {
    3,
    1,
    ARRAY<BIGNUMERIC>[known order:5, 7, 9, 9, NULL]
  },
  {
    4,
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<BIGNUMERIC>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,INTERVAL_TYPE]
[name=window_elementwise_sum_testtable_interval_array_val]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT row_id, group_id, ELEMENTWISE_SUM(interval_array_val) OVER (  ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {2,
   1,
   ARRAY<INTERVAL>[known order:
     0-9 0 0:0:0,
     1-1 0 0:0:0,
     1-5 0 0:0:0,
     1-5 0 0:0:0,
     NULL
   ]},
  {4,
   2,
   ARRAY<INTERVAL>[known order:
     0-9 0 0:0:0,
     1-1 0 0:0:0,
     1-5 0 0:0:0,
     1-5 0 0:0:0,
     NULL
   ]},
  {6,
   2,
   ARRAY<INTERVAL>[known order:
     0-9 0 0:0:0,
     1-1 0 0:0:0,
     1-5 0 0:0:0,
     1-5 0 0:0:0,
     NULL
   ]},
  {1,
   1,
   ARRAY<INTERVAL>[known order:
     0-9 0 0:0:0,
     1-1 0 0:0:0,
     1-5 0 0:0:0,
     1-5 0 0:0:0,
     NULL
   ]},
  {3,
   1,
   ARRAY<INTERVAL>[known order:
     0-9 0 0:0:0,
     1-1 0 0:0:0,
     1-5 0 0:0:0,
     1-5 0 0:0:0,
     NULL
   ]},
  {5,
   2,
   ARRAY<INTERVAL>[known order:
     0-9 0 0:0:0,
     1-1 0 0:0:0,
     1-5 0 0:0:0,
     1-5 0 0:0:0,
     NULL
   ]}
]
==

[required_features=ANALYTIC_FUNCTIONS,INTERVAL_TYPE]
[name=window_elementwise_sum_testtable_interval_array_val_order_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT row_id, group_id, ELEMENTWISE_SUM(interval_array_val) OVER ( ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {1,
   1,
   ARRAY<INTERVAL>[known order:
     0-1 0 0:0:0,
     0-2 0 0:0:0,
     0-3 0 0:0:0,
     0-3 0 0:0:0,
     NULL
   ]},
  {2,
   1,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-5 0 0:0:0,
     0-7 0 0:0:0,
     0-7 0 0:0:0,
     NULL
   ]},
  {3,
   1,
   ARRAY<INTERVAL>[known order:
     0-6 0 0:0:0,
     0-9 0 0:0:0,
     1-0 0 0:0:0,
     1-0 0 0:0:0,
     NULL
   ]},
  {4,
   2,
   ARRAY<INTERVAL>[known order:
     0-9 0 0:0:0,
     1-1 0 0:0:0,
     1-5 0 0:0:0,
     1-5 0 0:0:0,
     NULL
   ]},
  {5,
   2,
   ARRAY<INTERVAL>[known order:
     0-9 0 0:0:0,
     1-1 0 0:0:0,
     1-5 0 0:0:0,
     1-5 0 0:0:0,
     NULL
   ]},
  {6,
   2,
   ARRAY<INTERVAL>[known order:
     0-9 0 0:0:0,
     1-1 0 0:0:0,
     1-5 0 0:0:0,
     1-5 0 0:0:0,
     NULL
   ]}
]
==

[required_features=ANALYTIC_FUNCTIONS,INTERVAL_TYPE]
[name=window_elementwise_sum_testtable_interval_array_val_order_by_rows]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT row_id, group_id, ELEMENTWISE_SUM(interval_array_val) OVER ( ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {1,
   1,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-5 0 0:0:0,
     0-7 0 0:0:0,
     0-7 0 0:0:0,
     NULL
   ]},
  {2,
   1,
   ARRAY<INTERVAL>[known order:
     0-6 0 0:0:0,
     0-9 0 0:0:0,
     1-0 0 0:0:0,
     1-0 0 0:0:0,
     NULL
   ]},
  {3,
   1,
   ARRAY<INTERVAL>[known order:
     0-8 0 0:0:0,
     0-11 0 0:0:0,
     1-2 0 0:0:0,
     1-2 0 0:0:0,
     NULL
   ]},
  {4,
   2,
   ARRAY<INTERVAL>[known order:
     0-6 0 0:0:0,
     0-8 0 0:0:0,
     0-10 0 0:0:0,
     0-10 0 0:0:0,
     NULL
   ]},
  {5,
   2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]},
  {
    6,
    2,
    ARRAY<INTERVAL>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,INTERVAL_TYPE]
[name=window_elementwise_sum_testtable_interval_array_val_order_by_range]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT row_id, group_id, ELEMENTWISE_SUM(interval_array_val) OVER ( ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {1,
   1,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-5 0 0:0:0,
     0-7 0 0:0:0,
     0-7 0 0:0:0,
     NULL
   ]},
  {2,
   1,
   ARRAY<INTERVAL>[known order:
     0-6 0 0:0:0,
     0-9 0 0:0:0,
     1-0 0 0:0:0,
     1-0 0 0:0:0,
     NULL
   ]},
  {3,
   1,
   ARRAY<INTERVAL>[known order:
     0-8 0 0:0:0,
     0-11 0 0:0:0,
     1-2 0 0:0:0,
     1-2 0 0:0:0,
     NULL
   ]},
  {4,
   2,
   ARRAY<INTERVAL>[known order:
     0-6 0 0:0:0,
     0-8 0 0:0:0,
     0-10 0 0:0:0,
     0-10 0 0:0:0,
     NULL
   ]},
  {5,
   2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]},
  {
    6,
    2,
    ARRAY<INTERVAL>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,INTERVAL_TYPE]
[name=window_elementwise_sum_testtable_interval_array_val_partition_order_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT row_id, group_id, ELEMENTWISE_SUM(interval_array_val) OVER (PARTITION BY group_id ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {1,
   1,
   ARRAY<INTERVAL>[known order:
     0-1 0 0:0:0,
     0-2 0 0:0:0,
     0-3 0 0:0:0,
     0-3 0 0:0:0,
     NULL
   ]},
  {2,
   1,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-5 0 0:0:0,
     0-7 0 0:0:0,
     0-7 0 0:0:0,
     NULL
   ]},
  {3,
   1,
   ARRAY<INTERVAL>[known order:
     0-6 0 0:0:0,
     0-9 0 0:0:0,
     1-0 0 0:0:0,
     1-0 0 0:0:0,
     NULL
   ]},
  {4,
   2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]},
  {5,
   2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]},
  {6,
   2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]}
]
==

[required_features=ANALYTIC_FUNCTIONS,INTERVAL_TYPE]
[name=window_elementwise_sum_testtable_interval_array_val_partition_order_by_rows]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT row_id, group_id, ELEMENTWISE_SUM(interval_array_val) OVER (PARTITION BY group_id ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {1,
   1,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-5 0 0:0:0,
     0-7 0 0:0:0,
     0-7 0 0:0:0,
     NULL
   ]},
  {2,
   1,
   ARRAY<INTERVAL>[known order:
     0-6 0 0:0:0,
     0-9 0 0:0:0,
     1-0 0 0:0:0,
     1-0 0 0:0:0,
     NULL
   ]},
  {3,
   1,
   ARRAY<INTERVAL>[known order:
     0-5 0 0:0:0,
     0-7 0 0:0:0,
     0-9 0 0:0:0,
     0-9 0 0:0:0,
     NULL
   ]},
  {4,
   2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]},
  {5,
   2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]},
  {
    6,
    2,
    ARRAY<INTERVAL>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,INTERVAL_TYPE]
[name=window_elementwise_sum_testtable_interval_array_val_partition_order_by_range]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT row_id, group_id, ELEMENTWISE_SUM(interval_array_val) OVER (PARTITION BY group_id ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {1,
   1,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-5 0 0:0:0,
     0-7 0 0:0:0,
     0-7 0 0:0:0,
     NULL
   ]},
  {2,
   1,
   ARRAY<INTERVAL>[known order:
     0-6 0 0:0:0,
     0-9 0 0:0:0,
     1-0 0 0:0:0,
     1-0 0 0:0:0,
     NULL
   ]},
  {3,
   1,
   ARRAY<INTERVAL>[known order:
     0-5 0 0:0:0,
     0-7 0 0:0:0,
     0-9 0 0:0:0,
     0-9 0 0:0:0,
     NULL
   ]},
  {4,
   2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]},
  {5,
   2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]},
  {
    6,
    2,
    ARRAY<INTERVAL>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[name=aggregate_elementwise_avg_testtable_int32_array_val]
SELECT ELEMENTWISE_AVG( int32_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[
  {ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]}
]
==

[name=aggregate_elementwise_avg_testtable_int32_array_val_group_by]
SELECT group_id, ELEMENTWISE_AVG( int32_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_int32_array_val_having_min]
SELECT ELEMENTWISE_AVG( int32_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]}]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_int32_array_val_having_min_group_by]
SELECT group_id, ELEMENTWISE_AVG( int32_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_int32_array_val_having_max]
SELECT ELEMENTWISE_AVG( int32_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]}]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_int32_array_val_having_max_group_by]
SELECT group_id, ELEMENTWISE_AVG( int32_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY]
[name=aggregate_elementwise_avg_testtable_int32_array_val_distinct]
SELECT ELEMENTWISE_AVG(DISTINCT int32_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]}]
==

[required_features=GROUP_BY_ARRAY]
[name=aggregate_elementwise_avg_testtable_int32_array_val_distinct_group_by]
SELECT group_id, ELEMENTWISE_AVG(DISTINCT int32_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_int32_array_val_distinct_having_min]
SELECT ELEMENTWISE_AVG(DISTINCT int32_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_int32_array_val_distinct_having_min_group_by]
SELECT group_id, ELEMENTWISE_AVG(DISTINCT int32_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_int32_array_val_distinct_having_max]
SELECT ELEMENTWISE_AVG(DISTINCT int32_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_int32_array_val_distinct_having_max_group_by]
SELECT group_id, ELEMENTWISE_AVG(DISTINCT int32_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[name=aggregate_elementwise_avg_testtable_int64_array_val]
SELECT ELEMENTWISE_AVG( int64_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[
  {ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]}
]
==

[name=aggregate_elementwise_avg_testtable_int64_array_val_group_by]
SELECT group_id, ELEMENTWISE_AVG( int64_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_int64_array_val_having_min]
SELECT ELEMENTWISE_AVG( int64_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]}]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_int64_array_val_having_min_group_by]
SELECT group_id, ELEMENTWISE_AVG( int64_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_int64_array_val_having_max]
SELECT ELEMENTWISE_AVG( int64_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]}]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_int64_array_val_having_max_group_by]
SELECT group_id, ELEMENTWISE_AVG( int64_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY]
[name=aggregate_elementwise_avg_testtable_int64_array_val_distinct]
SELECT ELEMENTWISE_AVG(DISTINCT int64_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]}]
==

[required_features=GROUP_BY_ARRAY]
[name=aggregate_elementwise_avg_testtable_int64_array_val_distinct_group_by]
SELECT group_id, ELEMENTWISE_AVG(DISTINCT int64_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_int64_array_val_distinct_having_min]
SELECT ELEMENTWISE_AVG(DISTINCT int64_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_int64_array_val_distinct_having_min_group_by]
SELECT group_id, ELEMENTWISE_AVG(DISTINCT int64_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_int64_array_val_distinct_having_max]
SELECT ELEMENTWISE_AVG(DISTINCT int64_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_int64_array_val_distinct_having_max_group_by]
SELECT group_id, ELEMENTWISE_AVG(DISTINCT int64_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[name=aggregate_elementwise_avg_testtable_uint32_array_val]
SELECT ELEMENTWISE_AVG( uint32_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[
  {ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]}
]
==

[name=aggregate_elementwise_avg_testtable_uint32_array_val_group_by]
SELECT group_id, ELEMENTWISE_AVG( uint32_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_uint32_array_val_having_min]
SELECT ELEMENTWISE_AVG( uint32_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]}]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_uint32_array_val_having_min_group_by]
SELECT group_id, ELEMENTWISE_AVG( uint32_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_uint32_array_val_having_max]
SELECT ELEMENTWISE_AVG( uint32_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]}]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_uint32_array_val_having_max_group_by]
SELECT group_id, ELEMENTWISE_AVG( uint32_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY]
[name=aggregate_elementwise_avg_testtable_uint32_array_val_distinct]
SELECT ELEMENTWISE_AVG(DISTINCT uint32_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]}]
==

[required_features=GROUP_BY_ARRAY]
[name=aggregate_elementwise_avg_testtable_uint32_array_val_distinct_group_by]
SELECT group_id, ELEMENTWISE_AVG(DISTINCT uint32_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_uint32_array_val_distinct_having_min]
SELECT ELEMENTWISE_AVG(DISTINCT uint32_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_uint32_array_val_distinct_having_min_group_by]
SELECT group_id, ELEMENTWISE_AVG(DISTINCT uint32_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_uint32_array_val_distinct_having_max]
SELECT ELEMENTWISE_AVG(DISTINCT uint32_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_uint32_array_val_distinct_having_max_group_by]
SELECT group_id, ELEMENTWISE_AVG(DISTINCT uint32_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[name=aggregate_elementwise_avg_testtable_uint64_array_val]
SELECT ELEMENTWISE_AVG( uint64_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[
  {ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]}
]
==

[name=aggregate_elementwise_avg_testtable_uint64_array_val_group_by]
SELECT group_id, ELEMENTWISE_AVG( uint64_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_uint64_array_val_having_min]
SELECT ELEMENTWISE_AVG( uint64_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]}]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_uint64_array_val_having_min_group_by]
SELECT group_id, ELEMENTWISE_AVG( uint64_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_uint64_array_val_having_max]
SELECT ELEMENTWISE_AVG( uint64_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]}]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_uint64_array_val_having_max_group_by]
SELECT group_id, ELEMENTWISE_AVG( uint64_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY]
[name=aggregate_elementwise_avg_testtable_uint64_array_val_distinct]
SELECT ELEMENTWISE_AVG(DISTINCT uint64_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]}]
==

[required_features=GROUP_BY_ARRAY]
[name=aggregate_elementwise_avg_testtable_uint64_array_val_distinct_group_by]
SELECT group_id, ELEMENTWISE_AVG(DISTINCT uint64_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_uint64_array_val_distinct_having_min]
SELECT ELEMENTWISE_AVG(DISTINCT uint64_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_uint64_array_val_distinct_having_min_group_by]
SELECT group_id, ELEMENTWISE_AVG(DISTINCT uint64_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_uint64_array_val_distinct_having_max]
SELECT ELEMENTWISE_AVG(DISTINCT uint64_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_uint64_array_val_distinct_having_max_group_by]
SELECT group_id, ELEMENTWISE_AVG(DISTINCT uint64_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[name=aggregate_elementwise_avg_testtable_float_array_val]
SELECT ELEMENTWISE_AVG( float_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[
  {ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]}
]
==

[name=aggregate_elementwise_avg_testtable_float_array_val_group_by]
SELECT group_id, ELEMENTWISE_AVG( float_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_float_array_val_having_min]
SELECT ELEMENTWISE_AVG( float_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]}]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_float_array_val_having_min_group_by]
SELECT group_id, ELEMENTWISE_AVG( float_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_float_array_val_having_max]
SELECT ELEMENTWISE_AVG( float_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]}]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_float_array_val_having_max_group_by]
SELECT group_id, ELEMENTWISE_AVG( float_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY]
[name=aggregate_elementwise_avg_testtable_float_array_val_distinct]
SELECT ELEMENTWISE_AVG(DISTINCT float_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]}]
==

[required_features=GROUP_BY_ARRAY]
[name=aggregate_elementwise_avg_testtable_float_array_val_distinct_group_by]
SELECT group_id, ELEMENTWISE_AVG(DISTINCT float_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_float_array_val_distinct_having_min]
SELECT ELEMENTWISE_AVG(DISTINCT float_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_float_array_val_distinct_having_min_group_by]
SELECT group_id, ELEMENTWISE_AVG(DISTINCT float_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_float_array_val_distinct_having_max]
SELECT ELEMENTWISE_AVG(DISTINCT float_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_float_array_val_distinct_having_max_group_by]
SELECT group_id, ELEMENTWISE_AVG(DISTINCT float_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[name=aggregate_elementwise_avg_testtable_double_array_val]
SELECT ELEMENTWISE_AVG( double_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[
  {ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL, nan]}
]
==

[name=aggregate_elementwise_avg_testtable_double_array_val_group_by]
SELECT group_id, ELEMENTWISE_AVG( double_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL, nan]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]
  }
]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_double_array_val_having_min]
SELECT ELEMENTWISE_AVG( double_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL, nan]}]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_double_array_val_having_min_group_by]
SELECT group_id, ELEMENTWISE_AVG( double_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL, nan]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]
  }
]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_double_array_val_having_max]
SELECT ELEMENTWISE_AVG( double_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]}]
==

[required_features=HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_double_array_val_having_max_group_by]
SELECT group_id, ELEMENTWISE_AVG( double_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL, nan]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]
  }
]
==

[required_features=GROUP_BY_ARRAY]
[name=aggregate_elementwise_avg_testtable_double_array_val_distinct]
SELECT ELEMENTWISE_AVG(DISTINCT double_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[
  {ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL, nan]}
]
==

[required_features=GROUP_BY_ARRAY]
[name=aggregate_elementwise_avg_testtable_double_array_val_distinct_group_by]
SELECT group_id, ELEMENTWISE_AVG(DISTINCT double_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL, nan]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_double_array_val_distinct_having_min]
SELECT ELEMENTWISE_AVG(DISTINCT double_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL, nan]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_double_array_val_distinct_having_min_group_by]
SELECT group_id, ELEMENTWISE_AVG(DISTINCT double_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL, nan]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_double_array_val_distinct_having_max]
SELECT ELEMENTWISE_AVG(DISTINCT double_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE]
[name=aggregate_elementwise_avg_testtable_double_array_val_distinct_having_max_group_by]
SELECT group_id, ELEMENTWISE_AVG(DISTINCT double_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL, nan]
  },
  {
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]
  }
]
==

[required_features=NUMERIC_TYPE]
[name=aggregate_elementwise_avg_testtable_numeric_array_val]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT ELEMENTWISE_AVG( numeric_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[
  {ARRAY<NUMERIC>[known order:2.25, 3.25, 4.25, 4.25, NULL]}
]
==

[required_features=NUMERIC_TYPE]
[name=aggregate_elementwise_avg_testtable_numeric_array_val_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT group_id, ELEMENTWISE_AVG( numeric_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<NUMERIC>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=HAVING_IN_AGGREGATE,NUMERIC_TYPE]
[name=aggregate_elementwise_avg_testtable_numeric_array_val_having_min]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT ELEMENTWISE_AVG( numeric_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<NUMERIC>[known order:2, 3, 4, 4, NULL]}]
==

[required_features=HAVING_IN_AGGREGATE,NUMERIC_TYPE]
[name=aggregate_elementwise_avg_testtable_numeric_array_val_having_min_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT group_id, ELEMENTWISE_AVG( numeric_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<NUMERIC>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=HAVING_IN_AGGREGATE,NUMERIC_TYPE]
[name=aggregate_elementwise_avg_testtable_numeric_array_val_having_max]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT ELEMENTWISE_AVG( numeric_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]}]
==

[required_features=HAVING_IN_AGGREGATE,NUMERIC_TYPE]
[name=aggregate_elementwise_avg_testtable_numeric_array_val_having_max_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT group_id, ELEMENTWISE_AVG( numeric_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<NUMERIC>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,NUMERIC_TYPE]
[name=aggregate_elementwise_avg_testtable_numeric_array_val_distinct]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT ELEMENTWISE_AVG(DISTINCT numeric_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<NUMERIC>[known order:2, 3, 4, 4, NULL]}]
==

[required_features=GROUP_BY_ARRAY,NUMERIC_TYPE]
[name=aggregate_elementwise_avg_testtable_numeric_array_val_distinct_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT group_id, ELEMENTWISE_AVG(DISTINCT numeric_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<NUMERIC>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE,NUMERIC_TYPE]
[name=aggregate_elementwise_avg_testtable_numeric_array_val_distinct_having_min]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT ELEMENTWISE_AVG(DISTINCT numeric_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<NUMERIC>[known order:2, 3, 4, 4, NULL]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE,NUMERIC_TYPE]
[name=aggregate_elementwise_avg_testtable_numeric_array_val_distinct_having_min_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT group_id, ELEMENTWISE_AVG(DISTINCT numeric_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<NUMERIC>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE,NUMERIC_TYPE]
[name=aggregate_elementwise_avg_testtable_numeric_array_val_distinct_having_max]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT ELEMENTWISE_AVG(DISTINCT numeric_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE,NUMERIC_TYPE]
[name=aggregate_elementwise_avg_testtable_numeric_array_val_distinct_having_max_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT group_id, ELEMENTWISE_AVG(DISTINCT numeric_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<NUMERIC>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=BIGNUMERIC_TYPE]
[name=aggregate_elementwise_avg_testtable_bignumeric_array_val]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT ELEMENTWISE_AVG( bignumeric_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[
  {ARRAY<BIGNUMERIC>[known order:2.25, 3.25, 4.25, 4.25, NULL]}
]
==

[required_features=BIGNUMERIC_TYPE]
[name=aggregate_elementwise_avg_testtable_bignumeric_array_val_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT group_id, ELEMENTWISE_AVG( bignumeric_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<BIGNUMERIC>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=HAVING_IN_AGGREGATE,BIGNUMERIC_TYPE]
[name=aggregate_elementwise_avg_testtable_bignumeric_array_val_having_min]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT ELEMENTWISE_AVG( bignumeric_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<BIGNUMERIC>[known order:2, 3, 4, 4, NULL]}]
==

[required_features=HAVING_IN_AGGREGATE,BIGNUMERIC_TYPE]
[name=aggregate_elementwise_avg_testtable_bignumeric_array_val_having_min_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT group_id, ELEMENTWISE_AVG( bignumeric_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<BIGNUMERIC>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=HAVING_IN_AGGREGATE,BIGNUMERIC_TYPE]
[name=aggregate_elementwise_avg_testtable_bignumeric_array_val_having_max]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT ELEMENTWISE_AVG( bignumeric_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]}]
==

[required_features=HAVING_IN_AGGREGATE,BIGNUMERIC_TYPE]
[name=aggregate_elementwise_avg_testtable_bignumeric_array_val_having_max_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT group_id, ELEMENTWISE_AVG( bignumeric_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<BIGNUMERIC>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,BIGNUMERIC_TYPE]
[name=aggregate_elementwise_avg_testtable_bignumeric_array_val_distinct]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT ELEMENTWISE_AVG(DISTINCT bignumeric_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<BIGNUMERIC>[known order:2, 3, 4, 4, NULL]}]
==

[required_features=GROUP_BY_ARRAY,BIGNUMERIC_TYPE]
[name=aggregate_elementwise_avg_testtable_bignumeric_array_val_distinct_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT group_id, ELEMENTWISE_AVG(DISTINCT bignumeric_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<BIGNUMERIC>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE,BIGNUMERIC_TYPE]
[name=aggregate_elementwise_avg_testtable_bignumeric_array_val_distinct_having_min]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT ELEMENTWISE_AVG(DISTINCT bignumeric_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<BIGNUMERIC>[known order:2, 3, 4, 4, NULL]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE,BIGNUMERIC_TYPE]
[name=aggregate_elementwise_avg_testtable_bignumeric_array_val_distinct_having_min_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT group_id, ELEMENTWISE_AVG(DISTINCT bignumeric_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<BIGNUMERIC>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE,BIGNUMERIC_TYPE]
[name=aggregate_elementwise_avg_testtable_bignumeric_array_val_distinct_having_max]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT ELEMENTWISE_AVG(DISTINCT bignumeric_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]}]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE,BIGNUMERIC_TYPE]
[name=aggregate_elementwise_avg_testtable_bignumeric_array_val_distinct_having_max_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT group_id, ELEMENTWISE_AVG(DISTINCT bignumeric_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    ARRAY<BIGNUMERIC>[known order:2, 3, 4, 4, NULL]
  },
  {
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=INTERVAL_TYPE]
[name=aggregate_elementwise_avg_testtable_interval_array_val]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT ELEMENTWISE_AVG( interval_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[
  {ARRAY<INTERVAL>[known order:
     0-2 7 12:0:0,
     0-3 7 12:0:0,
     0-4 7 12:0:0,
     0-4 7 12:0:0,
     NULL
   ]}
]
==

[required_features=INTERVAL_TYPE]
[name=aggregate_elementwise_avg_testtable_interval_array_val_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT group_id, ELEMENTWISE_AVG( interval_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {1,
   ARRAY<INTERVAL>[known order:
     0-2 0 0:0:0,
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-4 0 0:0:0,
     NULL
   ]},
  {2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]}
]
==

[required_features=HAVING_IN_AGGREGATE,INTERVAL_TYPE]
[name=aggregate_elementwise_avg_testtable_interval_array_val_having_min]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT ELEMENTWISE_AVG( interval_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[
  {ARRAY<INTERVAL>[known order:
     0-2 0 0:0:0,
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-4 0 0:0:0,
     NULL
   ]}
]
==

[required_features=HAVING_IN_AGGREGATE,INTERVAL_TYPE]
[name=aggregate_elementwise_avg_testtable_interval_array_val_having_min_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT group_id, ELEMENTWISE_AVG( interval_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {1,
   ARRAY<INTERVAL>[known order:
     0-2 0 0:0:0,
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-4 0 0:0:0,
     NULL
   ]},
  {2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]}
]
==

[required_features=HAVING_IN_AGGREGATE,INTERVAL_TYPE]
[name=aggregate_elementwise_avg_testtable_interval_array_val_having_max]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT ELEMENTWISE_AVG( interval_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[
  {ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]}
]
==

[required_features=HAVING_IN_AGGREGATE,INTERVAL_TYPE]
[name=aggregate_elementwise_avg_testtable_interval_array_val_having_max_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT group_id, ELEMENTWISE_AVG( interval_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {1,
   ARRAY<INTERVAL>[known order:
     0-2 0 0:0:0,
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-4 0 0:0:0,
     NULL
   ]},
  {2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]}
]
==

[required_features=GROUP_BY_ARRAY,INTERVAL_TYPE]
[name=aggregate_elementwise_avg_testtable_interval_array_val_distinct]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT ELEMENTWISE_AVG(DISTINCT interval_array_val ) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[
  {ARRAY<INTERVAL>[known order:
     0-2 0 0:0:0,
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-4 0 0:0:0,
     NULL
   ]}
]
==

[required_features=GROUP_BY_ARRAY,INTERVAL_TYPE]
[name=aggregate_elementwise_avg_testtable_interval_array_val_distinct_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT group_id, ELEMENTWISE_AVG(DISTINCT interval_array_val ) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {1,
   ARRAY<INTERVAL>[known order:
     0-2 0 0:0:0,
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-4 0 0:0:0,
     NULL
   ]},
  {2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]}
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE,INTERVAL_TYPE]
[name=aggregate_elementwise_avg_testtable_interval_array_val_distinct_having_min]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT ELEMENTWISE_AVG(DISTINCT interval_array_val HAVING MIN group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[
  {ARRAY<INTERVAL>[known order:
     0-2 0 0:0:0,
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-4 0 0:0:0,
     NULL
   ]}
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE,INTERVAL_TYPE]
[name=aggregate_elementwise_avg_testtable_interval_array_val_distinct_having_min_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT group_id, ELEMENTWISE_AVG(DISTINCT interval_array_val HAVING MIN group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {1,
   ARRAY<INTERVAL>[known order:
     0-2 0 0:0:0,
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-4 0 0:0:0,
     NULL
   ]},
  {2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]}
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE,INTERVAL_TYPE]
[name=aggregate_elementwise_avg_testtable_interval_array_val_distinct_having_max]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT ELEMENTWISE_AVG(DISTINCT interval_array_val HAVING MAX group_id) FROM TestTable AS col1;
--
ARRAY<STRUCT<ARRAY<>>>[
  {ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]}
]
==

[required_features=GROUP_BY_ARRAY,HAVING_IN_AGGREGATE,INTERVAL_TYPE]
[name=aggregate_elementwise_avg_testtable_interval_array_val_distinct_having_max_group_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT group_id, ELEMENTWISE_AVG(DISTINCT interval_array_val HAVING MAX group_id) FROM TestTable AS col1 GROUP BY group_id;
--
ARRAY<STRUCT<group_id INT64, ARRAY<>>>[unknown order:
  {1,
   ARRAY<INTERVAL>[known order:
     0-2 0 0:0:0,
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-4 0 0:0:0,
     NULL
   ]},
  {2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]}
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_int32_array_val]
SELECT row_id, group_id, ELEMENTWISE_AVG(int32_array_val) OVER (  ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_int32_array_val_order_by]
SELECT row_id, group_id, ELEMENTWISE_AVG(int32_array_val) OVER ( ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1, 2, 3, 3, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_int32_array_val_order_by_rows]
SELECT row_id, group_id, ELEMENTWISE_AVG(int32_array_val) OVER ( ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {3,
   1,
   ARRAY<DOUBLE>[known order:
     2.6666666666666665,
     3.6666666666666665,
     4.666666666666667,
     4.666666666666667,
     NULL
   ]},
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_int32_array_val_order_by_range]
SELECT row_id, group_id, ELEMENTWISE_AVG(int32_array_val) OVER ( ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {3,
   1,
   ARRAY<DOUBLE>[known order:
     2.6666666666666665,
     3.6666666666666665,
     4.666666666666667,
     4.666666666666667,
     NULL
   ]},
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_int32_array_val_partition_order_by]
SELECT row_id, group_id, ELEMENTWISE_AVG(int32_array_val) OVER (PARTITION BY group_id ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1, 2, 3, 3, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_int32_array_val_partition_order_by_rows]
SELECT row_id, group_id, ELEMENTWISE_AVG(int32_array_val) OVER (PARTITION BY group_id ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:2.5, 3.5, 4.5, 4.5, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_int32_array_val_partition_order_by_range]
SELECT row_id, group_id, ELEMENTWISE_AVG(int32_array_val) OVER (PARTITION BY group_id ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:2.5, 3.5, 4.5, 4.5, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_int64_array_val]
SELECT row_id, group_id, ELEMENTWISE_AVG(int64_array_val) OVER (  ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_int64_array_val_order_by]
SELECT row_id, group_id, ELEMENTWISE_AVG(int64_array_val) OVER ( ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1, 2, 3, 3, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_int64_array_val_order_by_rows]
SELECT row_id, group_id, ELEMENTWISE_AVG(int64_array_val) OVER ( ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {3,
   1,
   ARRAY<DOUBLE>[known order:
     2.6666666666666665,
     3.6666666666666665,
     4.666666666666667,
     4.666666666666667,
     NULL
   ]},
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_int64_array_val_order_by_range]
SELECT row_id, group_id, ELEMENTWISE_AVG(int64_array_val) OVER ( ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {3,
   1,
   ARRAY<DOUBLE>[known order:
     2.6666666666666665,
     3.6666666666666665,
     4.666666666666667,
     4.666666666666667,
     NULL
   ]},
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_int64_array_val_partition_order_by]
SELECT row_id, group_id, ELEMENTWISE_AVG(int64_array_val) OVER (PARTITION BY group_id ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1, 2, 3, 3, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_int64_array_val_partition_order_by_rows]
SELECT row_id, group_id, ELEMENTWISE_AVG(int64_array_val) OVER (PARTITION BY group_id ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:2.5, 3.5, 4.5, 4.5, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_int64_array_val_partition_order_by_range]
SELECT row_id, group_id, ELEMENTWISE_AVG(int64_array_val) OVER (PARTITION BY group_id ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:2.5, 3.5, 4.5, 4.5, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_uint32_array_val]
SELECT row_id, group_id, ELEMENTWISE_AVG(uint32_array_val) OVER (  ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_uint32_array_val_order_by]
SELECT row_id, group_id, ELEMENTWISE_AVG(uint32_array_val) OVER ( ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1, 2, 3, 3, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_uint32_array_val_order_by_rows]
SELECT row_id, group_id, ELEMENTWISE_AVG(uint32_array_val) OVER ( ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {3,
   1,
   ARRAY<DOUBLE>[known order:
     2.6666666666666665,
     3.6666666666666665,
     4.666666666666667,
     4.666666666666667,
     NULL
   ]},
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_uint32_array_val_order_by_range]
SELECT row_id, group_id, ELEMENTWISE_AVG(uint32_array_val) OVER ( ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {3,
   1,
   ARRAY<DOUBLE>[known order:
     2.6666666666666665,
     3.6666666666666665,
     4.666666666666667,
     4.666666666666667,
     NULL
   ]},
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_uint32_array_val_partition_order_by]
SELECT row_id, group_id, ELEMENTWISE_AVG(uint32_array_val) OVER (PARTITION BY group_id ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1, 2, 3, 3, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_uint32_array_val_partition_order_by_rows]
SELECT row_id, group_id, ELEMENTWISE_AVG(uint32_array_val) OVER (PARTITION BY group_id ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:2.5, 3.5, 4.5, 4.5, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_uint32_array_val_partition_order_by_range]
SELECT row_id, group_id, ELEMENTWISE_AVG(uint32_array_val) OVER (PARTITION BY group_id ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:2.5, 3.5, 4.5, 4.5, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_uint64_array_val]
SELECT row_id, group_id, ELEMENTWISE_AVG(uint64_array_val) OVER (  ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_uint64_array_val_order_by]
SELECT row_id, group_id, ELEMENTWISE_AVG(uint64_array_val) OVER ( ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1, 2, 3, 3, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_uint64_array_val_order_by_rows]
SELECT row_id, group_id, ELEMENTWISE_AVG(uint64_array_val) OVER ( ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {3,
   1,
   ARRAY<DOUBLE>[known order:
     2.6666666666666665,
     3.6666666666666665,
     4.666666666666667,
     4.666666666666667,
     NULL
   ]},
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_uint64_array_val_order_by_range]
SELECT row_id, group_id, ELEMENTWISE_AVG(uint64_array_val) OVER ( ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {3,
   1,
   ARRAY<DOUBLE>[known order:
     2.6666666666666665,
     3.6666666666666665,
     4.666666666666667,
     4.666666666666667,
     NULL
   ]},
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_uint64_array_val_partition_order_by]
SELECT row_id, group_id, ELEMENTWISE_AVG(uint64_array_val) OVER (PARTITION BY group_id ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1, 2, 3, 3, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_uint64_array_val_partition_order_by_rows]
SELECT row_id, group_id, ELEMENTWISE_AVG(uint64_array_val) OVER (PARTITION BY group_id ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:2.5, 3.5, 4.5, 4.5, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_uint64_array_val_partition_order_by_range]
SELECT row_id, group_id, ELEMENTWISE_AVG(uint64_array_val) OVER (PARTITION BY group_id ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:2.5, 3.5, 4.5, 4.5, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_float_array_val]
SELECT row_id, group_id, ELEMENTWISE_AVG(float_array_val) OVER (  ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_float_array_val_order_by]
SELECT row_id, group_id, ELEMENTWISE_AVG(float_array_val) OVER ( ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1, 2, 3, 3, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_float_array_val_order_by_rows]
SELECT row_id, group_id, ELEMENTWISE_AVG(float_array_val) OVER ( ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {3,
   1,
   ARRAY<DOUBLE>[known order:
     2.6666666666666665,
     3.6666666666666665,
     4.666666666666667,
     4.666666666666667,
     NULL
   ]},
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_float_array_val_order_by_range]
SELECT row_id, group_id, ELEMENTWISE_AVG(float_array_val) OVER ( ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {3,
   1,
   ARRAY<DOUBLE>[known order:
     2.6666666666666665,
     3.6666666666666665,
     4.666666666666667,
     4.666666666666667,
     NULL
   ]},
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_float_array_val_partition_order_by]
SELECT row_id, group_id, ELEMENTWISE_AVG(float_array_val) OVER (PARTITION BY group_id ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1, 2, 3, 3, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_float_array_val_partition_order_by_rows]
SELECT row_id, group_id, ELEMENTWISE_AVG(float_array_val) OVER (PARTITION BY group_id ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:2.5, 3.5, 4.5, 4.5, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_float_array_val_partition_order_by_range]
SELECT row_id, group_id, ELEMENTWISE_AVG(float_array_val) OVER (PARTITION BY group_id ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:2.5, 3.5, 4.5, 4.5, NULL]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_double_array_val]
SELECT row_id, group_id, ELEMENTWISE_AVG(double_array_val) OVER (  ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL, nan]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL, nan]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL, nan]
  },
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL, nan]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL, nan]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL, nan]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_double_array_val_order_by]
SELECT row_id, group_id, ELEMENTWISE_AVG(double_array_val) OVER ( ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1, 2, 3, 3, NULL, nan]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL, nan]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL, nan]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL, nan]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL, nan]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:2.25, 3.25, 4.25, 4.25, NULL, nan]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_double_array_val_order_by_rows]
SELECT row_id, group_id, ELEMENTWISE_AVG(double_array_val) OVER ( ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL, nan]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL, nan]
  },
  {3,
   1,
   ARRAY<DOUBLE>[known order:
     2.6666666666666665,
     3.6666666666666665,
     4.666666666666667,
     4.666666666666667,
     NULL,
     nan
   ]},
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, nan]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_double_array_val_order_by_range]
SELECT row_id, group_id, ELEMENTWISE_AVG(double_array_val) OVER ( ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL, nan]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL, nan]
  },
  {3,
   1,
   ARRAY<DOUBLE>[known order:
     2.6666666666666665,
     3.6666666666666665,
     4.666666666666667,
     4.666666666666667,
     NULL,
     nan
   ]},
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, nan]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_double_array_val_partition_order_by]
SELECT row_id, group_id, ELEMENTWISE_AVG(double_array_val) OVER (PARTITION BY group_id ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1, 2, 3, 3, NULL, nan]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL, nan]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL, nan]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_double_array_val_partition_order_by_rows]
SELECT row_id, group_id, ELEMENTWISE_AVG(double_array_val) OVER (PARTITION BY group_id ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL, nan]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL, nan]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:2.5, 3.5, 4.5, 4.5, NULL, nan]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS]
[name=window_elementwise_avg_testtable_double_array_val_partition_order_by_range]
SELECT row_id, group_id, ELEMENTWISE_AVG(double_array_val) OVER (PARTITION BY group_id ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<DOUBLE>[known order:1.5, 2.5, 3.5, 3.5, NULL, nan]
  },
  {
    2,
    1,
    ARRAY<DOUBLE>[known order:2, 3, 4, 4, NULL, nan]
  },
  {
    3,
    1,
    ARRAY<DOUBLE>[known order:2.5, 3.5, 4.5, 4.5, NULL, nan]
  },
  {
    4,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]
  },
  {
    5,
    2,
    ARRAY<DOUBLE>[known order:3, 4, 5, 5, NULL, 0]
  },
  {
    6,
    2,
    ARRAY<DOUBLE>[known order:NULL, NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,NUMERIC_TYPE]
[name=window_elementwise_avg_testtable_numeric_array_val]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT row_id, group_id, ELEMENTWISE_AVG(numeric_array_val) OVER (  ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    2,
    1,
    ARRAY<NUMERIC>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    4,
    2,
    ARRAY<NUMERIC>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    6,
    2,
    ARRAY<NUMERIC>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    1,
    1,
    ARRAY<NUMERIC>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    3,
    1,
    ARRAY<NUMERIC>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    5,
    2,
    ARRAY<NUMERIC>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,NUMERIC_TYPE]
[name=window_elementwise_avg_testtable_numeric_array_val_order_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT row_id, group_id, ELEMENTWISE_AVG(numeric_array_val) OVER ( ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<NUMERIC>[known order:1, 2, 3, 3, NULL]
  },
  {
    2,
    1,
    ARRAY<NUMERIC>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    3,
    1,
    ARRAY<NUMERIC>[known order:2, 3, 4, 4, NULL]
  },
  {
    4,
    2,
    ARRAY<NUMERIC>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    5,
    2,
    ARRAY<NUMERIC>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    6,
    2,
    ARRAY<NUMERIC>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,NUMERIC_TYPE]
[name=window_elementwise_avg_testtable_numeric_array_val_order_by_rows]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT row_id, group_id, ELEMENTWISE_AVG(numeric_array_val) OVER ( ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<NUMERIC>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    2,
    1,
    ARRAY<NUMERIC>[known order:2, 3, 4, 4, NULL]
  },
  {3,
   1,
   ARRAY<NUMERIC>[known order:
     2.666666667,
     3.666666667,
     4.666666667,
     4.666666667,
     NULL
   ]},
  {
    4,
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<NUMERIC>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,NUMERIC_TYPE]
[name=window_elementwise_avg_testtable_numeric_array_val_order_by_range]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT row_id, group_id, ELEMENTWISE_AVG(numeric_array_val) OVER ( ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<NUMERIC>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    2,
    1,
    ARRAY<NUMERIC>[known order:2, 3, 4, 4, NULL]
  },
  {3,
   1,
   ARRAY<NUMERIC>[known order:
     2.666666667,
     3.666666667,
     4.666666667,
     4.666666667,
     NULL
   ]},
  {
    4,
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<NUMERIC>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,NUMERIC_TYPE]
[name=window_elementwise_avg_testtable_numeric_array_val_partition_order_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT row_id, group_id, ELEMENTWISE_AVG(numeric_array_val) OVER (PARTITION BY group_id ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<NUMERIC>[known order:1, 2, 3, 3, NULL]
  },
  {
    2,
    1,
    ARRAY<NUMERIC>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    3,
    1,
    ARRAY<NUMERIC>[known order:2, 3, 4, 4, NULL]
  },
  {
    4,
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,NUMERIC_TYPE]
[name=window_elementwise_avg_testtable_numeric_array_val_partition_order_by_rows]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT row_id, group_id, ELEMENTWISE_AVG(numeric_array_val) OVER (PARTITION BY group_id ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<NUMERIC>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    2,
    1,
    ARRAY<NUMERIC>[known order:2, 3, 4, 4, NULL]
  },
  {
    3,
    1,
    ARRAY<NUMERIC>[known order:2.5, 3.5, 4.5, 4.5, NULL]
  },
  {
    4,
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<NUMERIC>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,NUMERIC_TYPE]
[name=window_elementwise_avg_testtable_numeric_array_val_partition_order_by_range]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [NUMERIC '1', NUMERIC '2', NUMERIC '3', NUMERIC '3', CAST(NULL AS NUMERIC)] as numeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [NUMERIC '2', NUMERIC '3', NUMERIC '4', NUMERIC '4', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [NUMERIC '3', NUMERIC '4', NUMERIC '5', NUMERIC '5', CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC), CAST(NULL AS NUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<NUMERIC>))
SELECT row_id, group_id, ELEMENTWISE_AVG(numeric_array_val) OVER (PARTITION BY group_id ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<NUMERIC>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    2,
    1,
    ARRAY<NUMERIC>[known order:2, 3, 4, 4, NULL]
  },
  {
    3,
    1,
    ARRAY<NUMERIC>[known order:2.5, 3.5, 4.5, 4.5, NULL]
  },
  {
    4,
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<NUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<NUMERIC>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,BIGNUMERIC_TYPE]
[name=window_elementwise_avg_testtable_bignumeric_array_val]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT row_id, group_id, ELEMENTWISE_AVG(bignumeric_array_val) OVER (  ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    2,
    1,
    ARRAY<BIGNUMERIC>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    4,
    2,
    ARRAY<BIGNUMERIC>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    6,
    2,
    ARRAY<BIGNUMERIC>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    1,
    1,
    ARRAY<BIGNUMERIC>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    3,
    1,
    ARRAY<BIGNUMERIC>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    5,
    2,
    ARRAY<BIGNUMERIC>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,BIGNUMERIC_TYPE]
[name=window_elementwise_avg_testtable_bignumeric_array_val_order_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT row_id, group_id, ELEMENTWISE_AVG(bignumeric_array_val) OVER ( ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<BIGNUMERIC>[known order:1, 2, 3, 3, NULL]
  },
  {
    2,
    1,
    ARRAY<BIGNUMERIC>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    3,
    1,
    ARRAY<BIGNUMERIC>[known order:2, 3, 4, 4, NULL]
  },
  {
    4,
    2,
    ARRAY<BIGNUMERIC>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    5,
    2,
    ARRAY<BIGNUMERIC>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  },
  {
    6,
    2,
    ARRAY<BIGNUMERIC>[known order:2.25, 3.25, 4.25, 4.25, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,BIGNUMERIC_TYPE]
[name=window_elementwise_avg_testtable_bignumeric_array_val_order_by_rows]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT row_id, group_id, ELEMENTWISE_AVG(bignumeric_array_val) OVER ( ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<BIGNUMERIC>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    2,
    1,
    ARRAY<BIGNUMERIC>[known order:2, 3, 4, 4, NULL]
  },
  {3,
   1,
   ARRAY<BIGNUMERIC>[known order:
     2.66666666666666666666666666666666666667,
     3.66666666666666666666666666666666666667,
     4.66666666666666666666666666666666666667,
     4.66666666666666666666666666666666666667,
     NULL
   ]},
  {
    4,
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<BIGNUMERIC>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,BIGNUMERIC_TYPE]
[name=window_elementwise_avg_testtable_bignumeric_array_val_order_by_range]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT row_id, group_id, ELEMENTWISE_AVG(bignumeric_array_val) OVER ( ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<BIGNUMERIC>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    2,
    1,
    ARRAY<BIGNUMERIC>[known order:2, 3, 4, 4, NULL]
  },
  {3,
   1,
   ARRAY<BIGNUMERIC>[known order:
     2.66666666666666666666666666666666666667,
     3.66666666666666666666666666666666666667,
     4.66666666666666666666666666666666666667,
     4.66666666666666666666666666666666666667,
     NULL
   ]},
  {
    4,
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<BIGNUMERIC>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,BIGNUMERIC_TYPE]
[name=window_elementwise_avg_testtable_bignumeric_array_val_partition_order_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT row_id, group_id, ELEMENTWISE_AVG(bignumeric_array_val) OVER (PARTITION BY group_id ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<BIGNUMERIC>[known order:1, 2, 3, 3, NULL]
  },
  {
    2,
    1,
    ARRAY<BIGNUMERIC>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    3,
    1,
    ARRAY<BIGNUMERIC>[known order:2, 3, 4, 4, NULL]
  },
  {
    4,
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,BIGNUMERIC_TYPE]
[name=window_elementwise_avg_testtable_bignumeric_array_val_partition_order_by_rows]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT row_id, group_id, ELEMENTWISE_AVG(bignumeric_array_val) OVER (PARTITION BY group_id ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<BIGNUMERIC>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    2,
    1,
    ARRAY<BIGNUMERIC>[known order:2, 3, 4, 4, NULL]
  },
  {
    3,
    1,
    ARRAY<BIGNUMERIC>[known order:2.5, 3.5, 4.5, 4.5, NULL]
  },
  {
    4,
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<BIGNUMERIC>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,BIGNUMERIC_TYPE]
[name=window_elementwise_avg_testtable_bignumeric_array_val_partition_order_by_range]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [BIGNUMERIC '1', BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '3', CAST(NULL AS BIGNUMERIC)] as bignumeric_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '2', BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '4', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [BIGNUMERIC '3', BIGNUMERIC '4', BIGNUMERIC '5', BIGNUMERIC '5', CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC), CAST(NULL AS BIGNUMERIC)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<BIGNUMERIC>))
SELECT row_id, group_id, ELEMENTWISE_AVG(bignumeric_array_val) OVER (PARTITION BY group_id ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {
    1,
    1,
    ARRAY<BIGNUMERIC>[known order:1.5, 2.5, 3.5, 3.5, NULL]
  },
  {
    2,
    1,
    ARRAY<BIGNUMERIC>[known order:2, 3, 4, 4, NULL]
  },
  {
    3,
    1,
    ARRAY<BIGNUMERIC>[known order:2.5, 3.5, 4.5, 4.5, NULL]
  },
  {
    4,
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    5,
    2,
    ARRAY<BIGNUMERIC>[known order:3, 4, 5, 5, NULL]
  },
  {
    6,
    2,
    ARRAY<BIGNUMERIC>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,INTERVAL_TYPE]
[name=window_elementwise_avg_testtable_interval_array_val]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT row_id, group_id, ELEMENTWISE_AVG(interval_array_val) OVER (  ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {2,
   1,
   ARRAY<INTERVAL>[known order:
     0-2 7 12:0:0,
     0-3 7 12:0:0,
     0-4 7 12:0:0,
     0-4 7 12:0:0,
     NULL
   ]},
  {4,
   2,
   ARRAY<INTERVAL>[known order:
     0-2 7 12:0:0,
     0-3 7 12:0:0,
     0-4 7 12:0:0,
     0-4 7 12:0:0,
     NULL
   ]},
  {6,
   2,
   ARRAY<INTERVAL>[known order:
     0-2 7 12:0:0,
     0-3 7 12:0:0,
     0-4 7 12:0:0,
     0-4 7 12:0:0,
     NULL
   ]},
  {1,
   1,
   ARRAY<INTERVAL>[known order:
     0-2 7 12:0:0,
     0-3 7 12:0:0,
     0-4 7 12:0:0,
     0-4 7 12:0:0,
     NULL
   ]},
  {3,
   1,
   ARRAY<INTERVAL>[known order:
     0-2 7 12:0:0,
     0-3 7 12:0:0,
     0-4 7 12:0:0,
     0-4 7 12:0:0,
     NULL
   ]},
  {5,
   2,
   ARRAY<INTERVAL>[known order:
     0-2 7 12:0:0,
     0-3 7 12:0:0,
     0-4 7 12:0:0,
     0-4 7 12:0:0,
     NULL
   ]}
]
==

[required_features=ANALYTIC_FUNCTIONS,INTERVAL_TYPE]
[name=window_elementwise_avg_testtable_interval_array_val_order_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT row_id, group_id, ELEMENTWISE_AVG(interval_array_val) OVER ( ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {1,
   1,
   ARRAY<INTERVAL>[known order:
     0-1 0 0:0:0,
     0-2 0 0:0:0,
     0-3 0 0:0:0,
     0-3 0 0:0:0,
     NULL
   ]},
  {2,
   1,
   ARRAY<INTERVAL>[known order:
     0-1 15 0:0:0,
     0-2 15 0:0:0,
     0-3 15 0:0:0,
     0-3 15 0:0:0,
     NULL
   ]},
  {3,
   1,
   ARRAY<INTERVAL>[known order:
     0-2 0 0:0:0,
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-4 0 0:0:0,
     NULL
   ]},
  {4,
   2,
   ARRAY<INTERVAL>[known order:
     0-2 7 12:0:0,
     0-3 7 12:0:0,
     0-4 7 12:0:0,
     0-4 7 12:0:0,
     NULL
   ]},
  {5,
   2,
   ARRAY<INTERVAL>[known order:
     0-2 7 12:0:0,
     0-3 7 12:0:0,
     0-4 7 12:0:0,
     0-4 7 12:0:0,
     NULL
   ]},
  {6,
   2,
   ARRAY<INTERVAL>[known order:
     0-2 7 12:0:0,
     0-3 7 12:0:0,
     0-4 7 12:0:0,
     0-4 7 12:0:0,
     NULL
   ]}
]
==

[required_features=ANALYTIC_FUNCTIONS,INTERVAL_TYPE]
[name=window_elementwise_avg_testtable_interval_array_val_order_by_rows]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT row_id, group_id, ELEMENTWISE_AVG(interval_array_val) OVER ( ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {1,
   1,
   ARRAY<INTERVAL>[known order:
     0-1 15 0:0:0,
     0-2 15 0:0:0,
     0-3 15 0:0:0,
     0-3 15 0:0:0,
     NULL
   ]},
  {2,
   1,
   ARRAY<INTERVAL>[known order:
     0-2 0 0:0:0,
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-4 0 0:0:0,
     NULL
   ]},
  {3,
   1,
   ARRAY<INTERVAL>[known order:
     0-2 20 0:0:0,
     0-3 20 0:0:0,
     0-4 20 0:0:0,
     0-4 20 0:0:0,
     NULL
   ]},
  {4,
   2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]},
  {5,
   2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]},
  {
    6,
    2,
    ARRAY<INTERVAL>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,INTERVAL_TYPE]
[name=window_elementwise_avg_testtable_interval_array_val_order_by_range]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT row_id, group_id, ELEMENTWISE_AVG(interval_array_val) OVER ( ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {1,
   1,
   ARRAY<INTERVAL>[known order:
     0-1 15 0:0:0,
     0-2 15 0:0:0,
     0-3 15 0:0:0,
     0-3 15 0:0:0,
     NULL
   ]},
  {2,
   1,
   ARRAY<INTERVAL>[known order:
     0-2 0 0:0:0,
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-4 0 0:0:0,
     NULL
   ]},
  {3,
   1,
   ARRAY<INTERVAL>[known order:
     0-2 20 0:0:0,
     0-3 20 0:0:0,
     0-4 20 0:0:0,
     0-4 20 0:0:0,
     NULL
   ]},
  {4,
   2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]},
  {5,
   2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]},
  {
    6,
    2,
    ARRAY<INTERVAL>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,INTERVAL_TYPE]
[name=window_elementwise_avg_testtable_interval_array_val_partition_order_by]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT row_id, group_id, ELEMENTWISE_AVG(interval_array_val) OVER (PARTITION BY group_id ORDER BY row_id ) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {1,
   1,
   ARRAY<INTERVAL>[known order:
     0-1 0 0:0:0,
     0-2 0 0:0:0,
     0-3 0 0:0:0,
     0-3 0 0:0:0,
     NULL
   ]},
  {2,
   1,
   ARRAY<INTERVAL>[known order:
     0-1 15 0:0:0,
     0-2 15 0:0:0,
     0-3 15 0:0:0,
     0-3 15 0:0:0,
     NULL
   ]},
  {3,
   1,
   ARRAY<INTERVAL>[known order:
     0-2 0 0:0:0,
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-4 0 0:0:0,
     NULL
   ]},
  {4,
   2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]},
  {5,
   2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]},
  {6,
   2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]}
]
==

[required_features=ANALYTIC_FUNCTIONS,INTERVAL_TYPE]
[name=window_elementwise_avg_testtable_interval_array_val_partition_order_by_rows]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT row_id, group_id, ELEMENTWISE_AVG(interval_array_val) OVER (PARTITION BY group_id ORDER BY row_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {1,
   1,
   ARRAY<INTERVAL>[known order:
     0-1 15 0:0:0,
     0-2 15 0:0:0,
     0-3 15 0:0:0,
     0-3 15 0:0:0,
     NULL
   ]},
  {2,
   1,
   ARRAY<INTERVAL>[known order:
     0-2 0 0:0:0,
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-4 0 0:0:0,
     NULL
   ]},
  {3,
   1,
   ARRAY<INTERVAL>[known order:
     0-2 15 0:0:0,
     0-3 15 0:0:0,
     0-4 15 0:0:0,
     0-4 15 0:0:0,
     NULL
   ]},
  {4,
   2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]},
  {5,
   2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]},
  {
    6,
    2,
    ARRAY<INTERVAL>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
==

[required_features=ANALYTIC_FUNCTIONS,INTERVAL_TYPE]
[name=window_elementwise_avg_testtable_interval_array_val_partition_order_by_range]

WITH TestTable AS (
SELECT CAST(1 AS int64) as row_id,
       CAST(1 AS int64) as group_id,
       [INTERVAL 1 month, INTERVAL 2 month, INTERVAL 3 month, INTERVAL 3 month, CAST(NULL AS INTERVAL)] as interval_array_val
UNION ALL
SELECT CAST(2 AS int64),
       CAST(1 AS int64),
       [INTERVAL 2 month, INTERVAL 3 month, INTERVAL 4 month, INTERVAL 4 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(3 AS int64),
       CAST(1 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(4 AS int64),
       CAST(2 AS int64),
       [INTERVAL 3 month, INTERVAL 4 month, INTERVAL 5 month, INTERVAL 5 month, CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(5 AS int64),
       CAST(2 AS int64),
       [CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL), CAST(NULL AS INTERVAL)]
UNION ALL
SELECT CAST(6 AS int64),
       CAST(2 AS int64),
       CAST(NULL AS ARRAY<INTERVAL>))
SELECT row_id, group_id, ELEMENTWISE_AVG(interval_array_val) OVER (PARTITION BY group_id ORDER BY row_id RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) FROM TestTable AS col1;
--
ARRAY<STRUCT<row_id INT64, group_id INT64, ARRAY<>>>[unknown order:
  {1,
   1,
   ARRAY<INTERVAL>[known order:
     0-1 15 0:0:0,
     0-2 15 0:0:0,
     0-3 15 0:0:0,
     0-3 15 0:0:0,
     NULL
   ]},
  {2,
   1,
   ARRAY<INTERVAL>[known order:
     0-2 0 0:0:0,
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-4 0 0:0:0,
     NULL
   ]},
  {3,
   1,
   ARRAY<INTERVAL>[known order:
     0-2 15 0:0:0,
     0-3 15 0:0:0,
     0-4 15 0:0:0,
     0-4 15 0:0:0,
     NULL
   ]},
  {4,
   2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]},
  {5,
   2,
   ARRAY<INTERVAL>[known order:
     0-3 0 0:0:0,
     0-4 0 0:0:0,
     0-5 0 0:0:0,
     0-5 0 0:0:0,
     NULL
   ]},
  {
    6,
    2,
    ARRAY<INTERVAL>[known order:NULL, NULL, NULL, NULL, NULL]
  }
]
