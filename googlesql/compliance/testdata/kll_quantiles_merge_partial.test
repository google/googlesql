[name=merge_partial_exists_null_sketches]
SELECT KLL_QUANTILES.EXTRACT_DOUBLE(sketch, 2)
FROM (
  SELECT KLL_QUANTILES.MERGE_PARTIAL(sketch) AS sketch
  FROM (
    SELECT KLL_QUANTILES.INIT_DOUBLE(input, 1000) AS sketch
    FROM UNNEST([3.0, 1.0, 2.0]) AS input
    UNION ALL
    SELECT NULL
  )
)
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:1, 2, 3]}]
==

[name=merge_partial_exists_empty_sketches]
SELECT KLL_QUANTILES.EXTRACT_DOUBLE(sketch, 2)
FROM (
  SELECT KLL_QUANTILES.MERGE_PARTIAL(sketch) AS sketch
  FROM (
    SELECT KLL_QUANTILES.INIT_DOUBLE(input, 2000) AS sketch
    FROM UNNEST([3.0, 1.0, 2.0]) AS input
    UNION ALL
    SELECT KLL_QUANTILES.INIT_DOUBLE(input, 2000)
    FROM UNNEST(ARRAY<DOUBLE>[]) AS input
  )
)
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:1, 2, 3]}]
==

[name=merge_partial_valid_sketches_int64]
SELECT KLL_QUANTILES.EXTRACT_INT64(sketch, 2)
FROM (
  SELECT KLL_QUANTILES.MERGE_PARTIAL(sketch) AS sketch
  FROM (
    SELECT KLL_QUANTILES.INIT_INT64(input, 2000) AS sketch
    FROM UNNEST([3, 2, 1]) AS input
    UNION ALL
    SELECT KLL_QUANTILES.INIT_INT64(input, 2000)
    FROM UNNEST([6, 4, 7, 2]) AS input
  )
)
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<INT64>[known order:1, 3, 7]}]
==

[name=merge_partial_valid_sketches_double]
SELECT KLL_QUANTILES.EXTRACT_DOUBLE(sketch, 2)
FROM (
  SELECT KLL_QUANTILES.MERGE_PARTIAL(sketch) AS sketch
  FROM (
    SELECT KLL_QUANTILES.INIT_DOUBLE(input, 2000) AS sketch
    FROM UNNEST(ARRAY<DOUBLE>[2, 3, 1]) AS input
    UNION ALL
    SELECT KLL_QUANTILES.INIT_DOUBLE(input, 2000)
    FROM UNNEST(ARRAY<DOUBLE>[7, 6, 2, 4]) AS input
  )
)
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<DOUBLE>[known order:1, 3, 7]}]
==

[name=merge_partial_valid_sketches_uint64]
SELECT KLL_QUANTILES.EXTRACT_UINT64(sketch, 2)
FROM (
  SELECT KLL_QUANTILES.MERGE_PARTIAL(sketch) AS sketch
  FROM (
    SELECT KLL_QUANTILES.INIT_UINT64(input, 2000) AS sketch
    FROM UNNEST(ARRAY<UINT64>[1, 2, 3]) AS input
    UNION ALL
    SELECT KLL_QUANTILES.INIT_UINT64(input, 2000)
    FROM UNNEST(ARRAY<UINT64>[7, 6, 4, 2]) AS input
  )
)
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<UINT64>[known order:1, 3, 7]}]
==

[name=merge_partial_different_precisions_higher_into_lower]
SELECT KLL_QUANTILES.EXTRACT_UINT64(sketch, 2)
FROM (
  SELECT KLL_QUANTILES.MERGE_PARTIAL(sketch) AS sketch
  FROM (
    SELECT KLL_QUANTILES.INIT_UINT64(input, 1000) AS sketch
    FROM UNNEST(ARRAY<UINT64>[3, 2, 1]) AS input
    UNION ALL
    SELECT KLL_QUANTILES.INIT_UINT64(input, 2000)
    FROM UNNEST(ARRAY<UINT64>[2, 4, 6, 7]) AS input
  )
)
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<UINT64>[known order:1, 3, 7]}]
==

[name=merge_partial_different_precisions_lower_into_higher]
SELECT KLL_QUANTILES.EXTRACT_UINT64(sketch, 2)
FROM (
  SELECT KLL_QUANTILES.MERGE_PARTIAL(sketch) AS sketch
  FROM (
    SELECT KLL_QUANTILES.INIT_UINT64(input, 2000) AS sketch
    FROM UNNEST(ARRAY<UINT64>[2, 3, 1]) AS input
    UNION ALL
    SELECT KLL_QUANTILES.INIT_UINT64(input, 1000)
    FROM UNNEST(ARRAY<UINT64>[4, 7, 6, 2]) AS input
  )
)
--
ARRAY<STRUCT<ARRAY<>>>[{ARRAY<UINT64>[known order:1, 3, 7]}]
