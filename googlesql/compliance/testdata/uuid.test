[default required_features=UUID_TYPE]
[prepare_database]
CREATE TABLE UuidTable AS
SELECT 1 id, CAST(NULL AS UUID) value UNION ALL
SELECT 2, CAST('00000000-0000-0000-0000-000000000001' AS UUID) UNION ALL
SELECT 3, CAST('00000000-0000-0000-0000-000000000001' AS UUID) UNION ALL
SELECT 4, CAST('00000000-0000-0000-0000-000000000022' AS UUID) UNION ALL
SELECT 5, CAST('00000000-0000-0000-0000-000000000022' AS UUID) UNION ALL
SELECT 6, CAST('00000000-0333-0000-0000-000000000333' AS UUID) UNION ALL
SELECT 7, CAST('00000000-4444-0000-0000-000000004444' AS UUID) UNION ALL
SELECT 8, CAST('00000000-0000-0000-0000-000000000001' AS UUID) UNION ALL
SELECT 9, CAST(NULL AS uuid) as uuid_val UNION ALL
SELECT 10, CAST('00000000-0005-5555-0000-000000055555' AS UUID) UNION ALL
SELECT 11, CAST('ffffffff-ffff-ffff-ffff-ffffffffffff' AS uuid) UNION ALL
SELECT 12, CAST('ffffffff-ffff-ffff-ffff-ffffffffffff' AS uuid)
--
ARRAY<STRUCT<id INT64, value UUID>>[
  {1, NULL},
  {
    2,
    00000000-0000-0000-0000-000000000001
  },
  {
    3,
    00000000-0000-0000-0000-000000000001
  },
  {
    4,
    00000000-0000-0000-0000-000000000022
  },
  {
    5,
    00000000-0000-0000-0000-000000000022
  },
  {
    6,
    00000000-0333-0000-0000-000000000333
  },
  {
    7,
    00000000-4444-0000-0000-000000004444
  },
  {
    8,
    00000000-0000-0000-0000-000000000001
  },
  {9, NULL},
  {
    10,
    00000000-0005-5555-0000-000000055555
  },
  {
    11,
    ffffffff-ffff-ffff-ffff-ffffffffffff
  },
  {
    12,
    ffffffff-ffff-ffff-ffff-ffffffffffff
  }
]
==

# Verify that uuid value casts to uuid value.
[default required_features=UUID_TYPE]
[name=uuid_self_case]
SELECT CAST(CAST('9d3da323-4c20-360f-bd9b-ec54feec54f0' AS UUID) AS UUID)
--
ARRAY<STRUCT<UUID>>[{9d3da323-4c20-360f-bd9b-ec54feec54f0}]
==

# Verify that uuid value casts to string value.
[default required_features=UUID_TYPE]
[name=uuid_to_string]
SELECT CAST(CAST('9d3da323-4c20-360f-bd9b-ec54feec54f0' AS UUID) AS STRING)
--
ARRAY<STRUCT<STRING>>[{"9d3da323-4c20-360f-bd9b-ec54feec54f0"}]
==

# Verify that uuid value casts to bytes value.
[default required_features=UUID_TYPE]
[name=uuid_to_bytes]
SELECT CAST(CAST('9d3da323-4c20-360f-bd9b-ec54feec54f0' AS UUID) AS BYTES)
--
ARRAY<STRUCT<BYTES>>[{b"\x9d=\xa3#L 6\x0f\xbd\x9b\xecT\xfe\xecT\xf0"}]
==

[default required_features=UUID_TYPE]
[name=any_value]
SELECT ANY_VALUE(i) FROM UNNEST(
  [CAST('9d3da323-4c20-360f-bd9b-ec54feec54f0' AS UUID),
  CAST('9d3da323-4c20-360f-bd9b-ec54feec54f0' AS UUID)]) i
--
ARRAY<STRUCT<UUID>>[{9d3da323-4c20-360f-bd9b-ec54feec54f0}]
==

[default required_features=UUID_TYPE]
[name=array_agg]
SELECT ARRAY_AGG(i) FROM UNNEST(
  [CAST('9d4da323-4c20-360f-bd9b-ec54feec54f0' AS UUID),
  CAST('9d3da323-4c20-360f-bd9b-ec54feec54f0' AS UUID)]) i
--
ARRAY<STRUCT<ARRAY<>>>[
  {ARRAY<UUID>[unknown order:
     9d3da323-4c20-360f-bd9b-ec54feec54f0,
     9d4da323-4c20-360f-bd9b-ec54feec54f0
   ]}
]
==

[required_features=UUID_TYPE,ORDER_BY_IN_AGGREGATE]
[name=array_agg_orderby]
SELECT ARRAY_AGG(value ORDER BY value, id) FROM UuidTable
--
ARRAY<STRUCT<ARRAY<>>>[
  {ARRAY<UUID>[known order:
     NULL,
     NULL,
     00000000-0000-0000-0000-000000000001,
     00000000-0000-0000-0000-000000000001,
     00000000-0000-0000-0000-000000000001,
     00000000-0000-0000-0000-000000000022,
     00000000-0000-0000-0000-000000000022,
     00000000-0005-5555-0000-000000055555,
     00000000-0333-0000-0000-000000000333,
     00000000-4444-0000-0000-000000004444,
     ffffffff-ffff-ffff-ffff-ffffffffffff,
     ffffffff-ffff-ffff-ffff-ffffffffffff
   ]}
]
==

[default required_features=UUID_TYPE]
[name=approx_count_distinct]
SELECT APPROX_COUNT_DISTINCT(value) approx_uniques FROM UuidTable
--
ARRAY<STRUCT<approx_uniques INT64>>[{6}]
==

[default required_features=UUID_TYPE]
[name=approx_top_count]
SELECT APPROX_TOP_COUNT(value, 1) FROM UuidTable
--
ARRAY<STRUCT<ARRAY<>>>[
  {ARRAY<STRUCT<value UUID, count INT64>>[
     {
       00000000-0000-0000-0000-000000000001,
       3
     }
   ]}
]
==

[default required_features=UUID_TYPE]
[name=join]
SELECT id, value, i FROM UuidTable
INNER JOIN
(SELECT i FROM UNNEST([
  CAST('00000000-0000-0000-0000-000000000001' AS UUID),
  CAST('00000000-4444-0000-0000-000000004444' AS UUID)]) i)
ON value = i
ORDER BY id ASC
--
ARRAY<STRUCT<id INT64, value UUID, i UUID>>[known order:
  {
    2,
    00000000-0000-0000-0000-000000000001,
    00000000-0000-0000-0000-000000000001
  },
  {
    3,
    00000000-0000-0000-0000-000000000001,
    00000000-0000-0000-0000-000000000001
  },
  {
    7,
    00000000-4444-0000-0000-000000004444,
    00000000-4444-0000-0000-000000004444
  },
  {
    8,
    00000000-0000-0000-0000-000000000001,
    00000000-0000-0000-0000-000000000001
  }
]
==

[default required_features=UUID_TYPE]
[name=in_semijoin]
SELECT id, value FROM UuidTable
WHERE value IN (SELECT i FROM UNNEST([
  CAST('00000000-0000-0000-0000-000000000001' AS UUID),
  CAST('00000000-4444-0000-0000-000000004444' AS UUID)]) i)
ORDER BY id ASC
--
ARRAY<STRUCT<id INT64, value UUID>>[known order:
  {
    2,
    00000000-0000-0000-0000-000000000001
  },
  {
    3,
    00000000-0000-0000-0000-000000000001
  },
  {
    7,
    00000000-4444-0000-0000-000000004444
  },
  {
    8,
    00000000-0000-0000-0000-000000000001
  }
]
==

[required_features=UUID_TYPE,ANALYTIC_FUNCTIONS]
[name=analytic_partitionby]
SELECT value, COUNT(*) OVER(PARTITION BY value)
FROM UuidTable
ORDER BY value ASC, id ASC
--
ARRAY<STRUCT<value UUID, INT64>>[known order:
  {NULL, 2},
  {NULL, 2},
  {
    00000000-0000-0000-0000-000000000001,
    3
  },
  {
    00000000-0000-0000-0000-000000000001,
    3
  },
  {
    00000000-0000-0000-0000-000000000001,
    3
  },
  {
    00000000-0000-0000-0000-000000000022,
    2
  },
  {
    00000000-0000-0000-0000-000000000022,
    2
  },
  {
    00000000-0005-5555-0000-000000055555,
    1
  },
  {
    00000000-0333-0000-0000-000000000333,
    1
  },
  {
    00000000-4444-0000-0000-000000004444,
    1
  },
  {
    ffffffff-ffff-ffff-ffff-ffffffffffff,
    2
  },
  {
    ffffffff-ffff-ffff-ffff-ffffffffffff,
    2
  }
]
==

[required_features=UUID_TYPE,ANALYTIC_FUNCTIONS]
[name=count_distinct_analytic]
SELECT
  COUNT(DISTINCT value) OVER()
FROM UuidTable;
--
ARRAY<STRUCT<INT64>>[unknown order:
  {6},
  {6},
  {6},
  {6},
  {6},
  {6},
  {6},
  {6},
  {6},
  {6},
  {6},
  {6}
]
==
[required_features=UUID_TYPE,ANALYTIC_FUNCTIONS]
[name=analytic_running_min]
SELECT
  MIN(value) OVER(
    ORDER BY value ASC, id ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
  )
FROM UuidTable
WHERE value > CAST('00000000-0333-0000-0000-000000000333' AS UUID)
--
ARRAY<STRUCT<UUID>>[unknown order:
  {00000000-4444-0000-0000-000000004444},
  {00000000-4444-0000-0000-000000004444},
  {00000000-4444-0000-0000-000000004444}
]
==
[required_features=UUID_TYPE,ANALYTIC_FUNCTIONS]
[name=analytic_moving_max]
SELECT MAX(value) OVER(ORDER BY value, id ASC ROWS BETWEEN 3 PRECEDING AND CURRENT ROW) FROM UuidTable
--
ARRAY<STRUCT<UUID>>[unknown order:
  {NULL},
  {NULL},
  {00000000-0000-0000-0000-000000000001},
  {00000000-0000-0000-0000-000000000001},
  {00000000-0000-0000-0000-000000000001},
  {00000000-0000-0000-0000-000000000022},
  {00000000-0000-0000-0000-000000000022},
  {00000000-0005-5555-0000-000000055555},
  {00000000-0333-0000-0000-000000000333},
  {00000000-4444-0000-0000-000000004444},
  {ffffffff-ffff-ffff-ffff-ffffffffffff},
  {ffffffff-ffff-ffff-ffff-ffffffffffff}
]
==
[required_features=UUID_TYPE]
[name=cmp_scalar_null]
SELECT
  CAST(NULL AS UUID) <= CAST('00000000-0000-0000-0000-000000000001' AS UUID),
  CAST(NULL AS UUID) >= CAST('00000000-0000-0000-0000-000000000001' AS UUID),
  CAST(NULL AS UUID) = CAST('00000000-0000-0000-0000-000000000001' AS UUID),
  CAST(NULL AS UUID) < CAST('00000000-0000-0000-0000-000000000001' AS UUID),
  CAST(NULL AS UUID) > CAST('00000000-0000-0000-0000-000000000001' AS UUID),
  CAST(NULL AS UUID) != CAST('00000000-0000-0000-0000-000000000001' AS UUID),
  CAST(NULL AS UUID) <> CAST('00000000-0000-0000-0000-000000000001' AS UUID),
  CAST(NULL AS UUID) != CAST(NULL AS UUID),
  CAST(NULL AS UUID) = CAST(NULL AS UUID)

--
ARRAY<STRUCT<BOOL, BOOL, BOOL, BOOL, BOOL, BOOL, BOOL, BOOL, BOOL>>[
  {NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL}
]
==
[required_features=UUID_TYPE]
[name=cmp_scalar]
SELECT
  CAST('f0000000-0000-0000-0000-000000000000' AS UUID) <= CAST('00000000-0000-0000-0000-000000000001' AS UUID),
  CAST('f0000000-0000-0000-0000-000000000000' AS UUID) >= CAST('00000000-0000-0000-0000-000000000001' AS UUID),
  CAST('f0000000-0000-0000-0000-000000000000' AS UUID) = CAST('00000000-0000-0000-0000-000000000001' AS UUID),
  CAST('00000000-0000-0000-0000-000000000001' AS UUID) = CAST('00000000-0000-0000-0000-000000000001' AS UUID),
  CAST('f0000000-0000-0000-0000-000000000000' AS UUID) < CAST('00000000-0000-0000-0000-000000000001' AS UUID),
  CAST('f0000000-0000-0000-0000-000000000000' AS UUID) > CAST('00000000-0000-0000-0000-000000000001' AS UUID),
  CAST('f0000000-0000-0000-0000-000000000000' AS UUID) != CAST('00000000-0000-0000-0000-000000000001' AS UUID),
  CAST('00000000-0000-0000-0000-000000000001' AS UUID) <> CAST('00000000-0000-0000-0000-000000000001' AS UUID)

--
ARRAY<STRUCT<BOOL, BOOL, BOOL, BOOL, BOOL, BOOL, BOOL, BOOL>>[
  {false, true, false, true, false, true, true, false}
]
==
[required_features=UUID_TYPE]
[name=cmp_struct]
SELECT
  STRUCT(1, CAST('00000000-0000-0000-0000-000000000001' AS UUID)) = STRUCT(1, CAST('00000000-0000-0000-0000-000000000001' AS UUID)),
  STRUCT(1, CAST('00000000-0000-0000-0000-000000000001' AS UUID)) = STRUCT(1, NULL),
  STRUCT(1, CAST('00000000-0000-0000-0000-000000000001' AS UUID)) = STRUCT(1, CAST('00000000-0000-0000-0000-000000000022' AS UUID)),
--
ARRAY<STRUCT<BOOL, BOOL, BOOL>>[{true, NULL, false}]
==
[required_features=IS_DISTINCT,UUID_TYPE]
[name=is_not_distinct_from]
SELECT
  CAST('00000000-0000-0000-0000-000000000001' AS UUID) IS NOT DISTINCT FROM CAST('00000000-0000-0000-0000-000000000001' AS UUID),
  CAST('00000000-0000-0000-0000-000000000001' AS UUID) IS NOT DISTINCT FROM CAST('00000000-0000-0000-0000-000000000022' AS UUID),
  CAST('00000000-0000-0000-0000-000000000001' AS UUID) IS NOT DISTINCT FROM NULL
--
ARRAY<STRUCT<BOOL, BOOL, BOOL>>[{true, false, false}]
==
[required_features=IS_DISTINCT,UUID_TYPE]
[name=is_distinct_from]
SELECT
  CAST('00000000-0000-0000-0000-000000000001' AS UUID) IS DISTINCT FROM CAST('00000000-0000-0000-0000-000000000001' AS UUID),
  CAST('00000000-0000-0000-0000-000000000001' AS UUID) IS DISTINCT FROM CAST('00000000-0000-0000-0000-000000000022' AS UUID),
  CAST('00000000-0000-0000-0000-000000000001' AS UUID) IS DISTINCT FROM NULL
--
ARRAY<STRUCT<BOOL, BOOL, BOOL>>[{false, true, true}]
==

[required_features=UUID_TYPE]
[name=cast_bytes_literal_with_too_many_bytes_to_uuid]
SELECT CAST(b'123e4567-e89b-12d3-a456-426614174000' AS UUID)
--
ERROR: generic::out_of_range: Invalid bytes value size for UUID, expected 16 bytes, but got 36 bytes.
==

[required_features=UUID_TYPE]
[name=cast_bytes_column_with_too_many_bytes_to_uuid]
SELECT CAST(b AS UUID)
FROM (SELECT b'123e4567-e89b-12d3-a456-426614174000' AS b)
--
ERROR: generic::out_of_range: Invalid bytes value size for UUID, expected 16 bytes, but got 36 bytes.
==

[required_features=UUID_TYPE]
[name=safe_cast_bytes_with_too_many_bytes_to_uuid]
SELECT
  SAFE_CAST(b'123e4567-e89b-12d3-a456-426614174000' AS UUID),
  SAFE_CAST(b AS UUID)
FROM (SELECT b'123e4567-e89b-12d3-a456-426614174000' AS b)
--
ARRAY<STRUCT<UUID, UUID>>[{NULL, NULL}]
